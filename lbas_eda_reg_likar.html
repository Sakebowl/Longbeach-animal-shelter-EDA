<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Miha Likar">

<title>Final report: Long Beach Animal Shelter - EDA (Statistical programming in R)</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="lbas_eda_reg_likar_files/libs/clipboard/clipboard.min.js"></script>
<script src="lbas_eda_reg_likar_files/libs/quarto-html/quarto.js"></script>
<script src="lbas_eda_reg_likar_files/libs/quarto-html/popper.min.js"></script>
<script src="lbas_eda_reg_likar_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="lbas_eda_reg_likar_files/libs/quarto-html/anchor.min.js"></script>
<link href="lbas_eda_reg_likar_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="lbas_eda_reg_likar_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="lbas_eda_reg_likar_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="lbas_eda_reg_likar_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="lbas_eda_reg_likar_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="lbas_eda_reg_likar_files/libs/kePrint-0.0.1/kePrint.js"></script>
<link href="lbas_eda_reg_likar_files/libs/lightable-0.0.1/lightable.css" rel="stylesheet">


<link rel="stylesheet" href="styles.css">
</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active" data-toc-expanded="2">
    <h2 id="toc-title">Contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a>
  <ul>
  <li><a href="#dataset" id="toc-dataset" class="nav-link" data-scroll-target="#dataset">Dataset</a></li>
  </ul></li>
  <li><a href="#exploratory-data-analysis-eda" id="toc-exploratory-data-analysis-eda" class="nav-link" data-scroll-target="#exploratory-data-analysis-eda">Exploratory data analysis (EDA)</a>
  <ul>
  <li><a href="#reading-the-dataset" id="toc-reading-the-dataset" class="nav-link" data-scroll-target="#reading-the-dataset">Reading the dataset</a></li>
  <li><a href="#exploring-distributions-of-variables-of-interest" id="toc-exploring-distributions-of-variables-of-interest" class="nav-link" data-scroll-target="#exploring-distributions-of-variables-of-interest">Exploring distributions of variables of interest</a>
  <ul class="collapse">
  <li><a href="#animal-type" id="toc-animal-type" class="nav-link" data-scroll-target="#animal-type">Animal type</a></li>
  <li><a href="#intake-condition" id="toc-intake-condition" class="nav-link" data-scroll-target="#intake-condition">Intake condition</a>
  <ul class="collapse">
  <li><a href="#combining-animal-type-and-intake-condition" id="toc-combining-animal-type-and-intake-condition" class="nav-link" data-scroll-target="#combining-animal-type-and-intake-condition">Combining animal type and intake condition</a></li>
  </ul></li>
  <li><a href="#intake-type" id="toc-intake-type" class="nav-link" data-scroll-target="#intake-type">Intake type</a></li>
  <li><a href="#sex" id="toc-sex" class="nav-link" data-scroll-target="#sex">Sex</a></li>
  <li><a href="#outcome-type" id="toc-outcome-type" class="nav-link" data-scroll-target="#outcome-type">Outcome type</a></li>
  <li><a href="#combining-animal-type-intake-condition-and-outcome-type" id="toc-combining-animal-type-intake-condition-and-outcome-type" class="nav-link" data-scroll-target="#combining-animal-type-intake-condition-and-outcome-type">Combining animal type, intake condition and outcome type</a>
  <ul class="collapse">
  <li><a href="#animal-type-vs.-outcome-type" id="toc-animal-type-vs.-outcome-type" class="nav-link" data-scroll-target="#animal-type-vs.-outcome-type">Animal type vs.&nbsp;outcome type</a></li>
  <li><a href="#intake-condition-vs.-outcome-type" id="toc-intake-condition-vs.-outcome-type" class="nav-link" data-scroll-target="#intake-condition-vs.-outcome-type">Intake condition vs.&nbsp;outcome type</a></li>
  <li><a href="#animal-type-vs.-intake-condition-vs.-outcome-type" id="toc-animal-type-vs.-intake-condition-vs.-outcome-type" class="nav-link" data-scroll-target="#animal-type-vs.-intake-condition-vs.-outcome-type">Animal type vs.&nbsp;intake condition vs.&nbsp;outcome type</a></li>
  </ul></li>
  <li><a href="#combining-animal-type-intake-condition-and-adoption" id="toc-combining-animal-type-intake-condition-and-adoption" class="nav-link" data-scroll-target="#combining-animal-type-intake-condition-and-adoption">Combining animal type, intake condition and adoption</a></li>
  <li><a href="#age" id="toc-age" class="nav-link" data-scroll-target="#age">Age</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#logistic-regression-models" id="toc-logistic-regression-models" class="nav-link" data-scroll-target="#logistic-regression-models">Logistic regression models</a>
  <ul>
  <li><a href="#final-dataset-preparation" id="toc-final-dataset-preparation" class="nav-link" data-scroll-target="#final-dataset-preparation">Final dataset preparation</a></li>
  <li><a href="#simple-model-animal-related-native-factors" id="toc-simple-model-animal-related-native-factors" class="nav-link" data-scroll-target="#simple-model-animal-related-native-factors">Simple model (animal related, native factors)</a>
  <ul class="collapse">
  <li><a href="#construct-the-model" id="toc-construct-the-model" class="nav-link" data-scroll-target="#construct-the-model">Construct the model</a></li>
  <li><a href="#visualize-the-model" id="toc-visualize-the-model" class="nav-link" data-scroll-target="#visualize-the-model">Visualize the model</a></li>
  <li><a href="#checking-assumptions" id="toc-checking-assumptions" class="nav-link" data-scroll-target="#checking-assumptions">Checking assumptions</a></li>
  <li><a href="#assessing-model-fit" id="toc-assessing-model-fit" class="nav-link" data-scroll-target="#assessing-model-fit">Assessing model fit</a>
  <ul class="collapse">
  <li><a href="#preudo-r-squared" id="toc-preudo-r-squared" class="nav-link" data-scroll-target="#preudo-r-squared">Preudo R-squared</a></li>
  <li><a href="#roc-and-auc" id="toc-roc-and-auc" class="nav-link" data-scroll-target="#roc-and-auc">ROC and AUC</a></li>
  <li><a href="#confusion-matrix-for-determining-accuracy" id="toc-confusion-matrix-for-determining-accuracy" class="nav-link" data-scroll-target="#confusion-matrix-for-determining-accuracy">Confusion matrix for determining accuracy</a></li>
  <li><a href="#all-model-fit-indices" id="toc-all-model-fit-indices" class="nav-link" data-scroll-target="#all-model-fit-indices">All model fit indices:</a></li>
  </ul></li>
  <li><a href="#summary-of-the-simple-model" id="toc-summary-of-the-simple-model" class="nav-link" data-scroll-target="#summary-of-the-simple-model">Summary of the simple model</a></li>
  </ul></li>
  <li><a href="#updated-simple-model-merging-geriatric-and-senior-age-bins" id="toc-updated-simple-model-merging-geriatric-and-senior-age-bins" class="nav-link" data-scroll-target="#updated-simple-model-merging-geriatric-and-senior-age-bins">Updated simple model (merging “geriatric” and “senior” age bins)</a>
  <ul class="collapse">
  <li><a href="#construct-new-model" id="toc-construct-new-model" class="nav-link" data-scroll-target="#construct-new-model">Construct new model</a></li>
  <li><a href="#visualize-the-model-1" id="toc-visualize-the-model-1" class="nav-link" data-scroll-target="#visualize-the-model-1">Visualize the model</a></li>
  <li><a href="#checking-assumptions-1" id="toc-checking-assumptions-1" class="nav-link" data-scroll-target="#checking-assumptions-1">Checking assumptions</a></li>
  <li><a href="#assessing-model-fit-1" id="toc-assessing-model-fit-1" class="nav-link" data-scroll-target="#assessing-model-fit-1">Assessing model fit</a>
  <ul class="collapse">
  <li><a href="#preudo-r-squared-1" id="toc-preudo-r-squared-1" class="nav-link" data-scroll-target="#preudo-r-squared-1">Preudo R-squared</a></li>
  <li><a href="#roc-and-auc-1" id="toc-roc-and-auc-1" class="nav-link" data-scroll-target="#roc-and-auc-1">ROC and AUC</a></li>
  <li><a href="#confusion-matrix-for-determining-accuracy-1" id="toc-confusion-matrix-for-determining-accuracy-1" class="nav-link" data-scroll-target="#confusion-matrix-for-determining-accuracy-1">Confusion matrix for determining accuracy</a></li>
  <li><a href="#all-model-fit-indices-1" id="toc-all-model-fit-indices-1" class="nav-link" data-scroll-target="#all-model-fit-indices-1">All model fit indices:</a></li>
  </ul></li>
  <li><a href="#summary-of-updated-simple-model---merged-senior-and-geriatric-age-bins" id="toc-summary-of-updated-simple-model---merged-senior-and-geriatric-age-bins" class="nav-link" data-scroll-target="#summary-of-updated-simple-model---merged-senior-and-geriatric-age-bins">Summary of updated simple model - merged senior and geriatric age bins</a></li>
  </ul></li>
  <li><a href="#complex-model---added-contextual-predictors" id="toc-complex-model---added-contextual-predictors" class="nav-link" data-scroll-target="#complex-model---added-contextual-predictors">Complex model - added contextual predictors</a>
  <ul class="collapse">
  <li><a href="#construct-the-model-1" id="toc-construct-the-model-1" class="nav-link" data-scroll-target="#construct-the-model-1">Construct the model</a></li>
  <li><a href="#visualize-the-model-2" id="toc-visualize-the-model-2" class="nav-link" data-scroll-target="#visualize-the-model-2">Visualize the model</a></li>
  <li><a href="#checking-assumptions-2" id="toc-checking-assumptions-2" class="nav-link" data-scroll-target="#checking-assumptions-2">Checking assumptions</a></li>
  <li><a href="#assessing-model-fit-2" id="toc-assessing-model-fit-2" class="nav-link" data-scroll-target="#assessing-model-fit-2">Assessing model fit</a>
  <ul class="collapse">
  <li><a href="#preudo-r-squared-2" id="toc-preudo-r-squared-2" class="nav-link" data-scroll-target="#preudo-r-squared-2">Preudo R-squared</a></li>
  <li><a href="#roc-and-auc-2" id="toc-roc-and-auc-2" class="nav-link" data-scroll-target="#roc-and-auc-2">ROC and AUC</a></li>
  <li><a href="#confusion-matrix-for-determining-accuracy-2" id="toc-confusion-matrix-for-determining-accuracy-2" class="nav-link" data-scroll-target="#confusion-matrix-for-determining-accuracy-2">Confusion matrix for determining accuracy</a></li>
  <li><a href="#all-model-fit-indices-2" id="toc-all-model-fit-indices-2" class="nav-link" data-scroll-target="#all-model-fit-indices-2">All model fit indices:</a></li>
  </ul></li>
  <li><a href="#summary-of-the-complex-model" id="toc-summary-of-the-complex-model" class="nav-link" data-scroll-target="#summary-of-the-complex-model">Summary of the complex model</a></li>
  </ul></li>
  <li><a href="#model-comparisons" id="toc-model-comparisons" class="nav-link" data-scroll-target="#model-comparisons">Model comparisons</a>
  <ul class="collapse">
  <li><a href="#reporting-model-comparison" id="toc-reporting-model-comparison" class="nav-link" data-scroll-target="#reporting-model-comparison">Reporting model comparison</a></li>
  </ul></li>
  <li><a href="#final-model-summaries" id="toc-final-model-summaries" class="nav-link" data-scroll-target="#final-model-summaries">Final model summaries</a></li>
  </ul></li>
  <li><a href="#final-discussion" id="toc-final-discussion" class="nav-link" data-scroll-target="#final-discussion">Final discussion</a></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Final report: Long Beach Animal Shelter - EDA (Statistical programming in R)</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Miha Likar </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>opts_chunk<span class="sc">$</span><span class="fu">set</span>(<span class="at">echo =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.4     ✔ readr     2.1.5
✔ forcats   1.0.0     ✔ stringr   1.5.1
✔ ggplot2   3.5.1     ✔ tibble    3.2.1
✔ lubridate 1.9.4     ✔ tidyr     1.3.1
✔ purrr     1.0.4     
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'scales'

The following object is masked from 'package:purrr':

    discard

The following object is masked from 'package:readr':

    col_factor</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(paletteer)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggpomological)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(treemapify)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sjPlot)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Learn more about sjPlot with 'browseVignettes("sjPlot")'.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(performance)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pROC)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Type 'citation("pROC")' for a citation.

Attaching package: 'pROC'

The following objects are masked from 'package:stats':

    cov, smooth, var</code></pre>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: lattice

Attaching package: 'caret'

The following object is masked from 'package:purrr':

    lift</code></pre>
</div>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DHARMa)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>This is DHARMa 0.4.7. For overview type '?DHARMa'. For recent changes, type news(package = 'DHARMa')</code></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'kableExtra'

The following object is masked from 'package:dplyr':

    group_rows</code></pre>
</div>
</div>
<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>In this report, I’ll present exploratory data analysis of Long Beach Animal Shelter dataset. Additionally, throughout the EDA, I will formulate specific research question(s) which will be addressed in the regression models section.</p>
<p>The workflow and structure of this report is as follows:</p>
<ul>
<li>Brief introduction about the dataset and available variables</li>
<li>Explore distributions of various single variables</li>
<li>Explore associations between 2 and/or more variables</li>
<li>Impute certain variables based on the available data (age, sterilization status)</li>
<li>Clearly formulate RQ and Hs</li>
<li>Regression analysis and model comparison</li>
</ul>
<section id="dataset" class="level2">
<h2 class="anchored" data-anchor-id="dataset">Dataset</h2>
<p>Long Beach Animal Shelter dataset contains various variables about animals taken into the shelter between years 2017 and 2024. These variables provide information about animal characteristics (animal type, color, intake condition, intake type, sex, sterilization status etc.), dates (date of birth, intake date, outcome date) and shelter related information (jurisdiction, longitude, latitude). I will explore several of these variables and determine what should be of focus in my regression analysis.</p>
</section>
</section>
<section id="exploratory-data-analysis-eda" class="level1">
<h1>Exploratory data analysis (EDA)</h1>
<section id="reading-the-dataset" class="level2">
<h2 class="anchored" data-anchor-id="reading-the-dataset">Reading the dataset</h2>
<p>Read the data from an online source - TidyTuesday GitHub page.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>longbeach_raw <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(<span class="st">'https://raw.githubusercontent.com/rfordatascience/tidytuesday/main/data/2025/2025-03-04/longbeach.csv'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 29787 Columns: 22
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr  (15): animal_id, animal_name, animal_type, primary_color, secondary_col...
dbl   (2): latitude, longitude
lgl   (2): outcome_is_dead, was_outcome_alive
date  (3): dob, intake_date, outcome_date

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
</div>
<p>Let’s look at the dataset, to see what we are working with.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(longbeach_raw)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 29,787
Columns: 22
$ animal_id         &lt;chr&gt; "A693708", "A708149", "A638068", "A639310", "A618968…
$ animal_name       &lt;chr&gt; "*charlien", NA, NA, NA, "*morgan", "*brandon", NA, …
$ animal_type       &lt;chr&gt; "dog", "reptile", "bird", "bird", "cat", "rabbit", "…
$ primary_color     &lt;chr&gt; "white", "brown", "green", "white", "black", "black"…
$ secondary_color   &lt;chr&gt; NA, "green", "red", "gray", "white", "white", NA, "b…
$ sex               &lt;chr&gt; "Female", "Unknown", "Unknown", "Unknown", "Female",…
$ dob               &lt;date&gt; 2013-02-21, NA, NA, NA, 2014-12-18, 2023-04-19, NA,…
$ intake_date       &lt;date&gt; 2023-02-20, 2023-10-03, 2020-01-01, 2020-02-02, 201…
$ intake_condition  &lt;chr&gt; "ill mild", "normal", "injured  severe", "ill severe…
$ intake_type       &lt;chr&gt; "stray", "stray", "wildlife", "wildlife", "stray", "…
$ intake_subtype    &lt;chr&gt; "otc", "field", "field", "field", "field", "otc", "f…
$ reason_for_intake &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
$ outcome_date      &lt;date&gt; 2023-02-26, 2023-10-03, 2020-01-01, 2020-02-02, 201…
$ crossing          &lt;chr&gt; "[2600 BLK LONG BEACH BLVD, LONG BEACH CA, 90806", "…
$ jurisdiction      &lt;chr&gt; "Long Beach", "Long Beach", "Long Beach", "Long Beac…
$ outcome_type      &lt;chr&gt; "euthanasia", "rescue", "euthanasia", "transfer", "r…
$ outcome_subtype   &lt;chr&gt; "ill severe", "other resc", "inj severe", "lbah", "l…
$ latitude          &lt;dbl&gt; 33.80479, 33.86800, 33.76048, 33.76246, 33.84950, 33…
$ longitude         &lt;dbl&gt; -118.1889, -118.2009, -118.1481, -118.1597, -118.194…
$ outcome_is_dead   &lt;lgl&gt; TRUE, FALSE, TRUE, FALSE, FALSE, FALSE, TRUE, FALSE,…
$ was_outcome_alive &lt;lgl&gt; FALSE, TRUE, FALSE, TRUE, TRUE, TRUE, FALSE, TRUE, T…
$ geopoint          &lt;chr&gt; "33.8047935, -118.1889261", "33.8679994, -118.200930…</code></pre>
</div>
</div>
<p>There are several variables that already stand out as variables I want to primarily focus on in EDA. These are:</p>
<ul>
<li><code>animal_type</code> - type of the animal (dog, cat, bird etc.)</li>
<li><code>sex</code> - sex of the animal and information about sterilization status</li>
<li><code>dob</code> + <code>intake_date</code> - date of birth and intake date - will be used to compute age of the animal</li>
<li><code>intake_condition</code> - in what health condition was animal taken into the shelter</li>
<li><code>intake_type</code> - what is the reason the animal was taken into the shelter (stray, owner surrender etc.)</li>
<li><code>outcome_type</code> - what was the outcome for the animal (adoption, euthanasia, transfer etc.)</li>
</ul>
<p>Before we proceed, let’s factorize all the character variables. If we realize we need some of them in the numeric or character format later on, we can change this afterwards.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>longbeach <span class="ot">&lt;-</span> longbeach_raw <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.character), as.factor))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Ok let’s look at the summary, get the basic idea of levels of categorical variables etc.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(longbeach)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   animal_id      animal_name     animal_type         primary_color 
 A637086:    8   *      :   92   cat    :14145   black       :7540  
 A637269:    7   luna   :   84   dog    : 9768   gray        :3916  
 A279626:    6   rocky  :   78   bird   : 2075   white       :3651  
 A610057:    6   max    :   77   wild   : 1412   brown       :3531  
 A354875:    5   coco   :   64   other  : 1332   brown  tabby:2242  
 A542375:    5   (Other):17230   rabbit :  526   tan         :1393  
 (Other):29750   NA's   :12162   (Other):  529   (Other)     :7514  
 secondary_color       sex            dob              intake_date        
 white  : 8344   Female  :6230   Min.   :1993-05-28   Min.   :2017-01-01  
 black  : 1902   Male    :6854   1st Qu.:2016-07-09   1st Qu.:2018-08-10  
 brown  : 1402   Neutered:5588   Median :2018-11-01   Median :2020-08-29  
 tan    :  830   Spayed  :4763   Mean   :2018-08-09   Mean   :2020-11-17  
 gray   :  783   Unknown :6352   3rd Qu.:2022-02-01   3rd Qu.:2023-04-19  
 (Other):  922                   Max.   :2031-03-30   Max.   :2024-12-31  
 NA's   :15604                   NA's   :3591                             
          intake_condition          intake_type     intake_subtype 
 normal           :13706   stray          :21126   otc     :15519  
 under age/weight : 6590   wildlife       : 4473   field   :11818  
 injured  severe  : 2097   owner surrender: 2615   trap    :  468  
 ill severe       : 1311   welfare seized :  484   police  :  374  
 ill mild         : 1192   confiscate     :  399   adoption:  220  
 injured  moderate: 1177   return         :  306   (Other) :  998  
 (Other)          : 3714   (Other)        :  384   NA's    :  390  
  reason_for_intake  outcome_date       
 owner prob:  432   Min.   :2017-01-01  
 move      :  236   1st Qu.:2018-08-18  
 landlord  :  145   Median :2020-09-01  
 cost      :  133   Mean   :2020-11-27  
 no time   :  122   3rd Qu.:2023-04-21  
 (Other)   :  935   Max.   :2024-12-31  
 NA's      :27784   NA's   :177         
                                               crossing    
 7700 E SPRING ST, LONG BEACH, CA 90815            :  251  
 7700 BLK E SPRING ST, LONG BEACH, CA 90815        :   70  
 6400 BLK ATLANTIC AVE, LONG BEACH, CA 90805       :   68  
 3300 BLK SANTA FE AVE, LONG BEACH, CA 90810       :   50  
 7500 BLK E SPRING ST, LONG BEACH, CA 90815        :   50  
 4700 BLK E PACIFIC COAST HWY, LONG BEACH, CA 90804:   45  
 (Other)                                           :29253  
       jurisdiction            outcome_type    outcome_subtype     latitude    
 Long Beach  :25590   rescue         :6680   spcala    : 3784   Min.   :19.30  
 Cerritos    : 2023   adoption       :6290   walkin    : 2857   1st Qu.:33.78  
 Signal Hill :  721   euthanasia     :5451   web       : 2852   Median :33.81  
 Los Alamitos:  531   transfer       :4869   ill severe: 1869   Mean   :33.81  
 Seal Beach  :  373   return to owner:3214   inj severe: 1286   3rd Qu.:33.85  
 (Other)     :  548   (Other)        :3096   (Other)   :13753   Max.   :45.52  
 NA's        :    1   NA's           : 187   NA's      : 3386                  
   longitude       outcome_is_dead was_outcome_alive
 Min.   :-122.70   Mode :logical   Mode :logical    
 1st Qu.:-118.19   FALSE:23573     FALSE:6214       
 Median :-118.17   TRUE :6214      TRUE :23573      
 Mean   :-118.15                                    
 3rd Qu.:-118.13                                    
 Max.   : -73.99                                    
                                                    
                     geopoint    
 33.8096122, -118.0826161:  456  
 33.7700504, -118.1937395:  135  
 33.8708354, -118.1846106:  118  
 33.8097185, -118.0929813:  108  
 33.7898537, -118.1458794:  101  
 33.810379, -118.0992327 :   73  
 (Other)                 :28796  </code></pre>
</div>
</div>
<p><strong>Looking at the data, I notice a few things, that I should do, focus on:</strong></p>
<ul>
<li><code>animal_type</code>: lump, investigate distribution.</li>
<li><code>sex</code>: we can use this variable to infer both sex of the animal and “sterilization status” - whether animal was neutered/spayed, or it animal’s reproductive functioning is intact. Investigate distribution.</li>
<li>Use <code>dob</code> (date of birth) and <code>intake_date</code> to compute age at intake. This might be useful for modeling later on, but initially look at the distribution.</li>
<li>Investigate <code>intake_condition</code>. Probably categories will need lumping. Explore distribution.</li>
<li>Investigate <code>intake_type</code>. Probably categories will need lumping. Explore distribution.</li>
<li>Investigate <code>outcome_type</code>. Probably categories will need lumping. Explore distribution. Group the general types into <em>positive outcomes</em> and <em>negative outcomes</em> (will be discussed in more details later) and <em>adoption rate</em>, based on adopted vs.&nbsp;all other outcome types.</li>
</ul>
</section>
<section id="exploring-distributions-of-variables-of-interest" class="level2">
<h2 class="anchored" data-anchor-id="exploring-distributions-of-variables-of-interest">Exploring distributions of variables of interest</h2>
<section id="animal-type" class="level3">
<h3 class="anchored" data-anchor-id="animal-type">Animal type</h3>
<p>Let’s first check the levels of the variable <code>animal_type</code> and their count, and consider possible lumping strategies.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>longbeach <span class="sc">%&gt;%</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(animal_type)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 2
   animal_type     n
   &lt;fct&gt;       &lt;int&gt;
 1 amphibian       3
 2 bird         2075
 3 cat         14145
 4 dog          9768
 5 guinea pig    172
 6 livestock      10
 7 other        1332
 8 rabbit        526
 9 reptile       344
10 wild         1412</code></pre>
</div>
</div>
<p>While it is possible that we would use lumping immediately to identify the most frequent animal types (either by fixed number of levels or proportion of the level vs.&nbsp;total count), we can also merge them manually based on reasoning and context.</p>
<p>It was reasonable to expect that cats and dogs will be the most prevalent categories. They are followed by birds. Category “wild” follows and category “other” is tightly behind. It seems legitimate to keep these levels as they are at this point. Rabbits and guinea pigs could be collapsed into category “Small mammals”. Reptiles and amphibians could be collapsed into “Exotic”, a type frequently used by shelters, pet stores etc. Livestock can definitely be merged with other, considering the group size of the livestock.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>longbeach <span class="ot">&lt;-</span> longbeach <span class="sc">%&gt;%</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">animal_type =</span> <span class="fu">fct_collapse</span>(animal_type,</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">Dogs =</span> <span class="st">"dog"</span>,</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">Cats =</span> <span class="st">"cat"</span>,</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">Birds =</span> <span class="st">"bird"</span>,</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">Wildlife =</span> <span class="st">"wild"</span>,</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">`</span><span class="at">Small mammals</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"rabbit"</span>, <span class="st">"guinea pig"</span>),</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">Exotic =</span> <span class="fu">c</span>(<span class="st">"reptile"</span>,<span class="st">"amphibian"</span>),</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">Other =</span> <span class="fu">c</span>(<span class="st">"other"</span>, <span class="st">"livestock"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>These are the categories that we will work with throughout EDA. I can anticipate that perhaps only dogs and cats will be features in the regression models due to significant discrepancy in sub-sample size of these two categories, compared to smaller ones such as birds, wildlife etc. Dataset documentation does not provide precise information about the group “Other”. It is probable that various different species are included in this type.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>longbeach <span class="sc">%&gt;%</span> </span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(animal_type, <span class="at">sort =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"Animal type"</span>, <span class="st">"Number of animals"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">Animal type</th>
<th style="text-align: right;">Number of animals</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Cats</td>
<td style="text-align: right;">14145</td>
</tr>
<tr class="even">
<td style="text-align: left;">Dogs</td>
<td style="text-align: right;">9768</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Birds</td>
<td style="text-align: right;">2075</td>
</tr>
<tr class="even">
<td style="text-align: left;">Wildlife</td>
<td style="text-align: right;">1412</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Other</td>
<td style="text-align: right;">1342</td>
</tr>
<tr class="even">
<td style="text-align: left;">Small mammals</td>
<td style="text-align: right;">698</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Exotic</td>
<td style="text-align: right;">347</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>We can use this variable for some basic distribution/count visualisation now.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>longbeach <span class="sc">%&gt;%</span> </span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(animal_type) <span class="sc">%&gt;%</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">animal_type =</span> <span class="fu">fct_reorder</span>(animal_type, n)) <span class="sc">%&gt;%</span> </span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> animal_type, <span class="at">y =</span> n, <span class="at">fill =</span> animal_type)) <span class="sc">+</span> </span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>() <span class="sc">+</span> </span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span> </span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span> </span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="st">"Number of animals"</span>, <span class="at">title =</span> <span class="st">"Number of animals taken in by animal type (Long Beach Animal Shelter, 2017–2024)"</span>, <span class="at">caption =</span> <span class="st">"Small mammals include rabbits and guneia pigs. Exotic includes reptiles and amphibians."</span>, <span class="at">fill =</span> <span class="st">"Animal type"</span>) <span class="sc">+</span> </span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">15000</span>,<span class="dv">2500</span>)) <span class="sc">+</span> </span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_paletteer_d</span>(<span class="st">"ggthemes::Tableau_10"</span>) <span class="sc">+</span></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title.position =</span> <span class="st">"plot"</span>,</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="sc">-</span><span class="fl">0.5</span>),</span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position=</span><span class="st">"none"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="lbas_eda_reg_likar_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>We can play around a little bit and try so called “lollipop” visualization, as it has been said to be a more modern, appealing version of bar charts.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>longbeach <span class="sc">%&gt;%</span> </span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(animal_type) <span class="sc">%&gt;%</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">animal_type =</span> <span class="fu">fct_reorder</span>(animal_type, n)) <span class="sc">%&gt;%</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> n, <span class="at">y =</span> animal_type)) <span class="sc">+</span> </span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">xend =</span> n, <span class="at">yend =</span> animal_type, <span class="at">color =</span> animal_type), <span class="at">linewidth =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> animal_type), <span class="at">size =</span> <span class="dv">10</span>) <span class="sc">+</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> n), <span class="at">color =</span> <span class="st">"#313131"</span>, <span class="at">size =</span> <span class="fl">2.5</span>) <span class="sc">+</span> </span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="cn">NULL</span>, <span class="at">x =</span> <span class="st">"Number of animals"</span>, <span class="at">title =</span> <span class="st">"Number of animals taken in by animal type (Long Beach Animal Shelter, 2017–2024)"</span>, <span class="at">caption =</span> <span class="st">"Small mammals include rabbits and guneia pigs. Exotic includes reptiles and amphibians."</span>, <span class="at">fill =</span> <span class="st">"Animal type"</span>) <span class="sc">+</span> </span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">15000</span>,<span class="dv">2500</span>)) <span class="sc">+</span> </span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title.position =</span> <span class="st">"plot"</span>,</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="sc">-</span><span class="fl">0.5</span>),</span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position=</span><span class="st">"none"</span>) <span class="sc">+</span> </span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_paletteer_d</span>(<span class="st">"ggthemes::Tableau_10"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="lbas_eda_reg_likar_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>I want to play around with different visualizations a bit and thought that while bar chart might be very simple to read and informative for both an advanced as well as lay reader, I can try out treemaps.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>longbeach <span class="sc">%&gt;%</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(animal_type) <span class="sc">%&gt;%</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">label_size =</span> <span class="fu">rescale</span>(n, <span class="at">to =</span> <span class="fu">c</span>(<span class="dv">6</span>, <span class="dv">55</span>))) <span class="sc">%&gt;%</span>  <span class="co"># scale size between 3 and 8</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">area =</span> n, <span class="at">fill =</span> animal_type, <span class="at">label =</span> <span class="fu">paste0</span>(animal_type, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>, n))) <span class="sc">+</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_treemap</span>() <span class="sc">+</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_treemap_text</span>(<span class="fu">aes</span>(<span class="at">size =</span> label_size), <span class="at">colour =</span> <span class="st">"#474747"</span>, <span class="at">place =</span> <span class="st">"centre"</span>, <span class="at">grow =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_size_identity</span>() <span class="sc">+</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_paletteer_d</span>(<span class="st">"ggthemes::Tableau_10"</span>) <span class="sc">+</span> </span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Number of animals taken in by animal type </span><span class="sc">\n</span><span class="st">(Long Beach Animal Shelter, 2017–2024)"</span>, <span class="at">subtitle =</span> <span class="st">"Area of each type represents proportion of the total intake."</span>, <span class="at">caption =</span> <span class="st">"Small mammals include rabbits and guneia pigs. Exotic includes reptiles and amphibians."</span>) <span class="sc">+</span></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span> </span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title.position =</span> <span class="st">"plot"</span>,</span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.05</span>),</span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position=</span><span class="st">"none"</span></span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>        ) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="lbas_eda_reg_likar_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>  <span class="co">#coord_fixed(1)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Fine for now. We can always return to these graphs and polish the appearance. We can now apply the same logic to investigate other variables!</p>
</section>
<section id="intake-condition" class="level3">
<h3 class="anchored" data-anchor-id="intake-condition">Intake condition</h3>
<p>Let’s first check the levels of the variable <code>intake_condition</code> and their count, and consider possible lumping strategies.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>longbeach <span class="sc">%&gt;%</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(intake_condition, <span class="at">sort =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 17 × 2
   intake_condition       n
   &lt;fct&gt;              &lt;int&gt;
 1 normal             13706
 2 under age/weight    6590
 3 injured  severe     2097
 4 ill severe          1311
 5 ill mild            1192
 6 injured  moderate   1177
 7 injured  mild       1093
 8 ill moderatete       942
 9 fractious            654
10 feral                283
11 i/i report           249
12 aged                 156
13 behavior  moderate   127
14 behavior  severe      70
15 welfare seizures      70
16 behavior  mild        69
17 intakeexam             1</code></pre>
</div>
</div>
<p>Huh, alright, there are 17 different conditions. It appears that we could collapse illness and injury together in “physical condition”. Let’s explore lumping a bit, with fixed number of categories and proportions of total sample.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Fixed number of categories</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>longbeach <span class="sc">%&gt;%</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">intake_condition =</span> <span class="fu">fct_lump</span>(intake_condition, <span class="at">n =</span> <span class="dv">10</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(intake_condition, <span class="at">sort =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 11 × 2
   intake_condition      n
   &lt;fct&gt;             &lt;int&gt;
 1 normal            13706
 2 under age/weight   6590
 3 injured  severe    2097
 4 ill severe         1311
 5 ill mild           1192
 6 injured  moderate  1177
 7 injured  mild      1093
 8 ill moderatete      942
 9 Other               742
10 fractious           654
11 feral               283</code></pre>
</div>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Number of categories based on proportions</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>longbeach <span class="sc">%&gt;%</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">intake_condition =</span> <span class="fu">fct_lump</span>(intake_condition, <span class="at">prop =</span> .<span class="dv">03</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(intake_condition, <span class="at">sort =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 9 × 2
  intake_condition      n
  &lt;fct&gt;             &lt;int&gt;
1 normal            13706
2 under age/weight   6590
3 injured  severe    2097
4 Other              1679
5 ill severe         1311
6 ill mild           1192
7 injured  moderate  1177
8 injured  mild      1093
9 ill moderatete      942</code></pre>
</div>
</div>
<p><strong>Based on category inspection I decided the following:</strong></p>
<ul>
<li>Merge illness and injury in “physical” category</li>
<li>I am also considering joining with behavioral (mild, moderate, severe) or collapsing these categories into “other” as the number of observations is really small</li>
<li>There seem to be some specific smaller categories (aged, welfare seizures etc.), which will be collapsed into “other”.</li>
</ul>
<p>We need to collapse the categories manually.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>longbeach <span class="ot">&lt;-</span> longbeach <span class="sc">%&gt;%</span> </span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">intake_condition =</span> <span class="fu">fct_lump</span>(intake_condition, <span class="dv">10</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">intake_condition =</span> <span class="fu">fct_collapse</span>(intake_condition,</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">Normal =</span> <span class="st">"normal"</span>,</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>                                         <span class="st">`</span><span class="at">Mild physical</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"ill mild"</span>, <span class="st">"injured  mild"</span>),</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>                                         <span class="st">`</span><span class="at">Moderate physical</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"ill moderatete"</span>, <span class="st">"injured  moderate"</span>),</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>                                         <span class="st">`</span><span class="at">Severe physical</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"ill severe"</span>, <span class="st">"injured  severe"</span>),</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>                                         <span class="st">`</span><span class="at">Under age/weight</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"under age/weight"</span>,,</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">other_level =</span> <span class="st">"Other"</span>))</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>longbeach <span class="sc">%&gt;%</span> </span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(intake_condition, <span class="at">sort =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"Intake condition"</span>, <span class="st">"Number of animals"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">Intake condition</th>
<th style="text-align: right;">Number of animals</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Normal</td>
<td style="text-align: right;">13706</td>
</tr>
<tr class="even">
<td style="text-align: left;">Under age/weight</td>
<td style="text-align: right;">6590</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Severe physical</td>
<td style="text-align: right;">3408</td>
</tr>
<tr class="even">
<td style="text-align: left;">Mild physical</td>
<td style="text-align: right;">2285</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Moderate physical</td>
<td style="text-align: right;">2119</td>
</tr>
<tr class="even">
<td style="text-align: left;">Other</td>
<td style="text-align: right;">1679</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>First, I will specify colors associated with each category, so they remain the same throughout visualizations.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>intake_colors <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Normal"</span> <span class="ot">=</span> <span class="st">"#77b7b2"</span>,</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Mild physical"</span> <span class="ot">=</span> <span class="st">"#ebcb2a"</span>,</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Moderate physical"</span> <span class="ot">=</span> <span class="st">"#f28d2b"</span>,</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Severe physical"</span> <span class="ot">=</span> <span class="st">"#e15859"</span>,</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Under age/weight"</span> <span class="ot">=</span> <span class="st">"#c8868d"</span>,</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Other"</span> <span class="ot">=</span> <span class="st">"#cbc8c5"</span></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s now use same visualizations as before for <code>animal_type</code> to plot distribution of <code>intake_condition</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>longbeach <span class="sc">%&gt;%</span> </span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(intake_condition) <span class="sc">%&gt;%</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">intake_condition =</span> <span class="fu">fct_reorder</span>(intake_condition, n)) <span class="sc">%&gt;%</span> </span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> intake_condition, <span class="at">y =</span> n, <span class="at">fill =</span> intake_condition)) <span class="sc">+</span> </span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>() <span class="sc">+</span> </span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span> </span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span> </span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Intake condition"</span>, <span class="at">y =</span> <span class="st">"Number of animals"</span>, <span class="at">title =</span> <span class="st">"Number of animals taken in, by intake condition </span><span class="sc">\n</span><span class="st">(Long Beach Animal Shelter, 2017–2024)"</span>, <span class="at">caption =</span> <span class="st">"Physical conditions include illnesses and injuries."</span>, <span class="at">fill =</span> <span class="st">"Intake condition"</span>) <span class="sc">+</span> </span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">15000</span>,<span class="dv">2500</span>)) <span class="sc">+</span> </span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> intake_colors) <span class="sc">+</span></span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title.position =</span> <span class="st">"plot"</span>,</span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="sc">-</span><span class="fl">0.3</span>),</span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position=</span><span class="st">"none"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="lbas_eda_reg_likar_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>We can play around a little bit and try so called “lollipop” visualization.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>longbeach <span class="sc">%&gt;%</span> </span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(intake_condition) <span class="sc">%&gt;%</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">intake_condition =</span> <span class="fu">fct_reorder</span>(intake_condition, n)) <span class="sc">%&gt;%</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> n, <span class="at">y =</span> intake_condition)) <span class="sc">+</span> </span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">xend =</span> n, <span class="at">yend =</span> intake_condition, <span class="at">color =</span> intake_condition), <span class="at">linewidth =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> intake_condition), <span class="at">size =</span> <span class="dv">11</span>) <span class="sc">+</span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> n), <span class="at">color =</span> <span class="st">"#313131"</span>,  <span class="at">size =</span> <span class="fl">2.5</span>) <span class="sc">+</span> </span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="cn">NULL</span>, <span class="at">x =</span> <span class="st">"Number of animals"</span>, <span class="at">title =</span> <span class="st">"Number of animals taken in, by intake condition </span><span class="sc">\n</span><span class="st">(Long Beach Animal Shelter, 2017–2024)"</span>, <span class="at">caption =</span> <span class="st">"Physical conditions include illnesses and injuries."</span>, <span class="at">fill =</span> <span class="st">"Animal type"</span>) <span class="sc">+</span> </span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">15000</span>,<span class="dv">5000</span>)) <span class="sc">+</span> </span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title.position =</span> <span class="st">"plot"</span>,</span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="sc">-</span><span class="fl">0.3</span>),</span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position=</span><span class="st">"none"</span>) <span class="sc">+</span> </span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> intake_colors)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="lbas_eda_reg_likar_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Let’s play around with treemap again a little bit.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>longbeach <span class="sc">%&gt;%</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(intake_condition) <span class="sc">%&gt;%</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">label_size =</span> <span class="fu">rescale</span>(n, <span class="at">to =</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">40</span>))) <span class="sc">%&gt;%</span>  <span class="co"># scale size between 3 and 8</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">area =</span> n, <span class="at">fill =</span> intake_condition, <span class="at">label =</span> <span class="fu">paste0</span>(intake_condition, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>, n))) <span class="sc">+</span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_treemap</span>() <span class="sc">+</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_treemap_text</span>(<span class="fu">aes</span>(<span class="at">size =</span> label_size), <span class="at">colour =</span> <span class="st">"#474747"</span>, <span class="at">place =</span> <span class="st">"centre"</span>, <span class="at">grow =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_size_identity</span>() <span class="sc">+</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> intake_colors) <span class="sc">+</span> </span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Number of animals taken in, by intake condition </span><span class="sc">\n</span><span class="st">(Long Beach Animal Shelter, 2017–2024)"</span>, <span class="at">subtitle =</span> <span class="st">"Area of each intake condition represents proportion of the total intake."</span>, <span class="at">caption =</span> <span class="st">"Physical conditions include illnesses and injuries."</span>) <span class="sc">+</span></span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span> </span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title.position =</span> <span class="st">"plot"</span>,</span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.05</span>),</span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position=</span><span class="st">"none"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="lbas_eda_reg_likar_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>From these plots we can see that the majority of the animals taken into the Long Beach Animal Shelter are in normal physical condition. About half less is animals that are under age or under weight. This is roughly compared to all three categories of hindered physical condition combined - mild, moderate, severe. <em>At this point I start thinking that intake condition might be an interesting predictor in the regression models. At this point we can plot <code>animal_type</code> and <code>intake_condition</code> together and explore in what conditions are different animals usually taken into the shelter.</em></p>
<section id="combining-animal-type-and-intake-condition" class="level4">
<h4 class="anchored" data-anchor-id="combining-animal-type-and-intake-condition">Combining animal type and intake condition</h4>
<p>For each type of animal, what number/proportion of them arrived in each intake condition?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>longbeach <span class="sc">%&gt;%</span> </span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">animal_type =</span> <span class="fu">fct_relevel</span>(animal_type, <span class="st">"Other"</span>, <span class="st">"Wildlife"</span>, <span class="st">"Exotic"</span>, <span class="st">"Small mammals"</span>, <span class="st">"Birds"</span>, <span class="st">"Dogs"</span>, <span class="st">"Cats"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">intake_condition =</span> <span class="fu">fct_relevel</span>(</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>  intake_condition,</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Other"</span>,</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Severe physical"</span>,</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Moderate physical"</span>,</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Mild physical"</span>,</span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Under age/weight"</span>,</span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Normal"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> animal_type, <span class="at">fill =</span> intake_condition)) <span class="sc">+</span> </span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>() <span class="sc">+</span> </span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span> </span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Animal type"</span>, </span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Number of animals"</span>,</span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Number of animals with different intake conditions for each animal type </span><span class="sc">\n</span><span class="st">(Long Beach Animal Shelter, 2017–2024)"</span>,</span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">"Intake condition"</span>) <span class="sc">+</span> </span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> intake_colors, <span class="at">guide =</span> <span class="fu">guide_legend</span>(<span class="at">reverse =</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="lbas_eda_reg_likar_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>This visualization is informative about absolute number of observations of each intake condition for different animal types. We again see that cats, followed by dogs dominate in overall number of intakes. Interesting observation is that there is quite a large proportion of cats taken in under-aged or under-weight condition. Majority of dogs on the other hand appear to be accepted in normal condition. It might also be good to visualize proportions within each group, to get an insight into more specific between-animal type differences, that might remain hidden in column-plotting with noticeable differences in total number of observations between the groups.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>longbeach <span class="sc">%&gt;%</span> </span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(animal_type <span class="sc">!=</span> <span class="st">"livestock"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">animal_type =</span> <span class="fu">fct_relevel</span>(animal_type, <span class="st">"Other"</span>, <span class="st">"Wildlife"</span>, <span class="st">"Exotic"</span>, <span class="st">"Small mammals"</span>, <span class="st">"Birds"</span>, <span class="st">"Dogs"</span>, <span class="st">"Cats"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">intake_condition =</span> <span class="fu">fct_relevel</span>(</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>  intake_condition,</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Severe physical"</span>,</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Moderate physical"</span>,</span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Mild physical"</span>,</span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Other"</span>,</span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Under age/weight"</span>,</span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Normal"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> animal_type, <span class="at">fill =</span> intake_condition)) <span class="sc">+</span> </span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="st">"fill"</span>) <span class="sc">+</span> </span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span> </span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Animal type"</span>, </span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Proportion of the specific intake condition (%)"</span>,</span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Proportion of specific intake condition for each animal type </span><span class="sc">\n</span><span class="st">(Long Beach Animal Shelter, 2017–2024)"</span>,</span>
<span id="cb42-18"><a href="#cb42-18" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">"Intake condition"</span>) <span class="sc">+</span> </span>
<span id="cb42-19"><a href="#cb42-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span> </span>
<span id="cb42-20"><a href="#cb42-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(</span>
<span id="cb42-21"><a href="#cb42-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">labels =</span> <span class="fu">label_percent</span>(), </span>
<span id="cb42-22"><a href="#cb42-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.2</span>)) <span class="sc">+</span> </span>
<span id="cb42-23"><a href="#cb42-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> intake_colors, <span class="at">guide =</span> <span class="fu">guide_legend</span>(<span class="at">reverse =</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="lbas_eda_reg_likar_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>OK, let’s try a slightly different approach and tweak the plot by adding percentage scale on both side of the axis, order animal types based on percentage of normal intake condition and add total number of counts next to animal names.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's first pull the order of the names by proportion of normal intake condition - I tried doing it in the same pipeline, but it does not work</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>animal_order <span class="ot">&lt;-</span> longbeach <span class="sc">%&gt;%</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(animal_type, intake_condition) <span class="sc">%&gt;%</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(animal_type) <span class="sc">%&gt;%</span></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">type_n =</span> <span class="fu">sum</span>(n),</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">p =</span> n <span class="sc">/</span> <span class="fu">sum</span>(n),</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">animal_type_lab =</span> <span class="fu">paste0</span>(animal_type, <span class="st">" ("</span>, type_n, <span class="st">")"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(intake_condition <span class="sc">==</span> <span class="st">"Normal"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(p) <span class="sc">%&gt;%</span></span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(animal_type_lab)</span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a>longbeach <span class="sc">%&gt;%</span> </span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(animal_type, intake_condition) <span class="sc">%&gt;%</span></span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(animal_type) <span class="sc">%&gt;%</span></span>
<span id="cb43-18"><a href="#cb43-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">type_n =</span> <span class="fu">sum</span>(n)) <span class="sc">%&gt;%</span></span>
<span id="cb43-19"><a href="#cb43-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb43-20"><a href="#cb43-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">animal_type_lab =</span> <span class="fu">paste0</span>(animal_type, <span class="st">" ("</span>, type_n, <span class="st">")"</span>),</span>
<span id="cb43-21"><a href="#cb43-21" aria-hidden="true" tabindex="-1"></a>         <span class="at">animal_type_lab =</span> <span class="fu">factor</span>(animal_type_lab, <span class="at">levels =</span> animal_order),</span>
<span id="cb43-22"><a href="#cb43-22" aria-hidden="true" tabindex="-1"></a>         <span class="at">intake_condition =</span> <span class="fu">fct_relevel</span>(intake_condition,</span>
<span id="cb43-23"><a href="#cb43-23" aria-hidden="true" tabindex="-1"></a>                                        <span class="st">"Severe physical"</span>,</span>
<span id="cb43-24"><a href="#cb43-24" aria-hidden="true" tabindex="-1"></a>                                        <span class="st">"Moderate physical"</span>,</span>
<span id="cb43-25"><a href="#cb43-25" aria-hidden="true" tabindex="-1"></a>                                        <span class="st">"Mild physical"</span>,</span>
<span id="cb43-26"><a href="#cb43-26" aria-hidden="true" tabindex="-1"></a>                                        <span class="st">"Other"</span>,</span>
<span id="cb43-27"><a href="#cb43-27" aria-hidden="true" tabindex="-1"></a>                                        <span class="st">"Under age/weight"</span>,</span>
<span id="cb43-28"><a href="#cb43-28" aria-hidden="true" tabindex="-1"></a>                                        <span class="st">"Normal"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb43-29"><a href="#cb43-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> animal_type_lab, <span class="at">y =</span> n, <span class="at">fill =</span> intake_condition)) <span class="sc">+</span> </span>
<span id="cb43-30"><a href="#cb43-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">position =</span> <span class="st">"fill"</span>) <span class="sc">+</span> </span>
<span id="cb43-31"><a href="#cb43-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span> </span>
<span id="cb43-32"><a href="#cb43-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Animal type"</span>, </span>
<span id="cb43-33"><a href="#cb43-33" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Proportion of the specific intake condition (%)"</span>,</span>
<span id="cb43-34"><a href="#cb43-34" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Proportion of specific intake condition for each animal type </span><span class="sc">\n</span><span class="st">(Long Beach Animal Shelter, 2017–2024)"</span>, <span class="at">subtitle =</span> <span class="st">"Numbers next to the animal types represent number of individuals from that group."</span>,</span>
<span id="cb43-35"><a href="#cb43-35" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">"Intake condition"</span>) <span class="sc">+</span> </span>
<span id="cb43-36"><a href="#cb43-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span> </span>
<span id="cb43-37"><a href="#cb43-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(</span>
<span id="cb43-38"><a href="#cb43-38" aria-hidden="true" tabindex="-1"></a>  <span class="at">labels =</span> <span class="fu">label_percent</span>(), </span>
<span id="cb43-39"><a href="#cb43-39" aria-hidden="true" tabindex="-1"></a>  <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.2</span>),</span>
<span id="cb43-40"><a href="#cb43-40" aria-hidden="true" tabindex="-1"></a>  <span class="at">sec.axis =</span> <span class="fu">dup_axis</span>(<span class="at">labels =</span> <span class="fu">label_percent</span>(), <span class="at">name =</span> <span class="cn">NULL</span>)) <span class="sc">+</span> </span>
<span id="cb43-41"><a href="#cb43-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> intake_colors, <span class="at">guide =</span> <span class="fu">guide_legend</span>(<span class="at">reverse =</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="lbas_eda_reg_likar_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Considering this visualization, there are few things we can think about:</strong></p>
<ul>
<li>It seems that exotic animals and small mammals usually arrive/are accepted in normal condition. Possibly as they might escape from home for a short while and are registered into the system upon arrival, however owners potentially pick them up soon. Thus these are not animals that would linger the streets for a long time.</li>
<li>Dogs are admitted to the shelter in normal condition much more frequently compared to cats.</li>
<li>Cats have a really high proportion of under-aged or under-weight intakes. It is possible, that stray cats give birth prematurely more often compared to dogs. On the other hand, it is possible that survival on the streets is the hardest for cats, thus leaving a lot of members of the stray cat community under-fed and under-weight.</li>
<li>Birds and wildlife have high proportion of (severe) physical conditions. Perhaps a lot of members of these groups arrive to the shelter because of the injury in the first place. It is possible that wild animals roam into urban environment or that birds have all sorts of accidents and are then brought to the shelter in injured condition by the members of the community or taken in by members of the shelter.</li>
</ul>
</section>
</section>
<section id="intake-type" class="level3">
<h3 class="anchored" data-anchor-id="intake-type">Intake type</h3>
<p>Based on the points raised in the end of the previous section, we can consider looking into <code>intake_type</code> variable.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>longbeach <span class="sc">%&gt;%</span> </span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(intake_type, <span class="at">sort =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"Intake type"</span>, <span class="st">"Number of animals"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">Intake type</th>
<th style="text-align: right;">Number of animals</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">stray</td>
<td style="text-align: right;">21126</td>
</tr>
<tr class="even">
<td style="text-align: left;">wildlife</td>
<td style="text-align: right;">4473</td>
</tr>
<tr class="odd">
<td style="text-align: left;">owner surrender</td>
<td style="text-align: right;">2615</td>
</tr>
<tr class="even">
<td style="text-align: left;">welfare seized</td>
<td style="text-align: right;">484</td>
</tr>
<tr class="odd">
<td style="text-align: left;">confiscate</td>
<td style="text-align: right;">399</td>
</tr>
<tr class="even">
<td style="text-align: left;">return</td>
<td style="text-align: right;">306</td>
</tr>
<tr class="odd">
<td style="text-align: left;">quarantine</td>
<td style="text-align: right;">162</td>
</tr>
<tr class="even">
<td style="text-align: left;">safe keep</td>
<td style="text-align: right;">130</td>
</tr>
<tr class="odd">
<td style="text-align: left;">trap, neuter, return</td>
<td style="text-align: right;">73</td>
</tr>
<tr class="even">
<td style="text-align: left;">euthenasia required</td>
<td style="text-align: right;">15</td>
</tr>
<tr class="odd">
<td style="text-align: left;">adopted animal return</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: left;">foster</td>
<td style="text-align: right;">2</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Majority of the animals are either stray or come from wildlife, and a noticeable number of animals being surrendered by the owner. Due to highly unbalanced groups, I will not explore this variable in depths for now, will just check the count for each type of intake for different types of animals and visualize it.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>longbeach <span class="sc">%&gt;%</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(animal_type, intake_type) <span class="sc">%&gt;%</span></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">animal_type =</span> <span class="fu">fct_relevel</span>(animal_type,</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">"Cats"</span>, <span class="st">"Dogs"</span>, <span class="st">"Small mammals"</span>, <span class="st">"Exotic"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(animal_type, n, <span class="at">fill =</span> intake_type) <span class="sc">%&gt;%</span></span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">position =</span> <span class="st">"fill"</span>) <span class="sc">+</span> </span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span> </span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> <span class="fu">label_percent</span>()) <span class="sc">+</span> </span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Proportion of animals"</span>, <span class="at">x =</span> <span class="st">"Animal type"</span>, <span class="at">fill =</span> <span class="st">"Intake type"</span>, <span class="at">title =</span> <span class="st">"Proportion of animals by different intake types for each type of animal </span><span class="sc">\n</span><span class="st">(Long Beach Animal Shelter, 2017–2024)"</span>) <span class="sc">+</span> </span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_paletteer_d</span>(<span class="st">"ggthemes::Classic_Green_Orange_12"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="lbas_eda_reg_likar_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Majority of dogs and cats in particular are stray animals and a noticeable percentage of animals in those groups coming by owner’s surrender. Birds, wildlife and other species are predominantly found in wild life, and presumably injured or ill, as discussed in the end of the previous section.</p>
</section>
<section id="sex" class="level3">
<h3 class="anchored" data-anchor-id="sex">Sex</h3>
<p>Let’s now proceed with the <code>sex</code> variable. During initial data inspection, I noticed that there are not only sex information, but also whether animal was neutered/spayed (sterilized) and is thus not sexually active/capable of reproduction anymore. As I am seriously considering modeling adoption rate in regression models, this information might be valuable. Let’s first look into the variable, mutate it and visualize.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>longbeach <span class="sc">%&gt;%</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(sex) <span class="sc">%&gt;%</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"Sex"</span>, <span class="st">"Number of animals"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">Sex</th>
<th style="text-align: right;">Number of animals</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Female</td>
<td style="text-align: right;">6230</td>
</tr>
<tr class="even">
<td style="text-align: left;">Male</td>
<td style="text-align: right;">6854</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Neutered</td>
<td style="text-align: right;">5588</td>
</tr>
<tr class="even">
<td style="text-align: left;">Spayed</td>
<td style="text-align: right;">4763</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Unknown</td>
<td style="text-align: right;">6352</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>OK, I will leave category Unknown as it is. Then, I will split the original <code>sex</code> variable into two, one about sex and one about sterilization status. From the meaning of the words, we can infer then when the condition is “Neutered” it refers to the male, and when the condition is “Spayed”, it refers to the females. After looking into online forum discussion and “consulting” various AIs, I concluded that when reproductive status is listed, we can infer the sex. When it is not, we can conclude that the reproductive state is intact and biological sex is listed.</p>
<p>Based on this I will create binary variable <code>starilised</code>, which will be 1 if current <code>sex</code> is “Spayed” or “Neutered” and 0 if biological sex is listed. I will recode values in the original <code>sex</code> category to only include information about biological sex.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>longbeach <span class="ot">&lt;-</span> longbeach <span class="sc">%&gt;%</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sterilised =</span> <span class="fu">case_when</span>(sex <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Spayed"</span>, <span class="st">"Neutered"</span>) <span class="sc">~</span> <span class="st">"Yes"</span>,</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>                                sex <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Male"</span>, <span class="st">"Female"</span>) <span class="sc">~</span> <span class="st">"No"</span>,</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>                                sex <span class="sc">==</span> <span class="st">"Unknown"</span> <span class="sc">~</span> <span class="st">"Unknown"</span>),</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">sex =</span> <span class="fu">case_when</span>(sex <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Spayed"</span>, <span class="st">"Female"</span>) <span class="sc">~</span> <span class="st">"Female"</span>,</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>                                sex <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Male"</span>, <span class="st">"Neutered"</span>) <span class="sc">~</span> <span class="st">"Male"</span>,</span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>                                sex <span class="sc">==</span> <span class="st">"Unknown"</span> <span class="sc">~</span> <span class="st">"Unknown"</span>))</span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>longbeach <span class="sc">%&gt;%</span></span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(sex, sterilised) <span class="sc">%&gt;%</span></span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(sex, n, <span class="at">fill =</span> sterilised) <span class="sc">+</span> </span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a>  <span class="co">#geom_col(position = "dodge") +</span></span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">position =</span> <span class="st">"fill"</span>) <span class="sc">+</span> </span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> <span class="fu">label_percent</span>()) <span class="sc">+</span> </span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Sex"</span>, <span class="at">y =</span> <span class="st">"Number of animals"</span>, <span class="at">fill =</span> <span class="st">"Sterilised"</span>, <span class="at">title =</span> <span class="st">"NUmber of sterilised and unstarilised animals by sex </span><span class="sc">\n</span><span class="st">(Long Beach Animal Shelter, 2017–2024)"</span>) <span class="sc">+</span> </span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span> </span>
<span id="cb47-17"><a href="#cb47-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_pomological</span>() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="lbas_eda_reg_likar_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>longbeach <span class="sc">%&gt;%</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(sex, sterilised) <span class="sc">%&gt;%</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"Sex"</span>, <span class="st">"Sterilised"</span>, <span class="st">"Number of animals"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">Sex</th>
<th style="text-align: left;">Sterilised</th>
<th style="text-align: right;">Number of animals</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Female</td>
<td style="text-align: left;">No</td>
<td style="text-align: right;">6230</td>
</tr>
<tr class="even">
<td style="text-align: left;">Female</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: right;">4763</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Male</td>
<td style="text-align: left;">No</td>
<td style="text-align: right;">6854</td>
</tr>
<tr class="even">
<td style="text-align: left;">Male</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: right;">5588</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Unknown</td>
<td style="text-align: left;">Unknown</td>
<td style="text-align: right;">6352</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Using the proportion graph, we can see that approximately equal proportion (cca. 43%) of both biological sexes is sterilized. From the count/column graph, we can see that males are more frequently taken in at the animal shelter. 6352 animals have unknown sex and/or sterilization status.</p>
<p>At this point we could plot <code>sex</code> and <code>sterilisation</code> in association with previously handled variables - <code>intake_condition</code> and <code>animal_type</code>. I will select only one at this point and then move on to the other variables. I choose <code>animal_type</code> to see whether animals, especially the most frequent ones, differ in their sterilization rate and sex. I will focus on proportions, as we have clearly established thus far that dogs and cats are by far the most dominant animal types and visualization of other types besides them is much more informative in proportions.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>longbeach <span class="sc">%&gt;%</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(animal_type, sex) <span class="sc">%&gt;%</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(animal_type, n, <span class="at">fill =</span> sex) <span class="sc">%&gt;%</span></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">position =</span> <span class="st">"fill"</span>) <span class="sc">+</span> </span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>  <span class="co">#geom_col() + </span></span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> <span class="fu">label_percent</span>()) <span class="sc">+</span> </span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span> </span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Proportion of animals"</span>, <span class="at">x =</span> <span class="st">"Animal type"</span>, <span class="at">fill =</span> <span class="st">"Sex"</span>, <span class="at">title =</span> <span class="st">"Proportion of different sexes for each type of animal </span><span class="sc">\n</span><span class="st">(Long Beach Animal Shelter, 2017–2024)"</span>) <span class="sc">+</span> </span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_pomological</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="lbas_eda_reg_likar_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>We can see that in exotic animals, birds, wildlife and others, very high proportion of those groups have unknown sex. It seems reasonable to assume that this could happen due to accurate genitalia identification being much more difficult in these groups, compared to cats, dogs and small mammals. In those groups, male and female sex appear to be approximately balanced. About 10% of cats and small mammals have unknown sex. About 60% of dogs are males and the rest are mostly females and unknown representatives in very small percentage.</p>
<p>Let’s look at <code>sterilised</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>longbeach <span class="sc">%&gt;%</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(animal_type, sterilised) <span class="sc">%&gt;%</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(animal_type, n, <span class="at">fill =</span> sterilised) <span class="sc">%&gt;%</span></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">position =</span> <span class="st">"fill"</span>) <span class="sc">+</span> </span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>  <span class="co">#geom_col() + </span></span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> <span class="fu">label_percent</span>()) <span class="sc">+</span> </span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span> </span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Proportion of animals"</span>, <span class="at">x =</span> <span class="st">"Animal type"</span>, <span class="at">fill =</span> <span class="st">"Sterilised"</span>, <span class="at">title =</span> <span class="st">"Proportion of sterilised individuals for each type of animal </span><span class="sc">\n</span><span class="st">(Long Beach Animal Shelter, 2017–2024)"</span>) <span class="sc">+</span></span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_pomological</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="lbas_eda_reg_likar_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>High percentage of individuals with unknown sterilization status in exotic, birds, wildlife and other could be expected. We have seen in previous analysis that a noticeable proportion of those animals are wild animals, thus there is probably no record kept about their sterilization status. Additionally, as mentioned before identification of genitalia and related markers is much more difficult in these species. For cats, dogs and small mammals, sterilization rate is around 40-50%. We can infer some information from this.</p>
<p>If animals have already been taken to a shelter before, they were most likely sterilized, as this is a standard procedure during the capture and stay. While approximately a half of the animals therefore seem to have been captured before, or surrendered/escaped by/from the owner, who put them through the procedure, about the half of these animals have not been sterilized, implying this is their first time in the shelter and are arguably very young.</p>
<p><em>in case data is overwritten, copy here</em></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co">#longbeach_after_sex &lt;- longbeach</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="co">#longbeach &lt;- longbeach_after_sex</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="outcome-type" class="level3">
<h3 class="anchored" data-anchor-id="outcome-type">Outcome type</h3>
<p>I will proceed to the next variable, <code>outcome_type</code>. Let’s see what are the levels of the variable and how we could collapse, lump them.</p>
<p>I decide for keeping all the outcomes that are at least 2.5% of the complete sample and lump others. In case of condition “shelter, neuter, return” I am not completely sure what it means as different webpages have different interpretations depending on the context. I will therefore collapse this category with “others”.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>longbeach <span class="ot">&lt;-</span> longbeach <span class="sc">%&gt;%</span> </span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">outcome_type =</span> <span class="fu">fct_lump</span>(outcome_type,  <span class="at">prop =</span> .<span class="dv">025</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">outcome_type =</span> <span class="fu">fct_collapse</span>(outcome_type,</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">Adoption =</span> <span class="st">"adoption"</span>,</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">Rescue =</span> <span class="st">"rescue"</span>,</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>                                     <span class="st">`</span><span class="at">Return to owner</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"return to owner"</span>,</span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">Euthanasia =</span> <span class="st">"euthanasia"</span>,</span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">Died =</span> <span class="st">"died"</span>,</span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">Transfer =</span> <span class="st">"transfer"</span>,</span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">other_level =</span> <span class="st">"Other"</span>))</span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a>                                     </span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a>longbeach <span class="sc">%&gt;%</span></span>
<span id="cb52-14"><a href="#cb52-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(outcome_type, <span class="at">sort =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb52-15"><a href="#cb52-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>() <span class="sc">%&gt;%</span></span>
<span id="cb52-16"><a href="#cb52-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"Outcome type"</span>, <span class="st">"Number of animals"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">Outcome type</th>
<th style="text-align: right;">Number of animals</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Rescue</td>
<td style="text-align: right;">6680</td>
</tr>
<tr class="even">
<td style="text-align: left;">Adoption</td>
<td style="text-align: right;">6290</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Euthanasia</td>
<td style="text-align: right;">5451</td>
</tr>
<tr class="even">
<td style="text-align: left;">Transfer</td>
<td style="text-align: right;">4869</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Return to owner</td>
<td style="text-align: right;">3214</td>
</tr>
<tr class="even">
<td style="text-align: left;">Other</td>
<td style="text-align: right;">2333</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Died</td>
<td style="text-align: right;">763</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Let’s now create a column <code>adopted</code>. It will be “Yes” in case of outcome type “adoption” and “No” for all the other outcome types. <strong>At this point, I remove 187 rows from the dataset, as they have missing values for <code>outcome_type</code>.</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>longbeach <span class="ot">&lt;-</span> longbeach <span class="sc">%&gt;%</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(outcome_type)) <span class="sc">%&gt;%</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">adopted =</span> <span class="fu">ifelse</span>(outcome_type <span class="sc">==</span> <span class="st">"Adoption"</span>, <span class="dv">1</span>, <span class="dv">0</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">adopted =</span> <span class="fu">factor</span>(adopted, <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">0</span>), <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Yes"</span>, <span class="st">"No"</span>)))</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>longbeach <span class="ot">&lt;-</span> longbeach <span class="sc">%&gt;%</span></span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(adopted, <span class="at">.after =</span> <span class="st">"outcome_type"</span>)</span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>longbeach <span class="sc">%&gt;%</span></span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(adopted) <span class="sc">%&gt;%</span></span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"Adopted"</span>, <span class="st">"Number of animals"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">Adopted</th>
<th style="text-align: right;">Number of animals</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Yes</td>
<td style="text-align: right;">6290</td>
</tr>
<tr class="even">
<td style="text-align: left;">No</td>
<td style="text-align: right;">23310</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Let’s also create a binary (+ “other”) category <code>outcome_type_posneg</code> where we will collapse <code>outcome_type</code> into positive if animal survived, negative if it did not and other for other level(s).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>longbeach <span class="ot">&lt;-</span> longbeach <span class="sc">%&gt;%</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">outcome_type_posneg =</span> <span class="fu">fct_collapse</span>(outcome_type,</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">Positive =</span> <span class="fu">c</span>(<span class="st">"Adoption"</span>, <span class="st">"Rescue"</span>, <span class="st">"Return to owner"</span>, <span class="st">"Transfer"</span>),</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">Negative =</span> <span class="fu">c</span>(<span class="st">"Died"</span>, <span class="st">"Euthanasia"</span>),</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">other_level =</span> <span class="st">"Other"</span>))</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>longbeach <span class="sc">%&gt;%</span></span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">diff =</span> (outcome_type_posneg <span class="sc">==</span> <span class="st">"Positive"</span>) <span class="sc">!=</span> was_outcome_alive) <span class="sc">%&gt;%</span></span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(diff) <span class="sc">%&gt;%</span></span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(outcome_type, was_outcome_alive)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 3
  outcome_type was_outcome_alive     n
  &lt;fct&gt;        &lt;lgl&gt;             &lt;int&gt;
1 Other        TRUE               2333</code></pre>
</div>
</div>
<p>There was a discrepancy in number of my “positive outcomes” and original “alive” outcome in variable <code>was_outcome_alive.</code> I checked what are outcome types in my active dataset that are alive, but are not “positive” in newly created <code>outcome_type_posneg</code> column. All of them are in “other” outcome type. Maybe we can filter out others in future visualization and analysis.</p>
<p>OK! Let’s finally proceed to plotting <code>outcome_type</code> distribution.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>outcome_type_posneg_colors <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Positive"</span> <span class="ot">=</span> <span class="st">"#4c9b82"</span>,</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Negative"</span> <span class="ot">=</span> <span class="st">"#e15859"</span>,</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Other"</span> <span class="ot">=</span> <span class="st">"#ebcb2a"</span>)</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>longbeach <span class="sc">%&gt;%</span> </span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(outcome_type) <span class="sc">%&gt;%</span></span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>(),</span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">outcome_type_posneg =</span> <span class="fu">first</span>(outcome_type_posneg)) <span class="sc">%&gt;%</span></span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">outcome_type =</span> <span class="fu">fct_reorder</span>(outcome_type, n)) <span class="sc">%&gt;%</span> </span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> outcome_type, <span class="at">y =</span> n, <span class="at">fill =</span> outcome_type_posneg)) <span class="sc">+</span> </span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>() <span class="sc">+</span> </span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span> </span>
<span id="cb56-14"><a href="#cb56-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span> </span>
<span id="cb56-15"><a href="#cb56-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Outcome type"</span>, <span class="at">y =</span> <span class="st">"Number of animals"</span>, <span class="at">title =</span> <span class="st">"Number of animals by outcome type (Long Beach Animal Shelter, 2017–2024)"</span>, <span class="at">fill =</span> <span class="st">"Outcome type"</span>) <span class="sc">+</span> </span>
<span id="cb56-16"><a href="#cb56-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> outcome_type_posneg_colors) <span class="sc">+</span></span>
<span id="cb56-17"><a href="#cb56-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title.position =</span> <span class="st">"plot"</span>,</span>
<span id="cb56-18"><a href="#cb56-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="sc">-</span><span class="fl">0.3</span>),</span>
<span id="cb56-19"><a href="#cb56-19" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position=</span><span class="st">"none"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="lbas_eda_reg_likar_files/figure-html/unnamed-chunk-32-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>This could be a nice lollipop plot!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>longbeach <span class="sc">%&gt;%</span> </span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(outcome_type) <span class="sc">%&gt;%</span></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>(),</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">outcome_type_posneg =</span> <span class="fu">first</span>(outcome_type_posneg)) <span class="sc">%&gt;%</span></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">proportion =</span> n <span class="sc">/</span> <span class="fu">sum</span>(n),  </span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> scales<span class="sc">::</span><span class="fu">percent</span>(proportion, <span class="at">accuracy =</span> <span class="fl">0.1</span>),</span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">outcome_type =</span> <span class="fu">fct_reorder</span>(outcome_type, n) </span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> n, <span class="at">y =</span> outcome_type)) <span class="sc">+</span> </span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">xend =</span> n, <span class="at">yend =</span> outcome_type, <span class="at">color =</span> outcome_type_posneg), <span class="at">linewidth =</span> <span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> outcome_type_posneg), <span class="at">size =</span> <span class="dv">13</span>) <span class="sc">+</span></span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> label), <span class="at">color =</span> <span class="st">"#313131"</span>, <span class="at">size =</span> <span class="dv">3</span>, <span class="at">fontface =</span> <span class="st">"bold"</span>) <span class="sc">+</span></span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb57-15"><a href="#cb57-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="cn">NULL</span>, <span class="at">x =</span> <span class="st">"Number of animals"</span>,</span>
<span id="cb57-16"><a href="#cb57-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Proportion of animals by outcome type (Long Beach Animal Shelter, 2017–2024)"</span>,</span>
<span id="cb57-17"><a href="#cb57-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Outcomes with animal remaining alive and considered positive in green.</span><span class="sc">\n</span><span class="st">Negative outcomes with animals dying in red."</span>,</span>
<span id="cb57-18"><a href="#cb57-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"Outcome type"</span>,</span>
<span id="cb57-19"><a href="#cb57-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">"</span><span class="sc">\n</span><span class="st">2333 individuals in group 'other' were originally considered as living outcome. </span><span class="sc">\n</span><span class="st">However after our recoding they were recoded to neither positive nor negative outcome"</span></span>
<span id="cb57-20"><a href="#cb57-20" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb57-21"><a href="#cb57-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="dv">0</span>, <span class="dv">7100</span>) <span class="sc">+</span> </span>
<span id="cb57-22"><a href="#cb57-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb57-23"><a href="#cb57-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb57-24"><a href="#cb57-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title.position =</span> <span class="st">"plot"</span>,</span>
<span id="cb57-25"><a href="#cb57-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb57-26"><a href="#cb57-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"none"</span></span>
<span id="cb57-27"><a href="#cb57-27" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb57-28"><a href="#cb57-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> outcome_type_posneg_colors)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="lbas_eda_reg_likar_files/figure-html/unnamed-chunk-33-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="combining-animal-type-intake-condition-and-outcome-type" class="level3">
<h3 class="anchored" data-anchor-id="combining-animal-type-intake-condition-and-outcome-type">Combining animal type, intake condition and outcome type</h3>
<p>Data allows me to plot more specific associations that I am looking to investigate with regression models. First, we will do three things with broader <code>outcome_type</code> variable:</p>
<ul>
<li>Visualize animal type vs.&nbsp;outcome type</li>
<li>Visualize intake condition vs.&nbsp;outcome type</li>
<li>Tile plot - intake condition vs.&nbsp;animal type, values = proportions with positive outcome</li>
</ul>
<p>Let’s get right to it!</p>
<section id="animal-type-vs.-outcome-type" class="level4">
<h4 class="anchored" data-anchor-id="animal-type-vs.-outcome-type">Animal type vs.&nbsp;outcome type</h4>
<p>Let’s first determine color scale, that will be used for outcomes in all visualizations equally.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>outcome_type_colors <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Adoption"</span> <span class="ot">=</span> <span class="st">"#4c9b82"</span>,</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Return to owner"</span> <span class="ot">=</span> <span class="st">"#6cc08b"</span>,</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Euthanasia"</span> <span class="ot">=</span> <span class="st">"#e76254"</span>,</span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Died"</span> <span class="ot">=</span> <span class="st">"#ef8a48"</span>,</span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Rescue"</span> <span class="ot">=</span> <span class="st">"#90d890"</span>,</span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Transfer"</span> <span class="ot">=</span> <span class="st">"#d3f2a3"</span>,</span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Other"</span> <span class="ot">=</span> <span class="st">"#acacab"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Animal type vs.&nbsp;outcome type - investigate whether certain animal types are associated with specific outcomes (e.g.&nbsp;cats getting adopted, dogs being transferred etc.)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>longbeach <span class="sc">%&gt;%</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(animal_type, outcome_type) <span class="sc">%&gt;%</span></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">animal_type =</span> <span class="fu">fct_reorder</span>(animal_type, n, <span class="at">.fun =</span> sum)) <span class="sc">%&gt;%</span></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">outcome_type =</span> <span class="fu">fct_relevel</span>(outcome_type,</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"Euthanasia"</span>,</span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"Died"</span>,</span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"Other"</span>,</span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"Transfer"</span>,</span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"Rescue"</span>,</span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"Return to owner"</span>,</span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"Adoption"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb59-13"><a href="#cb59-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(animal_type, n, <span class="at">fill =</span> outcome_type) <span class="sc">+</span></span>
<span id="cb59-14"><a href="#cb59-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">position =</span> <span class="st">"fill"</span>) <span class="sc">+</span> </span>
<span id="cb59-15"><a href="#cb59-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span> </span>
<span id="cb59-16"><a href="#cb59-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span> </span>
<span id="cb59-17"><a href="#cb59-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Animal type"</span>, <span class="at">y =</span> <span class="st">"Proportion of animals with a certain outcome (%)"</span>, <span class="at">fill =</span> <span class="st">"Outcome type"</span>, <span class="at">title =</span> <span class="st">"Proportions of different outcomes for different animal types </span><span class="sc">\n</span><span class="st">(Long Beach Animal Shelter, 2017–2024)"</span>) <span class="sc">+</span> </span>
<span id="cb59-18"><a href="#cb59-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(</span>
<span id="cb59-19"><a href="#cb59-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">labels =</span> <span class="fu">label_percent</span>(), </span>
<span id="cb59-20"><a href="#cb59-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.2</span>),</span>
<span id="cb59-21"><a href="#cb59-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">sec.axis =</span> <span class="fu">dup_axis</span>(<span class="at">labels =</span> <span class="fu">label_percent</span>(), <span class="at">name =</span> <span class="cn">NULL</span>)) <span class="sc">+</span></span>
<span id="cb59-22"><a href="#cb59-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb59-23"><a href="#cb59-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title.position =</span> <span class="st">"plot"</span>,</span>
<span id="cb59-24"><a href="#cb59-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb59-25"><a href="#cb59-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> outcome_type_colors, <span class="at">guide =</span> <span class="fu">guide_legend</span>(<span class="at">reverse =</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="lbas_eda_reg_likar_files/figure-html/unnamed-chunk-35-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>There are a few things we can conclude from this visualization. Small mammals have the highest proportion of adoptions, followed closely by dogs and cats. While a insignificant proportion of cats is returned to the owners, situation is different for dogs. About 30% of dogs are returned to their owner. It is possible that a significant percentage of stray dogs have escaped their home and were roaming free for a while and then returned to their owner. On the other hand it is possible that much lower proportion of stray cats have escaped their home recently, but are actually street-based animals. Overall, proportion of animals euthanized is about 2.5x higher for cats than for dogs. Highest proportion of euthanasia in a specific animal type is in wildlife (cca. 60%) and animals classified as “other” (cca. 50%). I have speculated in the previous sections that wildlife animals perhaps end up in the shelter more frequently because of their high rate of moderate and severe injuries (50-55% combined; reported in section “Combining animal type and intake condition”). It is possible that if big proportion of these animals cannot get better, be healed, they highly likely end up euthanized instead of returned to natural habitat.</p>
<p>While positive outcomes (bar segments in green) are about 90% for dogs, 80% for small mammals, 80% for exotic animals, 65% for cats and slightly above 60% for birds, wildlife animals and others are more likely to result in a negative outcome (55% for others, 65% for wildlife).</p>
</section>
<section id="intake-condition-vs.-outcome-type" class="level4">
<h4 class="anchored" data-anchor-id="intake-condition-vs.-outcome-type">Intake condition vs.&nbsp;outcome type</h4>
<p>I will now repeat the same procedure as in the previous section to investigate possible associations between intake condition and outcome type. With this, we will be able to get some information whether the condition in which the animal is taken into the shelter can give the caretakers any approximation about the most likely outcome for that animal.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>longbeach <span class="sc">%&gt;%</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(intake_condition, outcome_type) <span class="sc">%&gt;%</span></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">intake_condition =</span> <span class="fu">fct_relevel</span>(intake_condition,</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>                                        <span class="st">"Normal"</span>,</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>                                        <span class="st">"Under age/weight"</span>,</span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>                                        <span class="st">"Mild physical"</span>,</span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>                                        <span class="st">"Moderate physical"</span>,</span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>                                        <span class="st">"Severe physical"</span>,</span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a>                                        <span class="st">"Other"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">outcome_type =</span> <span class="fu">fct_relevel</span>(outcome_type,</span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"Euthanasia"</span>,</span>
<span id="cb60-12"><a href="#cb60-12" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"Died"</span>,</span>
<span id="cb60-13"><a href="#cb60-13" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"Other"</span>,</span>
<span id="cb60-14"><a href="#cb60-14" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"Transfer"</span>,</span>
<span id="cb60-15"><a href="#cb60-15" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"Rescue"</span>,</span>
<span id="cb60-16"><a href="#cb60-16" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"Return to owner"</span>,</span>
<span id="cb60-17"><a href="#cb60-17" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"Adoption"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb60-18"><a href="#cb60-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb60-19"><a href="#cb60-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(intake_condition, n, <span class="at">fill =</span> outcome_type) <span class="sc">+</span></span>
<span id="cb60-20"><a href="#cb60-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">position =</span> <span class="st">"fill"</span>) <span class="sc">+</span> </span>
<span id="cb60-21"><a href="#cb60-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span> </span>
<span id="cb60-22"><a href="#cb60-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span> </span>
<span id="cb60-23"><a href="#cb60-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Intake condition"</span>, <span class="at">y =</span> <span class="st">"Proportion of animals (%)"</span>, <span class="at">fill =</span> <span class="st">"Outcome type"</span>, <span class="at">title =</span> <span class="st">"Proportions of specific outcome for different intake conditions </span><span class="sc">\n</span><span class="st">(Long Beach Animal Shelter, 2017–2024)"</span>) <span class="sc">+</span> </span>
<span id="cb60-24"><a href="#cb60-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(</span>
<span id="cb60-25"><a href="#cb60-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">labels =</span> <span class="fu">label_percent</span>(), </span>
<span id="cb60-26"><a href="#cb60-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.2</span>),</span>
<span id="cb60-27"><a href="#cb60-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">sec.axis =</span> <span class="fu">dup_axis</span>(<span class="at">labels =</span> <span class="fu">label_percent</span>(), <span class="at">name =</span> <span class="cn">NULL</span>)) <span class="sc">+</span></span>
<span id="cb60-28"><a href="#cb60-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb60-29"><a href="#cb60-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title.position =</span> <span class="st">"plot"</span>,</span>
<span id="cb60-30"><a href="#cb60-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb60-31"><a href="#cb60-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> outcome_type_colors, <span class="at">guide =</span> <span class="fu">guide_legend</span>(<span class="at">reverse =</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="lbas_eda_reg_likar_files/figure-html/unnamed-chunk-36-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>From this plot we can see that intake condition is associated with the outcome. Almost 90% of animals taken in in normal condition are likely to face a positive outcome, meaning they will stay alive and either get adopted, returned to their owner or be transferred to another rescue or shelter facility. With increase in severity of physical condition, the chances of positive outcome decrease, with about 70% positive outcomes for under-age and/or under-weight animals, and those with mild physical condition. About 55% of animals in moderate physical condition will face a positive outcome and this proportion drops to about 25% for severely injured of ill animals.</p>
<p><strong>NOTE:</strong> Before proceeding, I will remove category “Other” from <code>animal_type</code> and <code>intake_condition</code>, to avoid repeating it within every pipeline.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="co"># In case copy of longbeach is needed in the future - before filtering animal_type and intake_condition for "Others"</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a><span class="co">#longbeach_before_fitlering_Others &lt;- longbeach</span></span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a><span class="co">#longbeach &lt;- longbeach_before_fitlering_Others</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Filter:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>longbeach <span class="ot">&lt;-</span> longbeach <span class="sc">%&gt;%</span> </span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(intake_condition <span class="sc">!=</span> <span class="st">"Other"</span> <span class="sc">&amp;</span> animal_type <span class="sc">!=</span> <span class="st">"Other"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="animal-type-vs.-intake-condition-vs.-outcome-type" class="level4">
<h4 class="anchored" data-anchor-id="animal-type-vs.-intake-condition-vs.-outcome-type">Animal type vs.&nbsp;intake condition vs.&nbsp;outcome type</h4>
<p>Let’s now connect all three variables in a tile plot. I will plot animal type against intake condition and use gradient of the tiles to show what is the percentage of positive vs negative outcome. We will not use specific <code>outcome_type</code> categories, but return to the variable <code>outcome_type_posneg</code>. As a reminder, we collapsed <code>outcome_type</code> categories into positive outcome if animal survived, negative if it did not and other for other level(s). Positive outcomes correspond with green segments and negative outcomes with red in previous graphs in this section.</p>
<p>Note: proportion was calculated as <code>positive / (positive + negative + other)</code>. Therefore it is crucial to notice that proportional graphs tell us about proportion of positive outcomes compared to negative and other outcomes, not just negative.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>longbeach <span class="sc">%&gt;%</span> </span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># count outcome +/- based on intake condition for every animal</span></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(animal_type, intake_condition, outcome_type_posneg) <span class="sc">%&gt;%</span>                       </span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(animal_type, intake_condition) <span class="sc">%&gt;%</span></span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">#calculate total outcomes for each income condition for each animal type and proportion (e.g., positive outcomes for normal cats/ all outcomes for normal cats)</span></span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">outcome_type_total_posnegother =</span> <span class="fu">sum</span>(n),</span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">positive_outcome_type_prop =</span> n<span class="sc">/</span>outcome_type_total_posnegother) <span class="sc">%&gt;%</span></span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># add total number of ouccomes/cases for every animal type</span></span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(animal_type) <span class="sc">%&gt;%</span></span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">total_animal_count =</span> <span class="fu">sum</span>(n)) <span class="sc">%&gt;%</span></span>
<span id="cb63-12"><a href="#cb63-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb63-13"><a href="#cb63-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># add total number of outcomes/cases for every intake condition</span></span>
<span id="cb63-14"><a href="#cb63-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(intake_condition) <span class="sc">%&gt;%</span></span>
<span id="cb63-15"><a href="#cb63-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">intake_condition_total =</span> <span class="fu">sum</span>(n)) <span class="sc">%&gt;%</span></span>
<span id="cb63-16"><a href="#cb63-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb63-17"><a href="#cb63-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add new column with animal types and with their total count in brackets and relevel/reorder them in the same step</span></span>
<span id="cb63-18"><a href="#cb63-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">animal_type_label =</span> <span class="fu">fct_reorder</span>(<span class="fu">paste0</span>(animal_type, <span class="st">" ("</span>, total_animal_count, <span class="st">")"</span>),</span>
<span id="cb63-19"><a href="#cb63-19" aria-hidden="true" tabindex="-1"></a>                                         total_animal_count)) <span class="sc">%&gt;%</span></span>
<span id="cb63-20"><a href="#cb63-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">intake_condition =</span> <span class="fu">fct_relevel</span>(intake_condition,</span>
<span id="cb63-21"><a href="#cb63-21" aria-hidden="true" tabindex="-1"></a>                                        <span class="st">"Normal"</span>,</span>
<span id="cb63-22"><a href="#cb63-22" aria-hidden="true" tabindex="-1"></a>                                        <span class="st">"Under age/weight"</span>,</span>
<span id="cb63-23"><a href="#cb63-23" aria-hidden="true" tabindex="-1"></a>                                        <span class="st">"Mild physical"</span>,</span>
<span id="cb63-24"><a href="#cb63-24" aria-hidden="true" tabindex="-1"></a>                                        <span class="st">"Moderate physical"</span>,</span>
<span id="cb63-25"><a href="#cb63-25" aria-hidden="true" tabindex="-1"></a>                                        <span class="st">"Severe physical"</span>,</span>
<span id="cb63-26"><a href="#cb63-26" aria-hidden="true" tabindex="-1"></a>                                        <span class="st">"Other"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb63-27"><a href="#cb63-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(outcome_type_posneg <span class="sc">==</span> <span class="st">"Positive"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb63-28"><a href="#cb63-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb63-29"><a href="#cb63-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb63-30"><a href="#cb63-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> animal_type_label, <span class="at">y =</span> intake_condition, <span class="at">fill =</span> positive_outcome_type_prop<span class="sc">*</span><span class="dv">100</span>) <span class="sc">+</span></span>
<span id="cb63-31"><a href="#cb63-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>(<span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span> </span>
<span id="cb63-32"><a href="#cb63-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">paste0</span>(n, <span class="st">"</span><span class="sc">\n</span><span class="st">("</span>, outcome_type_total_posnegother, <span class="st">")"</span>)), <span class="at">color =</span> <span class="st">"#313131"</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span> </span>
<span id="cb63-33"><a href="#cb63-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb63-34"><a href="#cb63-34" aria-hidden="true" tabindex="-1"></a>  <span class="co">#coord_fixed() + </span></span>
<span id="cb63-35"><a href="#cb63-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradientn</span>(</span>
<span id="cb63-36"><a href="#cb63-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">colors =</span> <span class="fu">c</span>(<span class="st">"#e76254"</span>, <span class="st">"#ef8a48"</span>, <span class="st">"#fbd587"</span>, <span class="st">"white"</span>,<span class="st">"#d3f2a3"</span>, <span class="st">"#90d890"</span>, <span class="st">"#4c9b82"</span>),</span>
<span id="cb63-37"><a href="#cb63-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_percent</span>(<span class="at">scale =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb63-38"><a href="#cb63-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="st">"Intake condition of the animal"</span>, <span class="at">title =</span> <span class="st">"Positive outcome proportion for each animal type and intake condition </span><span class="sc">\n</span><span class="st">(Long Beach Animal Shelter, 2017–2024)"</span>, <span class="at">subtitle =</span> <span class="st">"Numbers on tiles represent total number of positive outcomes for that intake condition in each animal type.</span><span class="sc">\n</span><span class="st">Number in paranthesis is total number of individuals from that animal type with specific intake condition."</span>, <span class="at">fill =</span> <span class="st">"Positive outcome rate </span><span class="sc">\n</span><span class="st">"</span>) <span class="sc">+</span> </span>
<span id="cb63-39"><a href="#cb63-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb63-40"><a href="#cb63-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb63-41"><a href="#cb63-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title.position =</span> <span class="st">"plot"</span>,</span>
<span id="cb63-42"><a href="#cb63-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="lbas_eda_reg_likar_files/figure-html/unnamed-chunk-39-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>There are several important pieces of information we can gather from this plot. First thing to highlight is that across different animal types we can see decrease in positive outcome proportion between mild and severe physical conditions, as gradient goes from greenish to reddish colors. This is especially noticeable in cats, dogs and small mammals. However, it seems that physical conditions have a more pronounced effect in cats compared to dogs. Generally a lower proportion of positive outcomes is observed across different physical conditions for cats compared to dogs. In general, dogs appear to have the highest positive outcome rate, as more than 50% positive outcomes are expected across all conditions except severe physical. On the other hand, wildlife animals face a positive outcome less than 50% of time across all intake conditions, as indicated by dominantly orange-red colored tiles.</p>
<p>Let’s now repeat this whole section, using adoption instead of broader outcome types.</p>
</section>
</section>
<section id="combining-animal-type-intake-condition-and-adoption" class="level3">
<h3 class="anchored" data-anchor-id="combining-animal-type-intake-condition-and-adoption">Combining animal type, intake condition and adoption</h3>
<p>In this section I will focus on replicating the last plot (tile plot) from the last section. It would not be that interesting to plot <code>animal_type vs adoption</code> and <code>intake_condition vs adoption</code>, because filling the columns by outcome type in the previous section gave us explicit information about adoptions, as one of the column fills referred to this category specifically (dark green on previous plots).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>longbeach <span class="sc">%&gt;%</span> </span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># count outcome +/- based on intake condition for every animal</span></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(animal_type, intake_condition, adopted, <span class="at">.drop =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span>                      </span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(animal_type, intake_condition) <span class="sc">%&gt;%</span></span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">#calculate total outcomes for each income condition for each animal type and proportion (e.g., positive outcomes for normal cats/ all outcomes for normal cats)</span></span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">outcome_type_total =</span> <span class="fu">sum</span>(n),</span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">outcome_rate =</span> n<span class="sc">/</span>outcome_type_total,</span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">outcome_rate =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(outcome_rate), <span class="dv">0</span>, outcome_rate)) <span class="sc">%&gt;%</span></span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># add total number of outcomes/cases for every animal type</span></span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(animal_type) <span class="sc">%&gt;%</span></span>
<span id="cb64-12"><a href="#cb64-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">total_animal_count =</span> <span class="fu">sum</span>(n)) <span class="sc">%&gt;%</span></span>
<span id="cb64-13"><a href="#cb64-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb64-14"><a href="#cb64-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># add total number of outcomes/cases for every intake condition</span></span>
<span id="cb64-15"><a href="#cb64-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(intake_condition) <span class="sc">%&gt;%</span></span>
<span id="cb64-16"><a href="#cb64-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">intake_condition_total =</span> <span class="fu">sum</span>(n)) <span class="sc">%&gt;%</span></span>
<span id="cb64-17"><a href="#cb64-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb64-18"><a href="#cb64-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add new column with animal types and with their total count in brackets and relevel/reorder them in the same step</span></span>
<span id="cb64-19"><a href="#cb64-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">animal_type_label =</span> <span class="fu">fct_reorder</span>(<span class="fu">paste0</span>(animal_type, <span class="st">" ("</span>, total_animal_count, <span class="st">")"</span>),</span>
<span id="cb64-20"><a href="#cb64-20" aria-hidden="true" tabindex="-1"></a>                                         total_animal_count)) <span class="sc">%&gt;%</span></span>
<span id="cb64-21"><a href="#cb64-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">intake_condition =</span> <span class="fu">fct_relevel</span>(intake_condition,</span>
<span id="cb64-22"><a href="#cb64-22" aria-hidden="true" tabindex="-1"></a>                                        <span class="st">"Normal"</span>,</span>
<span id="cb64-23"><a href="#cb64-23" aria-hidden="true" tabindex="-1"></a>                                        <span class="st">"Under age/weight"</span>,</span>
<span id="cb64-24"><a href="#cb64-24" aria-hidden="true" tabindex="-1"></a>                                        <span class="st">"Mild physical"</span>,</span>
<span id="cb64-25"><a href="#cb64-25" aria-hidden="true" tabindex="-1"></a>                                        <span class="st">"Moderate physical"</span>,</span>
<span id="cb64-26"><a href="#cb64-26" aria-hidden="true" tabindex="-1"></a>                                        <span class="st">"Severe physical"</span>,</span>
<span id="cb64-27"><a href="#cb64-27" aria-hidden="true" tabindex="-1"></a>                                        <span class="st">"Other"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb64-28"><a href="#cb64-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(adopted <span class="sc">==</span> <span class="st">"Yes"</span> <span class="sc">&amp;</span> intake_condition <span class="sc">!=</span> <span class="st">"Other"</span> <span class="sc">&amp;</span> animal_type <span class="sc">!=</span> <span class="st">"Other"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb64-29"><a href="#cb64-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb64-30"><a href="#cb64-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb64-31"><a href="#cb64-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> animal_type_label, <span class="at">y =</span> intake_condition, <span class="at">fill =</span> outcome_rate<span class="sc">*</span><span class="dv">100</span>) <span class="sc">+</span></span>
<span id="cb64-32"><a href="#cb64-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>(<span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span> </span>
<span id="cb64-33"><a href="#cb64-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">paste0</span>(n, <span class="st">"</span><span class="sc">\n</span><span class="st">("</span>, outcome_type_total, <span class="st">")"</span>)), <span class="at">color =</span> <span class="st">"#313131"</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span> </span>
<span id="cb64-34"><a href="#cb64-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradientn</span>(</span>
<span id="cb64-35"><a href="#cb64-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">colors =</span> <span class="fu">c</span>(<span class="st">"#e76254"</span>, <span class="st">"#ef8a48"</span>, <span class="st">"white"</span>,<span class="st">"#d3f2a3"</span>, <span class="st">"#90d890"</span>, <span class="st">"#4c9b82"</span>),</span>
<span id="cb64-36"><a href="#cb64-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_percent</span>(<span class="at">scale =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb64-37"><a href="#cb64-37" aria-hidden="true" tabindex="-1"></a>  <span class="co">#coord_fixed() + </span></span>
<span id="cb64-38"><a href="#cb64-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="st">"Intake condition of the animal"</span>, <span class="at">title =</span> <span class="st">"Adoption rate for each animal type and intake condition </span><span class="sc">\n</span><span class="st">(Long Beach Animal Shelter, 2017–2024)"</span>, <span class="at">subtitle =</span> <span class="st">"Numbers on tiles represent total number of adoptions for that intake condition in each animal type.</span><span class="sc">\n</span><span class="st">Numbers in paranthesis are total number of individuals from that animal type with specific intake condition."</span>, <span class="at">fill =</span> <span class="st">"Adoption rate"</span>) <span class="sc">+</span> </span>
<span id="cb64-39"><a href="#cb64-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb64-40"><a href="#cb64-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span>  </span>
<span id="cb64-41"><a href="#cb64-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb64-42"><a href="#cb64-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title.position =</span> <span class="st">"plot"</span>,</span>
<span id="cb64-43"><a href="#cb64-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="lbas_eda_reg_likar_files/figure-html/unnamed-chunk-40-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Similarly to the previous plot, this one reveals several interesting details about how intake condition is associated with adoption rate in different animal types. Highest rates of adoptions are in normal and mildly physically compromised cats and small mammals. This is followed by normal and mildly physically compromised dogs. We can see a severe decrease in adoption rate from mild to severe physical condition in dogs and cats. In all groups with the exception of cats, under-age and under-weight animals seem to have little to no chances of getting adopted. This suggest that potential future owners possibly believe that raising such an animal will be very difficult, or possibly shelters do not offer these animals for adoption as often. Though in the section “Intake condition vs.&nbsp;outcome type” we could see that about 15% of under-age and/or under-weight animals get adopted. It is possible that majority of those animals are cats, as we can see in this plot that about 20% of under-age and/or under-weight cats get adopted. As we have seen in the section “Animal type vs.&nbsp;outcome type”, no wildilfe animals get adopted. Birds have a similarly low rate with a few exceptions in compromised groups and 26 normal individuals getting adopted. Adoption rates are small for exotic animals as well, as only 11 normal and 1 per each physically compromised category were adopted.</p>
<p>Overall, there seems to be more of a binary difference in animal type trends, as cats, dogs and small mammals have adoption rates close to 25-30% percent. On the other hand, other groups share similarly low adoption rate at maximum 5%. Intake conditions exhibit more gradually decreasing rates from normal to most severely physically compromised group. Importantly however, mildly injured animals, especially cats and dogs show higher adoption rates compared to under-age and -weight group. This could be due to fewer offerings of these animals by shelter. On the other hand potential adopters might believe that it is easier to help get mildly compromised animal better, than to take care of under-age or -weight individual in the long run.</p>
<p>Ok, let’s try to improve the plot by adding some information and kind of having a table and visual representation in the same plot.</p>
<p>Prepare:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare the order of the levels according tow hat we want in the final plot - animal names sorted by total number and conditions by severity</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>condition_pcts_labels <span class="ot">&lt;-</span> longbeach <span class="sc">%&gt;%</span> </span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(intake_condition, adopted, <span class="at">.drop =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(intake_condition) <span class="sc">%&gt;%</span></span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">total_per_condition =</span> <span class="fu">sum</span>(n)) <span class="sc">%&gt;%</span></span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(adopted <span class="sc">==</span> <span class="st">"Yes"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">condition_adopted_pct =</span> n<span class="sc">/</span>total_per_condition,</span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">intake_condition_label =</span> <span class="fu">paste0</span>(intake_condition, <span class="st">"</span><span class="sc">\n</span><span class="st">("</span>, <span class="fu">round</span>(condition_adopted_pct<span class="sc">*</span><span class="dv">100</span>,<span class="dv">1</span>), <span class="st">"%)"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(intake_condition <span class="sc">!=</span> <span class="st">"Other"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb65-11"><a href="#cb65-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(intake_condition_label)</span>
<span id="cb65-12"><a href="#cb65-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-13"><a href="#cb65-13" aria-hidden="true" tabindex="-1"></a>condition_pcts_labels <span class="ot">&lt;-</span> condition_pcts_labels[<span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>)]</span>
<span id="cb65-14"><a href="#cb65-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-15"><a href="#cb65-15" aria-hidden="true" tabindex="-1"></a>animal_type_pcts_labels <span class="ot">&lt;-</span> longbeach <span class="sc">%&gt;%</span> </span>
<span id="cb65-16"><a href="#cb65-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(animal_type, adopted, <span class="at">.drop =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb65-17"><a href="#cb65-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(animal_type) <span class="sc">%&gt;%</span></span>
<span id="cb65-18"><a href="#cb65-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">total_per_type =</span> <span class="fu">sum</span>(n)) <span class="sc">%&gt;%</span></span>
<span id="cb65-19"><a href="#cb65-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(adopted <span class="sc">==</span> <span class="st">"Yes"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb65-20"><a href="#cb65-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">type_adopted_pct =</span> n<span class="sc">/</span>total_per_type,</span>
<span id="cb65-21"><a href="#cb65-21" aria-hidden="true" tabindex="-1"></a>         <span class="at">animal_type_label =</span> <span class="fu">paste0</span>(animal_type, <span class="st">"</span><span class="sc">\n</span><span class="st">("</span>, <span class="fu">round</span>(type_adopted_pct<span class="sc">*</span><span class="dv">100</span>,<span class="dv">1</span>), <span class="st">"%)"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb65-22"><a href="#cb65-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(animal_type <span class="sc">!=</span> <span class="st">"Other"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb65-23"><a href="#cb65-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(animal_type_label)</span>
<span id="cb65-24"><a href="#cb65-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-25"><a href="#cb65-25" aria-hidden="true" tabindex="-1"></a>animal_type_pcts_labels <span class="ot">&lt;-</span> <span class="fu">rev</span>(<span class="fu">c</span>(<span class="st">"Cats</span><span class="sc">\n</span><span class="st">(25.2%)"</span>,<span class="st">"Dogs</span><span class="sc">\n</span><span class="st">(26.7%)"</span> ,<span class="st">"Small mammals</span><span class="sc">\n</span><span class="st">(30%)"</span>,<span class="st">"Birds</span><span class="sc">\n</span><span class="st">(1.5%)"</span>,<span class="st">"Exotic</span><span class="sc">\n</span><span class="st">(4.1%)"</span>,<span class="st">"Wildlife</span><span class="sc">\n</span><span class="st">(0%)"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Plot:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate adoption proportions for every animal type</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>animal_type_adoption_pcts <span class="ot">&lt;-</span> longbeach <span class="sc">%&gt;%</span> </span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(animal_type, adopted, <span class="at">.drop =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(animal_type) <span class="sc">%&gt;%</span></span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">total_per_type =</span> <span class="fu">sum</span>(n)) <span class="sc">%&gt;%</span></span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(adopted <span class="sc">==</span> <span class="st">"Yes"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">type_adopted_pct =</span> n<span class="sc">/</span>total_per_type,</span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">animal_type_label =</span> <span class="fu">paste0</span>(animal_type, <span class="st">"</span><span class="sc">\n</span><span class="st">("</span>, <span class="fu">round</span>(type_adopted_pct<span class="sc">*</span><span class="dv">100</span>,<span class="dv">1</span>), <span class="st">"%)"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(animal_type <span class="sc">!=</span> <span class="st">"Other"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(animal_type, type_adopted_pct, animal_type_label)</span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate adoption proportions for every intake condition</span></span>
<span id="cb66-13"><a href="#cb66-13" aria-hidden="true" tabindex="-1"></a>intake_cond_adoption_pcts <span class="ot">&lt;-</span> longbeach <span class="sc">%&gt;%</span> </span>
<span id="cb66-14"><a href="#cb66-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(intake_condition <span class="sc">!=</span> <span class="st">"Other"</span> <span class="sc">&amp;</span> animal_type <span class="sc">!=</span> <span class="st">"Other"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb66-15"><a href="#cb66-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(intake_condition, adopted, <span class="at">.drop =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb66-16"><a href="#cb66-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(intake_condition) <span class="sc">%&gt;%</span></span>
<span id="cb66-17"><a href="#cb66-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">total_per_condition =</span> <span class="fu">sum</span>(n)) <span class="sc">%&gt;%</span></span>
<span id="cb66-18"><a href="#cb66-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(adopted <span class="sc">==</span> <span class="st">"Yes"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb66-19"><a href="#cb66-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">condition_adopted_pct =</span> n<span class="sc">/</span>total_per_condition,</span>
<span id="cb66-20"><a href="#cb66-20" aria-hidden="true" tabindex="-1"></a>         <span class="at">intake_condition_label =</span> <span class="fu">paste0</span>(intake_condition, <span class="st">"</span><span class="sc">\n</span><span class="st">("</span>, <span class="fu">round</span>(condition_adopted_pct<span class="sc">*</span><span class="dv">100</span>,<span class="dv">1</span>), <span class="st">"%)"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb66-21"><a href="#cb66-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(intake_condition, condition_adopted_pct, intake_condition_label)</span>
<span id="cb66-22"><a href="#cb66-22" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb66-23"><a href="#cb66-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-24"><a href="#cb66-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate for each type*condition pair and merge with previous datasets</span></span>
<span id="cb66-25"><a href="#cb66-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-26"><a href="#cb66-26" aria-hidden="true" tabindex="-1"></a>longbeach <span class="sc">%&gt;%</span> </span>
<span id="cb66-27"><a href="#cb66-27" aria-hidden="true" tabindex="-1"></a>  <span class="co"># count outcome +/- based on intake condition for every animal</span></span>
<span id="cb66-28"><a href="#cb66-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(animal_type, intake_condition, adopted, <span class="at">.drop =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span>                </span>
<span id="cb66-29"><a href="#cb66-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(animal_type, intake_condition) <span class="sc">%&gt;%</span></span>
<span id="cb66-30"><a href="#cb66-30" aria-hidden="true" tabindex="-1"></a>  <span class="co">#calculate total outcomes for each income condition for each animal type and proportion (e.g., positive outcomes for normal cats/ all outcomes for normal cats)</span></span>
<span id="cb66-31"><a href="#cb66-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">anicond_total_outcomes =</span> <span class="fu">sum</span>(n),</span>
<span id="cb66-32"><a href="#cb66-32" aria-hidden="true" tabindex="-1"></a>         <span class="at">anicond_outcome_rate =</span> n<span class="sc">/</span>anicond_total_outcomes,</span>
<span id="cb66-33"><a href="#cb66-33" aria-hidden="true" tabindex="-1"></a>         <span class="at">anicond_outcome_rate =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(anicond_outcome_rate), <span class="dv">0</span>, anicond_outcome_rate)) <span class="sc">%&gt;%</span></span>
<span id="cb66-34"><a href="#cb66-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb66-35"><a href="#cb66-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(adopted <span class="sc">==</span> <span class="st">"Yes"</span> <span class="sc">&amp;</span> intake_condition <span class="sc">!=</span> <span class="st">"Other"</span> <span class="sc">&amp;</span> animal_type <span class="sc">!=</span> <span class="st">"Other"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb66-36"><a href="#cb66-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(animal_type_adoption_pcts, <span class="at">by =</span> <span class="st">"animal_type"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb66-37"><a href="#cb66-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(intake_cond_adoption_pcts, <span class="at">by =</span> <span class="st">"intake_condition"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb66-38"><a href="#cb66-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">animal_type_label =</span> <span class="fu">factor</span>(animal_type_label, <span class="at">levels =</span> animal_type_pcts_labels),</span>
<span id="cb66-39"><a href="#cb66-39" aria-hidden="true" tabindex="-1"></a>         <span class="at">intake_condition_label =</span> <span class="fu">factor</span>(intake_condition_label, <span class="at">levels =</span> condition_pcts_labels)) <span class="sc">%&gt;%</span></span>
<span id="cb66-40"><a href="#cb66-40" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb66-41"><a href="#cb66-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> animal_type_label, <span class="at">y =</span> intake_condition_label, <span class="at">fill =</span> anicond_outcome_rate<span class="sc">*</span><span class="dv">100</span>) <span class="sc">+</span></span>
<span id="cb66-42"><a href="#cb66-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>(<span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span> </span>
<span id="cb66-43"><a href="#cb66-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">paste0</span>(n, <span class="st">"</span><span class="sc">\n</span><span class="st">("</span>, anicond_total_outcomes, <span class="st">")"</span>)), <span class="at">color =</span> <span class="st">"#313131"</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span> </span>
<span id="cb66-44"><a href="#cb66-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradientn</span>(</span>
<span id="cb66-45"><a href="#cb66-45" aria-hidden="true" tabindex="-1"></a>    <span class="at">colors =</span> <span class="fu">c</span>(<span class="st">"#e76254"</span>, <span class="st">"#ef8a48"</span>, <span class="st">"white"</span>,<span class="st">"#d3f2a3"</span>, <span class="st">"#90d890"</span>, <span class="st">"#4c9b82"</span>),</span>
<span id="cb66-46"><a href="#cb66-46" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_percent</span>(<span class="at">scale =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb66-47"><a href="#cb66-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="cn">NULL</span>, <span class="at">title =</span> <span class="st">"Adoption rate for each animal type and intake condition </span><span class="sc">\n</span><span class="st">(Long Beach Animal Shelter, 2017–2024)"</span>, <span class="at">subtitle =</span> <span class="st">"Numbers on tiles represent total number of adoptions for that intake condition </span><span class="sc">\n</span><span class="st">in each animal type.</span><span class="sc">\n</span><span class="st">Numbers in paranthesis are total number of individuals from that animal type </span><span class="sc">\n</span><span class="st">with specific intake condition."</span>, <span class="at">fill =</span> <span class="st">"Adoption rate"</span>) <span class="sc">+</span> </span>
<span id="cb66-48"><a href="#cb66-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb66-49"><a href="#cb66-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb66-50"><a href="#cb66-50" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title.position =</span> <span class="st">"plot"</span>,</span>
<span id="cb66-51"><a href="#cb66-51" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb66-52"><a href="#cb66-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb66-53"><a href="#cb66-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="fl">0.66</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="lbas_eda_reg_likar_files/figure-html/unnamed-chunk-42-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="age" class="level3">
<h3 class="anchored" data-anchor-id="age">Age</h3>
<p>Let’s now focus on the only continuous variable that I am planning to use in the analysis. Let’s first check the type of variable and if there are any false data entry points.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="co"># As dob and intake_date are now "double", we have to change them to date variables</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>longbeach <span class="ot">&lt;-</span> longbeach <span class="sc">%&gt;%</span></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">dob =</span> <span class="fu">as.Date</span>(dob),</span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">intake_date =</span> <span class="fu">as.Date</span>(intake_date))</span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Now let's see what is the distribution of these dates and if there are any false datapoints </span></span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(longbeach)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   animal_id      animal_name           animal_type         primary_color 
 A637086:    8   *      :   90   Exotic       :  344   black       :6837  
 A637269:    7   rocky  :   75   Birds        : 2065   white       :3420  
 A279626:    6   luna   :   73   Cats         :13051   gray        :3152  
 A354875:    5   max    :   73   Dogs         : 9045   brown       :2986  
 A542375:    5   coco   :   64   Small mammals:  689   brown  tabby:2045  
 A555597:    5   (Other):15493   Other        :    0   tan         :1289  
 (Other):26566   NA's   :10734   Wildlife     : 1408   (Other)     :6873  
 secondary_color     sex                 dob              intake_date        
 white  : 7577   Length:26602       Min.   :1993-05-28   Min.   :2017-01-01  
 black  : 1633   Class :character   1st Qu.:2016-07-22   1st Qu.:2018-08-09  
 brown  : 1283   Mode  :character   Median :2018-11-17   Median :2020-09-04  
 tan    :  731                      Mean   :2018-08-19   Mean   :2020-11-19  
 gray   :  700                      3rd Qu.:2022-02-18   3rd Qu.:2023-04-22  
 (Other):  859                      Max.   :2031-03-30   Max.   :2024-12-31  
 NA's   :13819                      NA's   :2961                             
          intake_condition          intake_type     intake_subtype 
 Mild physical    : 2185   stray          :19596   otc     :14385  
 Moderate physical: 1970   wildlife       : 3325   field   :10173  
 Severe physical  : 2939   owner surrender: 2324   trap    :  332  
 Normal           :13352   welfare seized :  418   police  :  328  
 Under age/weight : 6156   confiscate     :  362   adoption:  179  
 Other            :    0   return         :  256   (Other) :  871  
                           (Other)        :  321   NA's    :  334  
  reason_for_intake  outcome_date       
 owner prob:  395   Min.   :2017-01-01  
 move      :  226   1st Qu.:2018-08-19  
 landlord  :  133   Median :2020-09-18  
 cost      :  123   Mean   :2020-12-08  
 no time   :  121   3rd Qu.:2023-05-12  
 (Other)   :  775   Max.   :2024-12-31  
 NA's      :24829                       
                                        crossing           jurisdiction  
 7700 E SPRING ST, LONG BEACH, CA 90815     :  237   Long Beach  :22987  
 6400 BLK ATLANTIC AVE, LONG BEACH, CA 90805:   68   Cerritos    : 1734  
 7700 BLK E SPRING ST, LONG BEACH, CA 90815 :   63   Signal Hill :  600  
 7500 BLK E SPRING ST, LONG BEACH, CA 90815 :   41   Los Alamitos:  464  
 7550 E SPRING ST, LONG BEACH, CA 90815     :   41   Seal Beach  :  328  
 3300 BLK SANTA FE AVE, LONG BEACH, CA 90810:   39   (Other)     :  488  
 (Other)                                    :26113   NA's        :    1  
          outcome_type  adopted       outcome_subtype     latitude    
 Adoption       :5948   Yes: 5948   spcala    : 3677   Min.   :19.30  
 Died           : 694   No :20654   web       : 2706   1st Qu.:33.78  
 Euthanasia     :4604               walkin    : 2627   Median :33.81  
 Rescue         :6225               ill severe: 1659   Mean   :33.82  
 Return to owner:2972               other resc: 1077   3rd Qu.:33.85  
 Transfer       :4495               (Other)   :12009   Max.   :45.52  
 Other          :1664               NA's      : 2847                  
   longitude       outcome_is_dead was_outcome_alive
 Min.   :-122.70   Mode :logical   Mode :logical    
 1st Qu.:-118.19   FALSE:21304     FALSE:5298       
 Median :-118.17   TRUE :5298      TRUE :21304      
 Mean   :-118.15                                    
 3rd Qu.:-118.13                                    
 Max.   : -73.99                                    
                                                    
                            geopoint      sterilised        outcome_type_posneg
 33.8096122, -118.0826161       :  420   Length:26602       Positive:19640     
 33.7700504, -118.1937395       :  122   Class :character   Negative: 5298     
 33.8708354, -118.1846106       :  114   Mode  :character   Other   : 1664     
 33.8097185, -118.0929813       :   92                                         
 33.7898537, -118.1458794       :   79                                         
 33.84221280000001, -118.1911276:   70                                         
 (Other)                        :25705                                         </code></pre>
</div>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Well there is a date set in 2031 in dob variable, which cannot be as we are only in 2025. Let's remove this value from the dataset.</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>longbeach <span class="ot">&lt;-</span> longbeach <span class="sc">%&gt;%</span></span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(dob <span class="sc">&lt;</span> <span class="fu">as.Date</span>(<span class="st">"2024-12-31"</span>))</span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>longbeach <span class="sc">%&gt;%</span></span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(dob)) <span class="sc">+</span> </span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>() <span class="sc">+</span> </span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Date of birth"</span>, <span class="at">y =</span> <span class="st">"Number of animals"</span>, <span class="at">title =</span> <span class="st">"Distribution of animals in the shelter by date of birth </span><span class="sc">\n</span><span class="st">(Long Beach Animal Shelter, 2017–2024)"</span>) <span class="sc">+</span> </span>
<span id="cb69-9"><a href="#cb69-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="lbas_eda_reg_likar_files/figure-html/unnamed-chunk-43-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>We can now use <code>dob</code> and <code>intake_date</code> to calculate the age on an animal at intake, which I will use later on in the regression models.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>longbeach <span class="sc">%&gt;%</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Age =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(dob), <span class="cn">NA</span>, intake_date<span class="sc">-</span>dob)) <span class="sc">%&gt;%</span></span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Age <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>((Age), <span class="at">fill =</span> adopted) <span class="sc">+</span> </span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">20</span>, <span class="at">position =</span> <span class="st">"dodge"</span>) <span class="sc">+</span> </span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>() <span class="sc">+</span> </span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span> </span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Age in days (log transformed)"</span>, <span class="at">y =</span> <span class="st">"Number of animals"</span>, <span class="at">title =</span> <span class="st">"Adoption outcomes per age on an animal </span><span class="sc">\n</span><span class="st">(Long Beach Animal Shelter, 2017–2024)"</span>, <span class="at">fill =</span> <span class="st">"Adopted"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="lbas_eda_reg_likar_files/figure-html/unnamed-chunk-44-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>longbeach <span class="sc">%&gt;%</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Age =</span> <span class="fu">as.numeric</span>(intake_date <span class="sc">-</span> dob)) <span class="sc">%&gt;%</span></span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(adopted), Age <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">adopted_num =</span> <span class="fu">ifelse</span>(adopted <span class="sc">==</span> <span class="st">"Yes"</span>, <span class="dv">1</span>, <span class="dv">0</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Age, <span class="at">y =</span> adopted_num)) <span class="sc">+</span></span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"loess"</span>, <span class="at">formula =</span> y <span class="sc">~</span> x, <span class="at">se =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">#scale_y_continuous(labels = scales::percent_format(), limits = c(0, 1)) +</span></span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Age in days (log transformed)"</span>, <span class="at">y =</span> <span class="st">"Adoption Rate"</span>, <span class="at">title =</span> <span class="st">"Adoption Rate by Age"</span>) <span class="sc">+</span> </span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span> </span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="lbas_eda_reg_likar_files/figure-html/unnamed-chunk-45-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>longbeach <span class="sc">%&gt;%</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(animal_type <span class="sc">==</span> <span class="st">"Cats"</span> <span class="sc">|</span> animal_type <span class="sc">==</span> <span class="st">"Dogs"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Age =</span> <span class="fu">as.numeric</span>(intake_date <span class="sc">-</span> dob)) <span class="sc">%&gt;%</span></span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(adopted), Age <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">adopted_num =</span> <span class="fu">ifelse</span>(adopted <span class="sc">==</span> <span class="st">"Yes"</span>, <span class="dv">1</span>, <span class="dv">0</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Age, <span class="at">y =</span> adopted_num)) <span class="sc">+</span></span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"loess"</span>, <span class="at">formula =</span> y <span class="sc">~</span> x, <span class="at">se =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a>  <span class="co">#scale_y_continuous(labels = scales::percent_format(), limits = c(0, 1)) +</span></span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Age in days (log transformed)"</span>, <span class="at">y =</span> <span class="st">"Adoption Rate"</span>, <span class="at">title =</span> <span class="st">"Adoption Rate by Age"</span>) <span class="sc">+</span> </span>
<span id="cb73-10"><a href="#cb73-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span> </span>
<span id="cb73-11"><a href="#cb73-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>() <span class="sc">+</span> </span>
<span id="cb73-12"><a href="#cb73-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>animal_type)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="lbas_eda_reg_likar_files/figure-html/unnamed-chunk-46-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Huh, alright. At this point I have to decide how to continue with this variable. I see two options - one is log() + quadratic model, as visualization suggest roughly a quadratic relationship between age and adoption rate. I do not have that much experience with the combination of these, and while I know how to construct a model, I am a bit reserved about the visualizations (still feasible) and model interpretation. I am thinking to use grouping / binning for <code>Age</code>. Binning a continuous variable into groups leads to a loss of statistical power. This is because binning reduces the amount of information available for analysis by grouping continuous values into discrete categories, making it harder to detect subtle but real relationships between variables. Though I still believe at this point, for a solo UNI assignment, where I do not have collaborators to work together on result/model interpretation etc. I think I can do my work better with grouped variable.</p>
</section>
</section>
</section>
<section id="logistic-regression-models" class="level1">
<h1>Logistic regression models</h1>
<p>In this analysis I aim to investigate whether contextual/interventional factors, such as the condition in which the animal was taken in and whether it was sterilised, can significantly improve the prediction of adoption outcomes, compared to a model that includes only animal-focused (biological) characteristics.</p>
<p><strong>Research Question:</strong> Does the inclusion of contextual variables improve model fit in predicting whether an animal gets adopted?</p>
<p><strong>Hypothesis:</strong> Based on preliminary exploratory analysis, I hypothesise that contextual factors will significantly improve the model’s predictive performance over a baseline model that includes only animal-level variables.</p>
<p><strong>Data Description:</strong></p>
<p>The outcome variable is Adoption (1 = adopted, 0 = not adopted).</p>
<p>I restricted the dataset to cats and dogs, excluding other animal types such as birds, exotic, and wildilfe animals, and small mammals due to insufficient sample sizes and for practical reasons that dogs and cats are usually most prevalent animal types in shelters and are most commonly adopted animal types. This narrows the investigation and focuses on specific groups and their adoption rates.</p>
<p><strong>SIMPLE MODEL</strong></p>
<p>In the simple model, I will focus on animal-related, native, given factors, which do not depend on contextual factors or interventions. They include:</p>
<ul>
<li><p>Animal Type (cat or dog)</p></li>
<li><p>Sex (male or female)</p></li>
<li><p>Age, categorized into five bins reflecting developmental stages:</p>
<ul>
<li>Junior (0–1 year),</li>
<li>Young Adult (1–6 years for cats, up to 2 years for dogs),</li>
<li>Mature Adult (7–10 years for cats, 3–6 years for dogs),</li>
<li>Senior (10+ for cats, 7–11 years for dogs),</li>
<li>Geriatric (older then previous levels; in both categories).</li>
</ul></li>
</ul>
<p>This categorization reflects species-specific aging and was used to simplify interpretation and ensure comparability across species. Categorization was based on scientific guidelines for age categorization (Harvey, 2021; Quimby et al., 2021).</p>
<p><strong>COMPLEX MODEL</strong> In the complex model I will add so called contextual predictors, which are situational or depend on interventions. They will include:</p>
<ul>
<li>Intake condition, reduced to five categories (normal, under age/weight, mild physical, moderate physical, severe physical). <em>Less frequent or poorly defined were excluded due to small sample sizes and lack of sufficient context for interpretation.</em></li>
<li>Sterilized status (1 = yes, 0 = no)</li>
</ul>
<p>These variables were selected based on theoretical relevance, availability, and data quality. The regression analysis compares a baseline model including only animal-level variables to a complex model that incorporates contextual predictors.</p>
<section id="final-dataset-preparation" class="level2">
<h2 class="anchored" data-anchor-id="final-dataset-preparation">Final dataset preparation</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>lb_analysis <span class="ot">&lt;-</span> longbeach <span class="sc">%&gt;%</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Use only cats and dogs</span></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(animal_type <span class="sc">==</span> <span class="st">"Cats"</span> <span class="sc">|</span> animal_type <span class="sc">==</span> <span class="st">"Dogs"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Filter out other intake conditions due to reasons listed above</span></span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(intake_condition <span class="sc">!=</span> <span class="st">"Other"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Filter out Unknown sterilisation status</span></span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(sterilised <span class="sc">!=</span> <span class="st">"Unknown"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">age_years =</span> <span class="fu">as.numeric</span>(intake_date <span class="sc">-</span> dob)<span class="sc">/</span><span class="dv">365</span>) <span class="sc">%&gt;%</span></span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Filter false data, as there are false datapoints (age &lt; 0)  (113 datapoints removed)</span></span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(age_years <span class="sc">&gt;</span> <span class="sc">-</span><span class="fl">0.0001</span>) <span class="sc">%&gt;%</span>   </span>
<span id="cb74-11"><a href="#cb74-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Grouping into age bins</span></span>
<span id="cb74-12"><a href="#cb74-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">age_bins =</span> <span class="fu">case_when</span>(</span>
<span id="cb74-13"><a href="#cb74-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Junior (0–1 year) for both cats and dogs</span></span>
<span id="cb74-14"><a href="#cb74-14" aria-hidden="true" tabindex="-1"></a>    age_years <span class="sc">&lt;</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">"Junior"</span>,</span>
<span id="cb74-15"><a href="#cb74-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb74-16"><a href="#cb74-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Cats</span></span>
<span id="cb74-17"><a href="#cb74-17" aria-hidden="true" tabindex="-1"></a>    animal_type <span class="sc">==</span> <span class="st">"Cats"</span> <span class="sc">&amp;</span> age_years <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">&amp;</span> age_years <span class="sc">&lt;=</span> <span class="dv">6</span> <span class="sc">~</span> <span class="st">"Young adult"</span>,</span>
<span id="cb74-18"><a href="#cb74-18" aria-hidden="true" tabindex="-1"></a>    animal_type <span class="sc">==</span> <span class="st">"Cats"</span> <span class="sc">&amp;</span> age_years <span class="sc">&gt;</span> <span class="dv">6</span> <span class="sc">&amp;</span> age_years <span class="sc">&lt;=</span> <span class="dv">10</span> <span class="sc">~</span> <span class="st">"Mature adult"</span>,</span>
<span id="cb74-19"><a href="#cb74-19" aria-hidden="true" tabindex="-1"></a>    animal_type <span class="sc">==</span> <span class="st">"Cats"</span> <span class="sc">&amp;</span> age_years <span class="sc">&gt;</span> <span class="dv">10</span> <span class="sc">&amp;</span> age_years <span class="sc">&lt;=</span> <span class="dv">13</span> <span class="sc">~</span> <span class="st">"Senior"</span>,</span>
<span id="cb74-20"><a href="#cb74-20" aria-hidden="true" tabindex="-1"></a>    animal_type <span class="sc">==</span> <span class="st">"Cats"</span> <span class="sc">&amp;</span> age_years <span class="sc">&gt;</span> <span class="dv">13</span> <span class="sc">~</span> <span class="st">"Geriatric"</span>,</span>
<span id="cb74-21"><a href="#cb74-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb74-22"><a href="#cb74-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Dogs</span></span>
<span id="cb74-23"><a href="#cb74-23" aria-hidden="true" tabindex="-1"></a>    animal_type <span class="sc">==</span> <span class="st">"Dogs"</span> <span class="sc">&amp;</span> age_years <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">&amp;</span> age_years <span class="sc">&lt;</span> <span class="dv">2</span> <span class="sc">~</span> <span class="st">"Young adult"</span>,</span>
<span id="cb74-24"><a href="#cb74-24" aria-hidden="true" tabindex="-1"></a>    animal_type <span class="sc">==</span> <span class="st">"Dogs"</span> <span class="sc">&amp;</span> age_years <span class="sc">&gt;=</span> <span class="dv">2</span> <span class="sc">&amp;</span> age_years <span class="sc">&lt;=</span> <span class="dv">6</span> <span class="sc">~</span> <span class="st">"Mature adult"</span>,</span>
<span id="cb74-25"><a href="#cb74-25" aria-hidden="true" tabindex="-1"></a>    animal_type <span class="sc">==</span> <span class="st">"Dogs"</span> <span class="sc">&amp;</span> age_years <span class="sc">&gt;</span> <span class="dv">6</span> <span class="sc">&amp;</span> age_years <span class="sc">&lt;=</span> <span class="dv">11</span> <span class="sc">~</span> <span class="st">"Senior"</span>,</span>
<span id="cb74-26"><a href="#cb74-26" aria-hidden="true" tabindex="-1"></a>    animal_type <span class="sc">==</span> <span class="st">"Dogs"</span> <span class="sc">&amp;</span> age_years <span class="sc">&gt;</span> <span class="dv">11</span> <span class="sc">~</span> <span class="st">"Geriatric"</span>,</span>
<span id="cb74-27"><a href="#cb74-27" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb74-28"><a href="#cb74-28" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_character_</span></span>
<span id="cb74-29"><a href="#cb74-29" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span></span>
<span id="cb74-30"><a href="#cb74-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">age_bins =</span> <span class="fu">fct_relevel</span>(age_bins, <span class="st">"Junior"</span>, <span class="st">"Young adult"</span>, <span class="st">"Mature adult"</span>, <span class="st">"Senior"</span>, <span class="st">"Geriatric"</span>),</span>
<span id="cb74-31"><a href="#cb74-31" aria-hidden="true" tabindex="-1"></a>         <span class="at">intake_condition =</span> <span class="fu">fct_relevel</span>(intake_condition, <span class="st">"Normal"</span>, <span class="st">"Mild physical"</span>, <span class="st">"Moderate physical"</span>, <span class="st">"Severe physical"</span>, <span class="st">"Under age/weight"</span>),</span>
<span id="cb74-32"><a href="#cb74-32" aria-hidden="true" tabindex="-1"></a>         <span class="at">adopted =</span> <span class="fu">ifelse</span>(adopted <span class="sc">==</span> <span class="st">"Yes"</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb74-33"><a href="#cb74-33" aria-hidden="true" tabindex="-1"></a>         <span class="at">sterilised =</span> <span class="fu">factor</span>(sterilised),</span>
<span id="cb74-34"><a href="#cb74-34" aria-hidden="true" tabindex="-1"></a>         <span class="at">sex =</span> <span class="fu">factor</span>(sex)) <span class="sc">%&gt;%</span></span>
<span id="cb74-35"><a href="#cb74-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(animal_id, animal_type, sex, age_bins, intake_condition, sterilised, adopted) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="simple-model-animal-related-native-factors" class="level2">
<h2 class="anchored" data-anchor-id="simple-model-animal-related-native-factors">Simple model (animal related, native factors)</h2>
<section id="construct-the-model" class="level3">
<h3 class="anchored" data-anchor-id="construct-the-model">Construct the model</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>lb_simple_mdl <span class="ot">&lt;-</span> <span class="fu">glm</span>(adopted <span class="sc">~</span> animal_type <span class="sc">+</span> sex <span class="sc">+</span> age_bins, </span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">data =</span> lb_analysis, <span class="at">family =</span> binomial)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Check model summary:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lb_simple_mdl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = adopted ~ animal_type + sex + age_bins, family = binomial, 
    data = lb_analysis)

Coefficients:
                     Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)          -0.80043    0.02855 -28.035  &lt; 2e-16 ***
animal_typeDogs       0.16798    0.04092   4.105 4.04e-05 ***
sexMale               0.01055    0.03188   0.331    0.741    
age_binsYoung adult  -0.23638    0.04231  -5.587 2.31e-08 ***
age_binsMature adult -0.30695    0.05084  -6.038 1.56e-09 ***
age_binsSenior       -0.82912    0.07085 -11.702  &lt; 2e-16 ***
age_binsGeriatric    -1.39325    0.13451 -10.358  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 23603  on 19810  degrees of freedom
Residual deviance: 23342  on 19804  degrees of freedom
AIC: 23356

Number of Fisher Scoring iterations: 4</code></pre>
</div>
</div>
</section>
<section id="visualize-the-model" class="level3">
<h3 class="anchored" data-anchor-id="visualize-the-model">Visualize the model</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_model</span>(lb_simple_mdl, <span class="at">type =</span> <span class="st">"pred"</span>, <span class="at">terms =</span> <span class="fu">c</span>(<span class="st">"age_bins"</span>, <span class="st">"animal_type"</span>)) <span class="sc">+</span> <span class="fu">theme_minimal</span>() <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Age bins"</span>, <span class="at">y =</span> <span class="st">"Adopted"</span>, <span class="at">title =</span> <span class="st">"Predicted probabilities of adoption for dogs and cats, separated by age bins"</span>, <span class="at">color =</span> <span class="st">"Animal type"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="lbas_eda_reg_likar_files/figure-html/unnamed-chunk-50-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="checking-assumptions" class="level3">
<h3 class="anchored" data-anchor-id="checking-assumptions">Checking assumptions</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="fu">check_model</span>(lb_simple_mdl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="lbas_eda_reg_likar_files/figure-html/unnamed-chunk-51-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Check residuals:</strong></p>
<p>Not mandatory for logistic regression, but anyways.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="fu">check_residuals</span>(lb_simple_mdl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>OK: Simulated residuals appear as uniformly distributed (p = 0.908).</code></pre>
</div>
</div>
<p><strong>Multicollinearity:</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="fu">check_collinearity</span>(lb_simple_mdl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># Check for Multicollinearity

Low Correlation

        Term  VIF   VIF 95% CI Increased SE Tolerance Tolerance 95% CI
 animal_type 1.63 [1.60, 1.66]         1.28      0.61     [0.60, 0.63]
         sex 1.00 [1.00, 1.09]         1.00      1.00     [0.92, 1.00]
    age_bins 1.63 [1.60, 1.66]         1.28      0.61     [0.60, 0.63]</code></pre>
</div>
</div>
<p><strong>Influential points:</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Leverage</span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>n_obs <span class="ot">=</span> <span class="fu">nrow</span>(lb_analysis)</span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>params <span class="ot">=</span> <span class="fu">length</span>(<span class="fu">coef</span>(lb_simple_mdl)) <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a>influential_lev <span class="ot">&lt;-</span> <span class="fu">hatvalues</span>(lb_simple_mdl) <span class="sc">&gt;</span>  <span class="dv">2</span><span class="sc">*</span>(params<span class="sc">+</span><span class="dv">1</span>)<span class="sc">/</span>n_obs</span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(influential_lev)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 781</code></pre>
</div>
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>lb_simple_mdl <span class="sc">%&gt;%</span></span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">augment</span>() <span class="sc">%&gt;%</span></span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">high_leverage =</span> <span class="fu">ifelse</span>(.hat <span class="sc">&gt;</span> <span class="dv">2</span><span class="sc">*</span>(params<span class="sc">+</span><span class="dv">1</span>)<span class="sc">/</span>n_obs, <span class="dv">1</span>, <span class="dv">0</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(high_leverage)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 2
  high_leverage     n
          &lt;dbl&gt; &lt;int&gt;
1             0 19030
2             1   781</code></pre>
</div>
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="co"># OK so there are 781 influential points if we only consider leverage. Let's now check Cook's distance.</span></span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Cook's distance</span></span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a>influential_cd <span class="ot">&lt;-</span> <span class="fu">cooks.distance</span>(lb_simple_mdl) <span class="sc">&gt;</span> <span class="dv">4</span> <span class="sc">/</span> n_obs</span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(influential_cd) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 523</code></pre>
</div>
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">cooks.distance</span>(lb_simple_mdl) <span class="sc">&gt;</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="co"># And 523 influential points according to 4/n rule of thumb and 0 according to D &gt; 1. </span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a><span class="co">#First I want to check whether leverage and Cook's distance influential points overlap</span></span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a>check_influence_overlap <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">lev =</span> influential_lev, <span class="at">cd =</span> influential_cd )</span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a>check_influence_overlap <span class="sc">%&gt;%</span></span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">sum</span>(lev <span class="sc">==</span> <span class="cn">TRUE</span> <span class="sc">&amp;</span> cd <span class="sc">==</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  sum(lev == TRUE &amp; cd == TRUE)
1                           118</code></pre>
</div>
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="co"># There are 118 points that are considered influential both to leverage and Cook's distance threshold</span></span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a><span class="co"># I want to check the data that is influential according to Cook's distance</span></span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a>lb_analysis <span class="sc">%&gt;%</span></span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(influential_cd) <span class="sc">%&gt;%</span></span>
<span id="cb94-6"><a href="#cb94-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(age_bins)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
  age_bins         n
  &lt;fct&gt;        &lt;int&gt;
1 Mature adult   120
2 Senior         336
3 Geriatric       67</code></pre>
</div>
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="co"># All the influential points according to Cook's distance come from older groups. Let's now check what is overall number of adoptions per age bin. </span></span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a>lb_analysis <span class="sc">%&gt;%</span></span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">#filter(influential_cd) %&gt;%</span></span>
<span id="cb96-5"><a href="#cb96-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(age_bins, adopted)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 3
   age_bins     adopted     n
   &lt;fct&gt;          &lt;dbl&gt; &lt;int&gt;
 1 Junior             0  6343
 2 Junior             1  2952
 3 Young adult        0  2959
 4 Young adult        1  1122
 5 Mature adult       0  2919
 6 Mature adult       1  1128
 7 Senior             0  1466
 8 Senior             1   336
 9 Geriatric          0   519
10 Geriatric          1    67</code></pre>
</div>
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We see that basically all the influential points from "geriatric" and "senior" are datapoints that are also "adopted". More on this topic in the text below. </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Cook’s distance analysis revealed influential observations (n = 523) concentrated among adopted senior (n=336/1,802 total seniors) and geriatric (n=67/586 total geriatrics) animals. Notably, these points accounted for all adoptions in their age groups—when hypothetically excluded, the model would lose its ability to estimate adoption effects for senior/geriatric animals entirely. To address this,I will try one solution: merge senior and geriatric categories into an “Older” group and re-analyse the model to see what happens.</p>
</section>
<section id="assessing-model-fit" class="level3">
<h3 class="anchored" data-anchor-id="assessing-model-fit">Assessing model fit</h3>
<section id="preudo-r-squared" class="level4">
<h4 class="anchored" data-anchor-id="preudo-r-squared">Preudo R-squared</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="fu">model_performance</span>(lb_simple_mdl)   <span class="co"># Focusing on Tjur's R2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># Indices of model performance

AIC       |      AICc |       BIC | Tjur's R2 |  RMSE | Sigma | Log_loss
------------------------------------------------------------------------
23356.476 | 23356.482 | 23411.734 |     0.012 | 0.448 | 1.000 |    0.589

AIC       | Score_log |   PCP
-----------------------------
23356.476 |      -Inf | 0.599</code></pre>
</div>
</div>
</section>
<section id="roc-and-auc" class="level4">
<h4 class="anchored" data-anchor-id="roc-and-auc">ROC and AUC</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get predicted probabilities</span></span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>pred_probs_simple_mdl <span class="ot">&lt;-</span> <span class="fu">predict</span>(lb_simple_mdl, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate ROC curve</span></span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a>roc_curve_simple_mdl <span class="ot">&lt;-</span> <span class="fu">roc</span>(lb_analysis<span class="sc">$</span>adopted, pred_probs_simple_mdl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = 0, case = 1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &lt; cases</code></pre>
</div>
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(roc_curve_simple_mdl)  <span class="co"># Visualize</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="lbas_eda_reg_likar_files/figure-html/unnamed-chunk-56-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="fu">auc</span>(roc_curve_simple_mdl)   </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Area under the curve: 0.5634</code></pre>
</div>
</div>
<p>Extract threshold</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a>lb_simple_mdl_thresh <span class="ot">&lt;-</span> <span class="fu">coords</span>(roc_curve_simple_mdl, <span class="st">"best"</span>, <span class="at">ret =</span> <span class="st">"threshold"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="confusion-matrix-for-determining-accuracy" class="level4">
<h4 class="anchored" data-anchor-id="confusion-matrix-for-determining-accuracy">Confusion matrix for determining accuracy</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a>lb_simple_mdl_pred_binary <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(pred_probs_simple_mdl <span class="sc">&gt;</span> lb_simple_mdl_thresh[[<span class="dv">1</span>]], <span class="st">"Yes"</span>, <span class="st">"No"</span>)</span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a>lb_analysis <span class="ot">&lt;-</span> lb_analysis <span class="sc">%&gt;%</span></span>
<span id="cb108-4"><a href="#cb108-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">adopted_str =</span> <span class="fu">ifelse</span>(adopted <span class="sc">==</span> <span class="dv">0</span>, <span class="st">"No"</span>, <span class="st">"Yes"</span>))</span>
<span id="cb108-5"><a href="#cb108-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-6"><a href="#cb108-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-7"><a href="#cb108-7" aria-hidden="true" tabindex="-1"></a>lb_simple_mdl_conf_matrix <span class="ot">&lt;-</span> <span class="fu">confusionMatrix</span>(<span class="fu">factor</span>(lb_simple_mdl_pred_binary), <span class="fu">factor</span>(lb_analysis<span class="sc">$</span>adopted_str))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="all-model-fit-indices" class="level4">
<h4 class="anchored" data-anchor-id="all-model-fit-indices">All model fit indices:</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract variables</span></span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a>lb_simple_mdl_pseudo_r2 <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">model_performance</span>(lb_simple_mdl)[[<span class="dv">4</span>]], <span class="dv">4</span>)</span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a>lb_simple_mdl_auc_val <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">auc</span>(roc_curve_simple_mdl)[<span class="dv">1</span>],<span class="dv">4</span>)</span>
<span id="cb109-4"><a href="#cb109-4" aria-hidden="true" tabindex="-1"></a>lb_simple_mdl_accuracy <span class="ot">&lt;-</span> <span class="fu">round</span>(lb_simple_mdl_conf_matrix<span class="sc">$</span>overall[<span class="st">"Accuracy"</span>], <span class="dv">4</span>)</span>
<span id="cb109-5"><a href="#cb109-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-6"><a href="#cb109-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Nicely formatted output</span></span>
<span id="cb109-7"><a href="#cb109-7" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Simple model - Model Fit Summary:</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb109-8"><a href="#cb109-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"---------------------------------</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb109-9"><a href="#cb109-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sprintf</span>(<span class="st">"McFadden's Pseudo R²: %.3f</span><span class="sc">\n</span><span class="st">"</span>, lb_simple_mdl_pseudo_r2),</span>
<span id="cb109-10"><a href="#cb109-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sprintf</span>(<span class="st">"AUC (ROC): %.3f</span><span class="sc">\n</span><span class="st">"</span>, lb_simple_mdl_auc_val),</span>
<span id="cb109-11"><a href="#cb109-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sprintf</span>(<span class="st">"Accuracy: %.3f</span><span class="sc">\n</span><span class="st">"</span>, lb_simple_mdl_accuracy))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple model - Model Fit Summary:
 ---------------------------------
 McFadden's Pseudo R²: 0.012
 AUC (ROC): 0.563
 Accuracy: 0.521</code></pre>
</div>
</div>
</section>
</section>
<section id="summary-of-the-simple-model" class="level3">
<h3 class="anchored" data-anchor-id="summary-of-the-simple-model">Summary of the simple model</h3>
<p>Important things to point out:</p>
<ul>
<li><p><strong>Model summary:</strong> The basic logistic regression showed dogs had significantly higher adoption odds than cats (β=0.168, p&lt;0.001), while sex had no significant effect. All older age categories showed progressively lower adoption odds compared to juveniles, with the strongest negative effects for geriatric animals (β=-1.393, p&lt;0.001).</p></li>
<li><p><strong>Model diagnostics:</strong> Residual diagnostics indicated good fit (uniform distribution, p=0.908) with no multicollinearity concerns (all VIFs &lt;1.63). Cook’s distance identified 523 influential points, all representing adopted senior/geriatric animals. These constituted 100% of adopted cases in these age groups, thus age effects estimates were entirely dependent on these observations. This suggested to collapse the groups rather than eliminate the influential points completely.</p></li>
</ul>
<p><strong>Fit indices:</strong> The model showed poor predictive performance with McFadden’s R²=0.012 and AUC=0.563 and classification accuracy of 52.1%, barely better than chance.</p>
<p><strong>Next steps:</strong> To address the influential points issue and improve model stability, I will merge senior and geriatric categories into a combined “Older” group and refit the model. I will repeat the same model analysis as in the case of this, first model.</p>
</section>
</section>
<section id="updated-simple-model-merging-geriatric-and-senior-age-bins" class="level2">
<h2 class="anchored" data-anchor-id="updated-simple-model-merging-geriatric-and-senior-age-bins">Updated simple model (merging “geriatric” and “senior” age bins)</h2>
<p>Merge levels:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a>lb_analysis_merged_age <span class="ot">&lt;-</span> lb_analysis <span class="sc">%&gt;%</span></span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">age_bins =</span> <span class="fu">fct_collapse</span>(age_bins, <span class="st">"Older"</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"Senior"</span>, <span class="st">"Geriatric"</span>)))</span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-4"><a href="#cb111-4" aria-hidden="true" tabindex="-1"></a>lb_analysis_merged_age <span class="sc">%&gt;%</span></span>
<span id="cb111-5"><a href="#cb111-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(age_bins, adopted)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 8 × 3
  age_bins     adopted     n
  &lt;fct&gt;          &lt;dbl&gt; &lt;int&gt;
1 Junior             0  6343
2 Junior             1  2952
3 Young adult        0  2959
4 Young adult        1  1122
5 Mature adult       0  2919
6 Mature adult       1  1128
7 Older              0  1985
8 Older              1   403</code></pre>
</div>
</div>
<section id="construct-new-model" class="level3">
<h3 class="anchored" data-anchor-id="construct-new-model">Construct new model</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a>lb_simple_merged_mdl <span class="ot">&lt;-</span> <span class="fu">glm</span>(adopted <span class="sc">~</span> animal_type <span class="sc">+</span> sex <span class="sc">+</span> age_bins, </span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">data =</span> lb_analysis_merged_age, <span class="at">family =</span> binomial)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Check model summary:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lb_simple_merged_mdl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = adopted ~ animal_type + sex + age_bins, family = binomial, 
    data = lb_analysis_merged_age)

Coefficients:
                     Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)          -0.80103    0.02855 -28.060  &lt; 2e-16 ***
animal_typeDogs       0.17090    0.04087   4.181 2.90e-05 ***
sexMale               0.01068    0.03187   0.335    0.738    
age_binsYoung adult  -0.23694    0.04231  -5.601 2.14e-08 ***
age_binsMature adult -0.30905    0.05082  -6.081 1.19e-09 ***
age_binsOlder        -0.94999    0.06567 -14.466  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 23603  on 19810  degrees of freedom
Residual deviance: 23359  on 19805  degrees of freedom
AIC: 23371

Number of Fisher Scoring iterations: 4</code></pre>
</div>
</div>
</section>
<section id="visualize-the-model-1" class="level3">
<h3 class="anchored" data-anchor-id="visualize-the-model-1">Visualize the model</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_model</span>(lb_simple_merged_mdl, <span class="at">type =</span> <span class="st">"pred"</span>, <span class="at">terms =</span> <span class="fu">c</span>(<span class="st">"age_bins"</span>, <span class="st">"animal_type"</span>)) <span class="sc">+</span> <span class="fu">theme_minimal</span>() <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Age bins"</span>, <span class="at">y =</span> <span class="st">"Adopted"</span>, <span class="at">title =</span> <span class="st">"Predicted probabilities of adoption for dogs and cats, separated by age bins"</span>, <span class="at">color =</span> <span class="st">"Animal type"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="lbas_eda_reg_likar_files/figure-html/unnamed-chunk-63-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="checking-assumptions-1" class="level3">
<h3 class="anchored" data-anchor-id="checking-assumptions-1">Checking assumptions</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="fu">check_model</span>(lb_simple_merged_mdl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="lbas_eda_reg_likar_files/figure-html/unnamed-chunk-64-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Multicolinearity:</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="fu">check_collinearity</span>(lb_simple_merged_mdl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># Check for Multicollinearity

Low Correlation

        Term  VIF   VIF 95% CI Increased SE Tolerance Tolerance 95% CI
 animal_type 1.63 [1.60, 1.66]         1.28      0.62     [0.60, 0.63]
         sex 1.00 [1.00, 1.09]         1.00      1.00     [0.92, 1.00]
    age_bins 1.63 [1.60, 1.66]         1.28      0.62     [0.60, 0.63]</code></pre>
</div>
</div>
<p><strong>Influential points:</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Leverage</span></span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a>n_obs_2 <span class="ot">=</span> <span class="fu">nrow</span>(lb_analysis_merged_age)</span>
<span id="cb120-3"><a href="#cb120-3" aria-hidden="true" tabindex="-1"></a>params_2 <span class="ot">=</span> <span class="fu">length</span>(<span class="fu">coef</span>(lb_simple_merged_mdl)) <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb120-4"><a href="#cb120-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-5"><a href="#cb120-5" aria-hidden="true" tabindex="-1"></a>influential_lev_2 <span class="ot">&lt;-</span> <span class="fu">hatvalues</span>(lb_simple_merged_mdl) <span class="sc">&gt;</span>  <span class="dv">2</span><span class="sc">*</span>(params_2<span class="sc">+</span><span class="dv">1</span>)<span class="sc">/</span>n_obs_2</span>
<span id="cb120-6"><a href="#cb120-6" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(influential_lev_2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a>lb_simple_merged_mdl <span class="sc">%&gt;%</span></span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">augment</span>() <span class="sc">%&gt;%</span></span>
<span id="cb122-3"><a href="#cb122-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">high_leverage =</span> <span class="fu">ifelse</span>(.hat <span class="sc">&gt;</span> <span class="dv">2</span><span class="sc">*</span>(params_2<span class="sc">+</span><span class="dv">1</span>)<span class="sc">/</span>n_obs_2, <span class="dv">1</span>, <span class="dv">0</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb122-4"><a href="#cb122-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(high_leverage)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 2
  high_leverage     n
          &lt;dbl&gt; &lt;int&gt;
1             0 19811</code></pre>
</div>
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a><span class="co"># After merging age bins, there are no more influential points when leverage is considered.</span></span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb124-3"><a href="#cb124-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Cook's distance</span></span>
<span id="cb124-4"><a href="#cb124-4" aria-hidden="true" tabindex="-1"></a>influential_cd_2 <span class="ot">&lt;-</span> <span class="fu">cooks.distance</span>(lb_simple_merged_mdl) <span class="sc">&gt;</span> <span class="dv">4</span> <span class="sc">/</span> n_obs_2</span>
<span id="cb124-5"><a href="#cb124-5" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(influential_cd_2) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 523</code></pre>
</div>
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">cooks.distance</span>(lb_simple_merged_mdl) <span class="sc">&gt;</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We still have 523 influential points according to 4/n rule of thumb and 0 according to D &gt; 1. However maximum Cook's distance decreased from about 0.002 to about 0.0005, so there was definitely some improvement after age bin merging. </span></span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-3"><a href="#cb128-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(lb_simple_merged_mdl, <span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="lbas_eda_reg_likar_files/figure-html/unnamed-chunk-66-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Check residuals</strong></p>
<p>Here is where I ran into a bit of confusion that will probably take me some time to figure out, probably more time is needed than the deadline for the report. I was checking residuals in 2 ways, one with <code>check_residuals</code> and another with <code>binned residuals</code> (see both below).</p>
<p>Initial checks with check_residuals() indicated no major violations of model assumptions (quantile residuals followed expected uniform distribution, however this is NOT a requirement in any case, at least to my current knowledge). However, the binned residuals plot (binned_residuals()) showed poor fit, with only 31% of residuals within error bounds—suggesting localized prediction inaccuracies for certain subgroups. While tools like DHARMa (simulated residuals) were explored, the results (a gray-shaded plot with a straight red line) proved difficult to interpret given time constraints and my limited familiarity with advanced diagnostics. At this point I am not sure how to deal with this problem, so I think I will continue and be careful about interpretation of model results later on.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a><span class="fu">check_residuals</span>(lb_simple_merged_mdl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>OK: Simulated residuals appear as uniformly distributed (p = 0.918).</code></pre>
</div>
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a><span class="fu">binned_residuals</span>(lb_simple_merged_mdl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Warning: Probably bad model fit. Only about 31% of the residuals are inside the error bounds.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a>simulated_residuals_simple_merged_mdl <span class="ot">&lt;-</span> <span class="fu">simulateResiduals</span>(lb_simple_merged_mdl)</span>
<span id="cb133-2"><a href="#cb133-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(simulated_residuals_simple_merged_mdl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="lbas_eda_reg_likar_files/figure-html/unnamed-chunk-67-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="assessing-model-fit-1" class="level3">
<h3 class="anchored" data-anchor-id="assessing-model-fit-1">Assessing model fit</h3>
<section id="preudo-r-squared-1" class="level4">
<h4 class="anchored" data-anchor-id="preudo-r-squared-1">Preudo R-squared</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a><span class="fu">model_performance</span>(lb_simple_merged_mdl)   <span class="co"># Focusing on Tjur's R2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># Indices of model performance

AIC       |      AICc |       BIC | Tjur's R2 |  RMSE | Sigma | Log_loss
------------------------------------------------------------------------
23371.414 | 23371.419 | 23418.778 |     0.012 | 0.448 | 1.000 |    0.590

AIC       | Score_log |   PCP
-----------------------------
23371.414 |      -Inf | 0.599</code></pre>
</div>
</div>
</section>
<section id="roc-and-auc-1" class="level4">
<h4 class="anchored" data-anchor-id="roc-and-auc-1">ROC and AUC</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb136"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get predicted probabilities</span></span>
<span id="cb136-2"><a href="#cb136-2" aria-hidden="true" tabindex="-1"></a>pred_probs_simple_merged_mdl <span class="ot">&lt;-</span> <span class="fu">predict</span>(lb_simple_merged_mdl, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb136-3"><a href="#cb136-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-4"><a href="#cb136-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate ROC curve</span></span>
<span id="cb136-5"><a href="#cb136-5" aria-hidden="true" tabindex="-1"></a>roc_curve_simple_merged_mdl <span class="ot">&lt;-</span> <span class="fu">roc</span>(lb_analysis_merged_age<span class="sc">$</span>adopted, pred_probs_simple_merged_mdl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = 0, case = 1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &lt; cases</code></pre>
</div>
<div class="sourceCode cell-code" id="cb139"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(roc_curve_simple_merged_mdl)  <span class="co"># Visualize</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="lbas_eda_reg_likar_files/figure-html/unnamed-chunk-69-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb140"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a><span class="fu">auc</span>(roc_curve_simple_merged_mdl)   </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Area under the curve: 0.5628</code></pre>
</div>
</div>
<p>Extract threshold</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb142"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a>lb_simple_merged_mdl_thresh <span class="ot">&lt;-</span> <span class="fu">coords</span>(roc_curve_simple_merged_mdl, <span class="st">"best"</span>, <span class="at">ret =</span> <span class="st">"threshold"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="confusion-matrix-for-determining-accuracy-1" class="level4">
<h4 class="anchored" data-anchor-id="confusion-matrix-for-determining-accuracy-1">Confusion matrix for determining accuracy</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb143"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a>lb_simple_merged_mdl_pred_binary <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(pred_probs_simple_merged_mdl <span class="sc">&gt;</span> lb_simple_merged_mdl_thresh[[<span class="dv">1</span>]], <span class="st">"Yes"</span>, <span class="st">"No"</span>)</span>
<span id="cb143-2"><a href="#cb143-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-3"><a href="#cb143-3" aria-hidden="true" tabindex="-1"></a>lb_analysis_merged_age <span class="ot">&lt;-</span> lb_analysis_merged_age <span class="sc">%&gt;%</span></span>
<span id="cb143-4"><a href="#cb143-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">adopted_str =</span> <span class="fu">ifelse</span>(adopted <span class="sc">==</span> <span class="dv">0</span>, <span class="st">"No"</span>, <span class="st">"Yes"</span>))</span>
<span id="cb143-5"><a href="#cb143-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-6"><a href="#cb143-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-7"><a href="#cb143-7" aria-hidden="true" tabindex="-1"></a>lb_simple_merged_mdl_conf_matrix <span class="ot">&lt;-</span> <span class="fu">confusionMatrix</span>(<span class="fu">factor</span>(lb_simple_merged_mdl_pred_binary), <span class="fu">factor</span>(lb_analysis_merged_age<span class="sc">$</span>adopted_str))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="all-model-fit-indices-1" class="level4">
<h4 class="anchored" data-anchor-id="all-model-fit-indices-1">All model fit indices:</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb144"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract variables</span></span>
<span id="cb144-2"><a href="#cb144-2" aria-hidden="true" tabindex="-1"></a>lb_simple_merged_mdl_pseudo_r2 <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">model_performance</span>(lb_simple_merged_mdl)[[<span class="dv">4</span>]], <span class="dv">4</span>)</span>
<span id="cb144-3"><a href="#cb144-3" aria-hidden="true" tabindex="-1"></a>lb_simple_merged_mdl_auc_val <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">auc</span>(roc_curve_simple_merged_mdl)[<span class="dv">1</span>],<span class="dv">4</span>)</span>
<span id="cb144-4"><a href="#cb144-4" aria-hidden="true" tabindex="-1"></a>lb_simple_merged_mdl_accuracy <span class="ot">&lt;-</span> <span class="fu">round</span>(lb_simple_merged_mdl_conf_matrix<span class="sc">$</span>overall[<span class="st">"Accuracy"</span>], <span class="dv">4</span>)</span>
<span id="cb144-5"><a href="#cb144-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-6"><a href="#cb144-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-7"><a href="#cb144-7" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Simple model (updated - grouped age bins) - Model Fit Summary:</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb144-8"><a href="#cb144-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"---------------------------------</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb144-9"><a href="#cb144-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sprintf</span>(<span class="st">"McFadden's Pseudo R²: %.3f</span><span class="sc">\n</span><span class="st">"</span>, lb_simple_merged_mdl_pseudo_r2),</span>
<span id="cb144-10"><a href="#cb144-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sprintf</span>(<span class="st">"AUC (ROC): %.3f</span><span class="sc">\n</span><span class="st">"</span>, lb_simple_merged_mdl_auc_val),</span>
<span id="cb144-11"><a href="#cb144-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sprintf</span>(<span class="st">"Accuracy: %.3f</span><span class="sc">\n</span><span class="st">"</span>, lb_simple_merged_mdl_accuracy))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple model (updated - grouped age bins) - Model Fit Summary:
 ---------------------------------
 McFadden's Pseudo R²: 0.012
 AUC (ROC): 0.563
 Accuracy: 0.521</code></pre>
</div>
</div>
</section>
</section>
<section id="summary-of-updated-simple-model---merged-senior-and-geriatric-age-bins" class="level3">
<h3 class="anchored" data-anchor-id="summary-of-updated-simple-model---merged-senior-and-geriatric-age-bins">Summary of updated simple model - merged senior and geriatric age bins</h3>
<p>Important thing to point out before proceeding to the complex model:</p>
<ul>
<li><p><strong>Model summary:</strong> The merged model (combining senior/geriatric into “Older”) maintained the same significant predictors as the original: dogs showed higher adoption odds compared to cats (β=0.171 vs initial 0.168, p&lt;0.001) while sex remained non-significant. The combined “Older” coefficient (β=-0.950) represents an “intermediate effect” between the original separate estimates for senior (β=-0.829) and geriatric (β=-1.393), so we can assume that merging age bins preserved the overall age trend.</p></li>
<li><p><strong>Model diagnostics:</strong> Multicollinearity remained low (VIFs&lt;1.63). The merged model showed improvement in influential points: maximum Cook’s distance decreased 75% (0.002→0.0005), though 523 points still exceeded the 4/n threshold and 0 influential points were identified according to D &gt; 1 threshold. Residual diagnostics were consistent between models - quatile residuals sugegst model structure adequacy (p&gt;0.9) but localized misfit in binned residuals (only 31% within bounds), suggesting the problem with specific subgroups despite the age bin merging.</p></li>
<li><p><strong>Fit Indices Comparison:</strong> No meaningful differences emerged in model performance:, identical McFadden’s R² (0.012), identical AUC (0.563), identical accuracy (52.1%).</p></li>
</ul>
<p>This suggests the age bin merging addressed concerns about influential points without improving predictive power. Let’s now continue to the complex model, where contextual factors, namely <strong>sterilization status and intake condition</strong> will be added.</p>
</section>
</section>
<section id="complex-model---added-contextual-predictors" class="level2">
<h2 class="anchored" data-anchor-id="complex-model---added-contextual-predictors">Complex model - added contextual predictors</h2>
<p>As mentioned several times before, while the simple model only considered animal-centered, native predictors like age, sex and type (dog vs.&nbsp;cat), we will introduce contextual predictors (sterilization status and intake condition) to the more complex model and investigate whether these predictors significantly improve model fit and predictive power - determining whether animal gets adopted or not. We will use the dataset with merged age bins for geriatric and senior.</p>
<section id="construct-the-model-1" class="level3">
<h3 class="anchored" data-anchor-id="construct-the-model-1">Construct the model</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb146"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a>lb_complex_mdl <span class="ot">&lt;-</span> <span class="fu">glm</span>(adopted <span class="sc">~</span> animal_type <span class="sc">+</span> sex <span class="sc">+</span> age_bins <span class="sc">+</span> sterilised <span class="sc">+</span> intake_condition, <span class="at">data =</span> lb_analysis_merged_age, <span class="at">family =</span> binomial)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Check model summary:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb147"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lb_complex_mdl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = adopted ~ animal_type + sex + age_bins + sterilised + 
    intake_condition, family = binomial, data = lb_analysis_merged_age)

Coefficients:
                                  Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)                       -1.84418    0.05196 -35.490  &lt; 2e-16 ***
animal_typeDogs                    0.30594    0.05031   6.082 1.19e-09 ***
sexMale                           -0.01725    0.03750  -0.460 0.645460    
age_binsYoung adult               -1.03165    0.05500 -18.757  &lt; 2e-16 ***
age_binsMature adult              -0.99439    0.06269 -15.861  &lt; 2e-16 ***
age_binsOlder                     -1.97282    0.07721 -25.551  &lt; 2e-16 ***
sterilisedYes                      2.69061    0.04325  62.213  &lt; 2e-16 ***
intake_conditionMild physical      0.04741    0.06944   0.683 0.494815    
intake_conditionModerate physical -0.22433    0.08347  -2.688 0.007198 ** 
intake_conditionSevere physical   -0.83173    0.10608  -7.840 4.50e-15 ***
intake_conditionUnder age/weight  -0.21336    0.05882  -3.628 0.000286 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 23603  on 19810  degrees of freedom
Residual deviance: 17806  on 19800  degrees of freedom
AIC: 17828

Number of Fisher Scoring iterations: 5</code></pre>
</div>
</div>
</section>
<section id="visualize-the-model-2" class="level3">
<h3 class="anchored" data-anchor-id="visualize-the-model-2">Visualize the model</h3>
<p>Visualization of 4 variables.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb149"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_model</span>(lb_complex_mdl, <span class="at">type =</span> <span class="st">"pred"</span>, <span class="at">terms =</span> <span class="fu">c</span>(<span class="st">"animal_type"</span>, <span class="st">"intake_condition"</span>, <span class="st">"age_bins"</span>, <span class="st">"sterilised"</span>)) <span class="sc">+</span> </span>
<span id="cb149-2"><a href="#cb149-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span> </span>
<span id="cb149-3"><a href="#cb149-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="st">"Adopted"</span>, <span class="at">title =</span> <span class="st">"Predicted probabilities of adoption for dogs and cats, </span><span class="sc">\n</span><span class="st">separated by age, sterilization status and intake condition."</span>, <span class="at">color =</span> <span class="st">"Intake condition"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="lbas_eda_reg_likar_files/figure-html/unnamed-chunk-75-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>We can see a significant difference between sterilized and non-sterilized panels, with much higher adoption probabilities for sterilized animals.</p>
<p>Let’s now visualize only sterilized animals.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb150"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_model</span>(lb_complex_mdl, <span class="at">type =</span> <span class="st">"pred"</span>, <span class="at">terms =</span> <span class="fu">c</span>(<span class="st">"animal_type"</span>, <span class="st">"intake_condition"</span>, <span class="st">"age_bins"</span>, <span class="st">"sterilised [Yes]"</span>)) <span class="sc">+</span> </span>
<span id="cb150-2"><a href="#cb150-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span> </span>
<span id="cb150-3"><a href="#cb150-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="st">"Adopted"</span>, <span class="at">title =</span> <span class="st">"Predicted probabilities of adoption for dogs and cats, </span><span class="sc">\n</span><span class="st">separated by age, sterilization status and intake condition."</span>, <span class="at">color =</span> <span class="st">"Intake condition"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="lbas_eda_reg_likar_files/figure-html/unnamed-chunk-76-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>From this graph we can identify the decrease in adoption rate for both dogs and cats across different age groups. Importantly, in all cases we see that severe physical condition (purple) has a noticeably lower adoption rate across all age groups for both animal types. While the model coefficients suggest significantly higher adoption rate of dogs compared to cats (β = 0.30594), this is less identifiable from the plot itself.</p>
</section>
<section id="checking-assumptions-2" class="level3">
<h3 class="anchored" data-anchor-id="checking-assumptions-2">Checking assumptions</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb151"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb151-1"><a href="#cb151-1" aria-hidden="true" tabindex="-1"></a><span class="fu">check_model</span>(lb_complex_mdl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="lbas_eda_reg_likar_files/figure-html/unnamed-chunk-77-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Multicolinearity:</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb152"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a><span class="fu">check_collinearity</span>(lb_complex_mdl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># Check for Multicollinearity

Low Correlation

             Term  VIF   VIF 95% CI Increased SE Tolerance Tolerance 95% CI
      animal_type 1.79 [1.76, 1.83]         1.34      0.56     [0.55, 0.57]
              sex 1.01 [1.00, 1.04]         1.00      0.99     [0.96, 1.00]
         age_bins 2.21 [2.16, 2.26]         1.49      0.45     [0.44, 0.46]
       sterilised 1.18 [1.16, 1.20]         1.09      0.85     [0.83, 0.86]
 intake_condition 1.55 [1.52, 1.58]         1.24      0.65     [0.63, 0.66]</code></pre>
</div>
</div>
<p><strong>Influential points:</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb154"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Leverage</span></span>
<span id="cb154-2"><a href="#cb154-2" aria-hidden="true" tabindex="-1"></a>n_obs_3 <span class="ot">=</span> <span class="fu">nrow</span>(lb_analysis_merged_age)</span>
<span id="cb154-3"><a href="#cb154-3" aria-hidden="true" tabindex="-1"></a>params_3 <span class="ot">=</span> <span class="fu">length</span>(<span class="fu">coef</span>(lb_complex_mdl)) <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb154-4"><a href="#cb154-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-5"><a href="#cb154-5" aria-hidden="true" tabindex="-1"></a>influential_lev_3 <span class="ot">&lt;-</span> <span class="fu">hatvalues</span>(lb_complex_mdl) <span class="sc">&gt;</span>  <span class="dv">2</span><span class="sc">*</span>(params_3<span class="sc">+</span><span class="dv">1</span>)<span class="sc">/</span>n_obs_3</span>
<span id="cb154-6"><a href="#cb154-6" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(influential_lev_3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1826</code></pre>
</div>
<div class="sourceCode cell-code" id="cb156"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a>lb_simple_merged_mdl <span class="sc">%&gt;%</span></span>
<span id="cb156-2"><a href="#cb156-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">augment</span>() <span class="sc">%&gt;%</span></span>
<span id="cb156-3"><a href="#cb156-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">high_leverage =</span> <span class="fu">ifelse</span>(.hat <span class="sc">&gt;</span> <span class="dv">2</span><span class="sc">*</span>(params_2<span class="sc">+</span><span class="dv">1</span>)<span class="sc">/</span>n_obs_2, <span class="dv">1</span>, <span class="dv">0</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb156-4"><a href="#cb156-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(high_leverage)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 2
  high_leverage     n
          &lt;dbl&gt; &lt;int&gt;
1             0 19811</code></pre>
</div>
<div class="sourceCode cell-code" id="cb158"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb158-1"><a href="#cb158-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Uf, 1826 points are identified as influential according to leverage values threshold, however visual inspection above (check_model, plot Influential observations) suggest no such points. </span></span>
<span id="cb158-2"><a href="#cb158-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-3"><a href="#cb158-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Cook's distance</span></span>
<span id="cb158-4"><a href="#cb158-4" aria-hidden="true" tabindex="-1"></a>influential_cd_3 <span class="ot">&lt;-</span> <span class="fu">cooks.distance</span>(lb_complex_mdl) <span class="sc">&gt;</span> <span class="dv">4</span> <span class="sc">/</span> n_obs_3</span>
<span id="cb158-5"><a href="#cb158-5" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(influential_cd_3) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1002</code></pre>
</div>
<div class="sourceCode cell-code" id="cb160"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb160-1"><a href="#cb160-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">cooks.distance</span>(lb_complex_mdl) <span class="sc">&gt;</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb162"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb162-1"><a href="#cb162-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We have 1002 influential points according to 4/n rule of thumb and 0 according to D &gt; 1. </span></span>
<span id="cb162-2"><a href="#cb162-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb162-3"><a href="#cb162-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Let take another look at this.</span></span>
<span id="cb162-4"><a href="#cb162-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(lb_complex_mdl, <span class="dv">4</span><span class="sc">:</span><span class="dv">6</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="lbas_eda_reg_likar_files/figure-html/unnamed-chunk-79-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="lbas_eda_reg_likar_files/figure-html/unnamed-chunk-79-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="lbas_eda_reg_likar_files/figure-html/unnamed-chunk-79-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb163"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb163-1"><a href="#cb163-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's check age bins of influential points</span></span>
<span id="cb163-2"><a href="#cb163-2" aria-hidden="true" tabindex="-1"></a>lb_analysis_merged_age <span class="sc">%&gt;%</span></span>
<span id="cb163-3"><a href="#cb163-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(influential_cd_3) <span class="sc">%&gt;%</span></span>
<span id="cb163-4"><a href="#cb163-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(age_bins)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 2
  age_bins         n
  &lt;fct&gt;        &lt;int&gt;
1 Junior         308
2 Young adult    254
3 Mature adult   246
4 Older          194</code></pre>
</div>
<div class="sourceCode cell-code" id="cb165"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb165-1"><a href="#cb165-1" aria-hidden="true" tabindex="-1"></a><span class="co"># And intake conditions</span></span>
<span id="cb165-2"><a href="#cb165-2" aria-hidden="true" tabindex="-1"></a>lb_analysis_merged_age <span class="sc">%&gt;%</span></span>
<span id="cb165-3"><a href="#cb165-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(influential_cd_3) <span class="sc">%&gt;%</span></span>
<span id="cb165-4"><a href="#cb165-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(intake_condition)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 2
  intake_condition      n
  &lt;fct&gt;             &lt;int&gt;
1 Normal              420
2 Mild physical       196
3 Moderate physical   223
4 Severe physical     154
5 Under age/weight      9</code></pre>
</div>
<div class="sourceCode cell-code" id="cb167"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb167-1"><a href="#cb167-1" aria-hidden="true" tabindex="-1"></a><span class="co"># And sterilization status</span></span>
<span id="cb167-2"><a href="#cb167-2" aria-hidden="true" tabindex="-1"></a>lb_analysis_merged_age <span class="sc">%&gt;%</span></span>
<span id="cb167-3"><a href="#cb167-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(influential_cd_3) <span class="sc">%&gt;%</span></span>
<span id="cb167-4"><a href="#cb167-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(sterilised)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 2
  sterilised     n
  &lt;fct&gt;      &lt;int&gt;
1 No           513
2 Yes          489</code></pre>
</div>
</div>
<p>I do not identify any specific points that would really stand out from others. If we would decide to remove influential points according to leverage and Cooks’d distance, almost 5% of data should be remove, which would possibly lead to overfitting of the model. I decide to continue with the whole dataset, as from a contextual point of view all datapoints are biologically and contextually plausible. When checking distribution of influential points with respect to predictors, they are approximatelly equally distributed across levels of age bins, intake condition and sterilization status.</p>
<p><strong>Check residuals</strong></p>
<p>I have a similar issue as before. While simulated residuals appear as uniformly distributed (<code>check_residuals</code> -&gt; p = 0.619) (not a necessary condition in logistic regression), binned residuals suggest localized misfit (only 28% within the error bounds), indicating the problem with specific subgroups. I am assuming this pattern suggests that while the model’s overall framework is appropriate, it fails to capture nuanced relationships for specific predictor combinations, and probably stem from rarer outcomes (adoptions) in specific subgroups. Possibly, they might be resolved by introducing interaction terms. As explained in the previous section, my current knowledge is not sufficient to decide what actions should be taken to resolve this issue, or how relevant this is in the first place, so I will continue with the analysis as is.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb169"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb169-1"><a href="#cb169-1" aria-hidden="true" tabindex="-1"></a><span class="fu">check_residuals</span>(lb_complex_mdl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>OK: Simulated residuals appear as uniformly distributed (p = 0.619).</code></pre>
</div>
<div class="sourceCode cell-code" id="cb171"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb171-1"><a href="#cb171-1" aria-hidden="true" tabindex="-1"></a><span class="fu">binned_residuals</span>(lb_complex_mdl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Warning: Probably bad model fit. Only about 28% of the residuals are inside the error bounds.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb173"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb173-1"><a href="#cb173-1" aria-hidden="true" tabindex="-1"></a>simulated_residuals_complex_mdl <span class="ot">&lt;-</span> <span class="fu">simulateResiduals</span>(lb_complex_mdl)</span>
<span id="cb173-2"><a href="#cb173-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(simulated_residuals_complex_mdl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="lbas_eda_reg_likar_files/figure-html/unnamed-chunk-80-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="assessing-model-fit-2" class="level3">
<h3 class="anchored" data-anchor-id="assessing-model-fit-2">Assessing model fit</h3>
<section id="preudo-r-squared-2" class="level4">
<h4 class="anchored" data-anchor-id="preudo-r-squared-2">Preudo R-squared</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb174"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb174-1"><a href="#cb174-1" aria-hidden="true" tabindex="-1"></a><span class="fu">model_performance</span>(lb_complex_mdl)   <span class="co"># Focusing on Tjur's R2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># Indices of model performance

AIC       |      AICc |       BIC | Tjur's R2 |  RMSE | Sigma | Log_loss
------------------------------------------------------------------------
17828.109 | 17828.123 | 17914.943 |     0.288 | 0.379 | 1.000 |    0.449

AIC       | Score_log | Score_spherical |   PCP
-----------------------------------------------
17828.109 |      -Inf |       3.421e-04 | 0.711</code></pre>
</div>
</div>
</section>
<section id="roc-and-auc-2" class="level4">
<h4 class="anchored" data-anchor-id="roc-and-auc-2">ROC and AUC</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb176"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb176-1"><a href="#cb176-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get predicted probabilities</span></span>
<span id="cb176-2"><a href="#cb176-2" aria-hidden="true" tabindex="-1"></a>pred_probs_complex_mdl <span class="ot">&lt;-</span> <span class="fu">predict</span>(lb_complex_mdl, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb176-3"><a href="#cb176-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb176-4"><a href="#cb176-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate ROC curve</span></span>
<span id="cb176-5"><a href="#cb176-5" aria-hidden="true" tabindex="-1"></a>roc_curve_complex_mdl <span class="ot">&lt;-</span> <span class="fu">roc</span>(lb_analysis_merged_age<span class="sc">$</span>adopted, pred_probs_complex_mdl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = 0, case = 1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &lt; cases</code></pre>
</div>
<div class="sourceCode cell-code" id="cb179"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb179-1"><a href="#cb179-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(roc_curve_complex_mdl)  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="lbas_eda_reg_likar_files/figure-html/unnamed-chunk-82-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb180"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb180-1"><a href="#cb180-1" aria-hidden="true" tabindex="-1"></a><span class="fu">auc</span>(roc_curve_complex_mdl)   </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Area under the curve: 0.82</code></pre>
</div>
</div>
<p>Extract threshold</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb182"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb182-1"><a href="#cb182-1" aria-hidden="true" tabindex="-1"></a>lb_complex_mdl_thresh <span class="ot">&lt;-</span> <span class="fu">coords</span>(roc_curve_complex_mdl, <span class="st">"best"</span>, <span class="at">ret =</span> <span class="st">"threshold"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="confusion-matrix-for-determining-accuracy-2" class="level4">
<h4 class="anchored" data-anchor-id="confusion-matrix-for-determining-accuracy-2">Confusion matrix for determining accuracy</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb183"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb183-1"><a href="#cb183-1" aria-hidden="true" tabindex="-1"></a>lb_complex_mdl_pred_binary <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(pred_probs_complex_mdl <span class="sc">&gt;</span> lb_complex_mdl_thresh [[<span class="dv">1</span>]], <span class="st">"Yes"</span>, <span class="st">"No"</span>)</span>
<span id="cb183-2"><a href="#cb183-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-3"><a href="#cb183-3" aria-hidden="true" tabindex="-1"></a>lb_complex_mdl_conf_matrix <span class="ot">&lt;-</span> <span class="fu">confusionMatrix</span>(<span class="fu">factor</span>(lb_complex_mdl_pred_binary), <span class="fu">factor</span>(lb_analysis_merged_age<span class="sc">$</span>adopted_str))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="all-model-fit-indices-2" class="level4">
<h4 class="anchored" data-anchor-id="all-model-fit-indices-2">All model fit indices:</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb184"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb184-1"><a href="#cb184-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract variables</span></span>
<span id="cb184-2"><a href="#cb184-2" aria-hidden="true" tabindex="-1"></a>lb_complex_mdl_pseudo_r2 <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">model_performance</span>(lb_complex_mdl)[[<span class="dv">4</span>]], <span class="dv">4</span>)</span>
<span id="cb184-3"><a href="#cb184-3" aria-hidden="true" tabindex="-1"></a>lb_complex_mdl_auc_val <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">auc</span>(roc_curve_complex_mdl)[<span class="dv">1</span>],<span class="dv">4</span>)</span>
<span id="cb184-4"><a href="#cb184-4" aria-hidden="true" tabindex="-1"></a>lb_complex_mdl_accuracy <span class="ot">&lt;-</span> <span class="fu">round</span>(lb_complex_mdl_conf_matrix<span class="sc">$</span>overall[<span class="st">"Accuracy"</span>], <span class="dv">4</span>)</span>
<span id="cb184-5"><a href="#cb184-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-6"><a href="#cb184-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Nicely formatted output</span></span>
<span id="cb184-7"><a href="#cb184-7" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Complex model - Model Fit Summary:</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb184-8"><a href="#cb184-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"---------------------------------</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb184-9"><a href="#cb184-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sprintf</span>(<span class="st">"McFadden's Pseudo R²: %.3f</span><span class="sc">\n</span><span class="st">"</span>, lb_complex_mdl_pseudo_r2),</span>
<span id="cb184-10"><a href="#cb184-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sprintf</span>(<span class="st">"AUC (ROC): %.3f</span><span class="sc">\n</span><span class="st">"</span>, lb_complex_mdl_auc_val),</span>
<span id="cb184-11"><a href="#cb184-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sprintf</span>(<span class="st">"Accuracy: %.3f</span><span class="sc">\n</span><span class="st">"</span>, lb_complex_mdl_accuracy))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Complex model - Model Fit Summary:
 ---------------------------------
 McFadden's Pseudo R²: 0.288
 AUC (ROC): 0.820
 Accuracy: 0.777</code></pre>
</div>
</div>
</section>
</section>
<section id="summary-of-the-complex-model" class="level3">
<h3 class="anchored" data-anchor-id="summary-of-the-complex-model">Summary of the complex model</h3>
<p>Important things to point out, before proceeding to formal model comparison:</p>
<ul>
<li><p><strong>Model summary:</strong> The complex model shows sterilization status as the strongest predictor of adoption (β=2.69, p&lt;0.001), followed by age effects, where older animals had substantially lower odds (β=-1.97, p&lt;0.001) - the lowest of all age groups. Dogs showed higher adoption rate than cats (β=0.31, p&lt;0.001). Severe physical conditions negatively impacted adoption (β=-0.83, p&lt;0.001), most severely of all condition. Importantly, there was no significant difference between reference group (Normal condition) and mild physical condition.</p></li>
<li><p><strong>Model Diagnostics:</strong> Multicollinearity remains low (all VIFs &lt;2.21). While formal thresholds identified many influential points (1,826 by leverage, 1,002 by Cook’s distance), visual inspection showed no extreme outliers. These points were evenly distributed across predictor categories, suggesting they represent natural data variation. Residual diagnostics showed good global fit (uniform quantile residuals, p=0.619) but localized misfit in binned residuals (28% within bounds), possibly due to unmodeled interactions and/or low rate of adoption outcomes in smaller subgroups subgroups.</p></li>
<li><p><strong>Fit Indices:</strong> The model demonstrates good predictive performance: McFadden’s pseudo R2 was 0.288 (substantial improvement over null model); AUC: 0.820 (excellent discrimination); accuracy: 0.777 (significantly better than no-information rate 0.717, p&lt;0.001).</p></li>
</ul>
<p>While it is already becoming clear that there is a significant improvement in predictive power of the more complex model compared to a simple model, let’s perform formal model comparison.</p>
</section>
</section>
<section id="model-comparisons" class="level2">
<h2 class="anchored" data-anchor-id="model-comparisons">Model comparisons</h2>
<p>Likelihood ratio test:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb186"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb186-1"><a href="#cb186-1" aria-hidden="true" tabindex="-1"></a>lrt_test <span class="ot">&lt;-</span> <span class="fu">anova</span>(lb_simple_merged_mdl, lb_complex_mdl)</span>
<span id="cb186-2"><a href="#cb186-2" aria-hidden="true" tabindex="-1"></a>lrt_test</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Deviance Table

Model 1: adopted ~ animal_type + sex + age_bins
Model 2: adopted ~ animal_type + sex + age_bins + sterilised + intake_condition
  Resid. Df Resid. Dev Df Deviance  Pr(&gt;Chi)    
1     19805      23359                          
2     19800      17806  5   5553.3 &lt; 2.2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>Other indices:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb188"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb188-1"><a href="#cb188-1" aria-hidden="true" tabindex="-1"></a><span class="fu">compare_performance</span>(lb_simple_merged_mdl, lb_complex_mdl, <span class="at">rank =</span> <span class="cn">TRUE</span>, <span class="at">verbose =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Following indices with missing values are not used for ranking: Sigma,
  Score_spherical</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># Comparison of Model Performance Indices

Name                 | Model | Tjur's R2 |  RMSE | Sigma | Log_loss | Score_log
-------------------------------------------------------------------------------
lb_simple_merged_mdl |   glm |     0.012 | 0.448 | 1.000 |    0.590 |      -Inf
lb_complex_mdl       |   glm |     0.288 | 0.379 | 1.000 |    0.449 |      -Inf

Name                 |   PCP | AIC weights | AICc weights | BIC weights | Performance-Score
-------------------------------------------------------------------------------------------
lb_simple_merged_mdl | 0.599 |    0.00e+00 |     0.00e+00 |    0.00e+00 |             -Inf%
lb_complex_mdl       | 0.711 |        1.00 |         1.00 |        1.00 |             -Inf%</code></pre>
</div>
<div class="sourceCode cell-code" id="cb191"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb191-1"><a href="#cb191-1" aria-hidden="true" tabindex="-1"></a><span class="fu">test_performance</span>(lb_simple_merged_mdl, lb_complex_mdl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Name                 | Model |     BF | df | df_diff |    Chi2 |      p
-----------------------------------------------------------------------
lb_simple_merged_mdl |   glm |        |  6 |         |         |       
lb_complex_mdl       |   glm | &gt; 1000 | 11 |    5.00 | 5553.31 | &lt; .001
Models were detected as nested (in terms of fixed parameters) and are compared in sequential order.</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb193"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb193-1"><a href="#cb193-1" aria-hidden="true" tabindex="-1"></a>model_comparison <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb193-2"><a href="#cb193-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">Model =</span> <span class="fu">c</span>(<span class="st">"Simple"</span>, <span class="st">"Complex"</span>),</span>
<span id="cb193-3"><a href="#cb193-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">LRT chi2</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="fl">5553.31</span>),</span>
<span id="cb193-4"><a href="#cb193-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">LRT p-value</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="st">"p &lt; .001"</span>),</span>
<span id="cb193-5"><a href="#cb193-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">pseudo.R2 =</span> <span class="fu">c</span>(lb_simple_merged_mdl_pseudo_r2, lb_complex_mdl_pseudo_r2),</span>
<span id="cb193-6"><a href="#cb193-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">AIC =</span> <span class="fu">c</span>(<span class="fu">AIC</span>(lb_simple_merged_mdl), <span class="fu">AIC</span>(lb_complex_mdl)),</span>
<span id="cb193-7"><a href="#cb193-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">AUC =</span> <span class="fu">c</span>(lb_simple_merged_mdl_auc_val, lb_complex_mdl_auc_val),</span>
<span id="cb193-8"><a href="#cb193-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">Accuracy =</span> <span class="fu">c</span>(lb_simple_merged_mdl_accuracy, lb_complex_mdl_accuracy)</span>
<span id="cb193-9"><a href="#cb193-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb193-10"><a href="#cb193-10" aria-hidden="true" tabindex="-1"></a>model_comparison</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    Model LRT.chi2 LRT.p.value pseudo.R2      AIC    AUC Accuracy
1  Simple       NA        &lt;NA&gt;    0.0116 23371.41 0.5628   0.5206
2 Complex  5553.31    p &lt; .001    0.2884 17828.11 0.8200   0.7772</code></pre>
</div>
<div class="sourceCode cell-code" id="cb195"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb195-1"><a href="#cb195-1" aria-hidden="true" tabindex="-1"></a>model_comparison <span class="sc">%&gt;%</span></span>
<span id="cb195-2"><a href="#cb195-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">format =</span> <span class="st">"html"</span>, <span class="at">digits =</span> <span class="dv">3</span>, <span class="at">align =</span> <span class="fu">c</span>(<span class="st">"l"</span>, <span class="fu">rep</span>(<span class="st">"c"</span>, <span class="dv">5</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb195-3"><a href="#cb195-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>, <span class="st">"condensed"</span>), </span>
<span id="cb195-4"><a href="#cb195-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">full_width =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb195-5"><a href="#cb195-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_header_above</span>(<span class="fu">c</span>(<span class="st">" "</span> <span class="ot">=</span> <span class="dv">1</span>, <span class="st">"Likelihood Ratio Test"</span> <span class="ot">=</span> <span class="dv">2</span>, <span class="st">"Fit Indices"</span> <span class="ot">=</span> <span class="dv">4</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb195-6"><a href="#cb195-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">column_spec</span>(<span class="dv">1</span>, <span class="at">bold =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb195-7"><a href="#cb195-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">footnote</span>(</span>
<span id="cb195-8"><a href="#cb195-8" aria-hidden="true" tabindex="-1"></a>           <span class="at">number =</span> <span class="fu">c</span>(<span class="st">"AIC: Lower values indicate better fit"</span>,</span>
<span id="cb195-9"><a href="#cb195-9" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"AUC: Values &gt;0.8 suggest excellent discrimination"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-striped table-hover table-condensed caption-top table-sm small" data-quarto-postprocess="true">
<colgroup>
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
</colgroup>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" style="text-align: left; empty-cells: hide; border-bottom: hidden;"></th>
<th colspan="2" data-quarto-table-cell-role="th" style="text-align: center; border-bottom: hidden; padding-bottom: 0; padding-left: 3px; padding-right: 3px;"><div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Likelihood Ratio Test
</div></th>
<th colspan="4" data-quarto-table-cell-role="th" style="text-align: center; border-bottom: hidden; padding-bottom: 0; padding-left: 3px; padding-right: 3px;"><div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Fit Indices
</div></th>
</tr>
<tr class="odd">
<th style="text-align: left;" data-quarto-table-cell-role="th">Model</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">LRT.chi2</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">LRT.p.value</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">pseudo.R2</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">AIC</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">AUC</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Accuracy</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left; font-weight: bold;">Simple</td>
<td style="text-align: center;">NA</td>
<td style="text-align: center;">NA</td>
<td style="text-align: center;">0.012</td>
<td style="text-align: center;">23371.41</td>
<td style="text-align: center;">0.563</td>
<td style="text-align: left;">0.521</td>
</tr>
<tr class="even">
<td style="text-align: left; font-weight: bold;">Complex</td>
<td style="text-align: center;">5553.31</td>
<td style="text-align: center;">p &lt; .001</td>
<td style="text-align: center;">0.288</td>
<td style="text-align: center;">17828.11</td>
<td style="text-align: center;">0.820</td>
<td style="text-align: left;">0.777</td>
</tr>
</tbody><tfoot>
<tr class="even">
<td style="text-align: left; padding: 0;"><sup>1</sup> AIC: Lower values indicate better fit</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left; padding: 0;"><sup>2</sup> AUC: Values &gt;0.8 suggest excellent discrimination</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: left;"></td>
</tr>
</tfoot>

</table>


</div>
</div>
<section id="reporting-model-comparison" class="level3">
<h3 class="anchored" data-anchor-id="reporting-model-comparison">Reporting model comparison</h3>
<p>The complex model demonstrated substantially better performance across all metrics compared to the simple model. A likelihood ratio test confirmed the complex model’s superior fit (χ²=5553.31, p&lt;.001), with the additional predictors explaining 27.6% more variance (pseudo R²=0.288 vs 0.012). This improvement was reflected in the AIC reduction from 23,371 to 17,828, strongly favoring the complex model. Predictive performance also improved markedly, with AUC increasing from 0.563 (poor discrimination) to 0.820 (excellent discrimination), while accuracy rose from 52.1% to 77.7%. These results suggest that including sterilization status and intake condition alongside the basic predictors (animal type, sex, and age bins) provides a far more complete understanding of adoption patterns.</p>
</section>
</section>
<section id="final-model-summaries" class="level2">
<h2 class="anchored" data-anchor-id="final-model-summaries">Final model summaries</h2>
<p>Final model estimates report will be provided here. So far I only inspected each model with <code>summary()</code> function, but let us now create a nice, comprehensive table and discuss the results of the models.</p>
<p>Log-odds:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb196"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb196-1"><a href="#cb196-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tab_model</span>(lb_simple_merged_mdl,lb_complex_mdl,</span>
<span id="cb196-2"><a href="#cb196-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">show.est =</span> <span class="cn">TRUE</span>,</span>
<span id="cb196-3"><a href="#cb196-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">transform =</span> <span class="cn">NULL</span>,</span>
<span id="cb196-4"><a href="#cb196-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">show.stat =</span> <span class="cn">TRUE</span>,</span>
<span id="cb196-5"><a href="#cb196-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">show.aic =</span> <span class="cn">TRUE</span>,</span>
<span id="cb196-6"><a href="#cb196-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">show.loglik =</span> <span class="cn">TRUE</span>,</span>
<span id="cb196-7"><a href="#cb196-7" aria-hidden="true" tabindex="-1"></a>          <span class="at">pred.labels =</span> <span class="fu">c</span>(</span>
<span id="cb196-8"><a href="#cb196-8" aria-hidden="true" tabindex="-1"></a>                <span class="st">"Intercept"</span>,</span>
<span id="cb196-9"><a href="#cb196-9" aria-hidden="true" tabindex="-1"></a>                <span class="st">"Dogs (vs Cats)"</span>,</span>
<span id="cb196-10"><a href="#cb196-10" aria-hidden="true" tabindex="-1"></a>                <span class="st">"Male (vs Female)"</span>,</span>
<span id="cb196-11"><a href="#cb196-11" aria-hidden="true" tabindex="-1"></a>                <span class="st">"Young adult (vs Junior)"</span>,</span>
<span id="cb196-12"><a href="#cb196-12" aria-hidden="true" tabindex="-1"></a>                <span class="st">"Mature adult (vs Junior)"</span>,</span>
<span id="cb196-13"><a href="#cb196-13" aria-hidden="true" tabindex="-1"></a>                <span class="st">"Older (vs Junior)"</span>,</span>
<span id="cb196-14"><a href="#cb196-14" aria-hidden="true" tabindex="-1"></a>                <span class="st">"Sterilized (vs Not)"</span>,</span>
<span id="cb196-15"><a href="#cb196-15" aria-hidden="true" tabindex="-1"></a>                <span class="st">"Mild Condition (vs Normal)"</span>,</span>
<span id="cb196-16"><a href="#cb196-16" aria-hidden="true" tabindex="-1"></a>                <span class="st">"Moderate Condition (vs Normal)"</span>,</span>
<span id="cb196-17"><a href="#cb196-17" aria-hidden="true" tabindex="-1"></a>                <span class="st">"Severe Condition (vs Normal)"</span>,</span>
<span id="cb196-18"><a href="#cb196-18" aria-hidden="true" tabindex="-1"></a>                <span class="st">"Underweight/Young (vs Normal)"</span>),</span>
<span id="cb196-19"><a href="#cb196-19" aria-hidden="true" tabindex="-1"></a>          <span class="at">dv.labels =</span> <span class="fu">c</span>(<span class="st">"Simple model - animal-focused factors"</span>, <span class="st">"Complex model - added contextual/intervention factors"</span>)</span>
<span id="cb196-20"><a href="#cb196-20" aria-hidden="true" tabindex="-1"></a>          )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Profiled confidence intervals may take longer time to compute.
  Use `ci_method="wald"` for faster computation of CIs.
Profiled confidence intervals may take longer time to compute.
  Use `ci_method="wald"` for faster computation of CIs.</code></pre>
</div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th" style="text-align: center; border-top: double; font-style: normal; font-weight: bold; padding: 0.2cm;">&nbsp;</td>
<td colspan="4" data-quarto-table-cell-role="th" style="text-align: center; border-top: double; font-style: normal; font-weight: bold; padding: 0.2cm;">Simple model - animal-focused factors</td>
<td colspan="4" data-quarto-table-cell-role="th" style="text-align: center; border-top: double; font-style: normal; font-weight: bold; padding: 0.2cm;">Complex model - added contextual/intervention factors</td>
</tr>
<tr class="even">
<td style="text-align: center; border-bottom: 1px solid; font-style: italic; font-weight: normal;">Predictors</td>
<td style="text-align: center; border-bottom: 1px solid; font-style: italic; font-weight: normal;">Log-Odds</td>
<td style="text-align: center; border-bottom: 1px solid; font-style: italic; font-weight: normal;">CI</td>
<td style="text-align: center; border-bottom: 1px solid; font-style: italic; font-weight: normal;">Statistic</td>
<td style="text-align: center; border-bottom: 1px solid; font-style: italic; font-weight: normal;">p</td>
<td style="text-align: center; border-bottom: 1px solid; font-style: italic; font-weight: normal;">Log-Odds</td>
<td style="text-align: center;">CI</td>
<td style="text-align: center;">Statistic</td>
<td style="text-align: center;">p</td>
</tr>
<tr class="odd">
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">Intercept</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">-0.80</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">-0.86&nbsp;–&nbsp;-0.75</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">-28.06</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"><strong>&lt;0.001</strong></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">-1.84</td>
<td style="text-align: center;">-1.95&nbsp;–&nbsp;-1.74</td>
<td style="text-align: center;">-35.49</td>
<td style="text-align: center;"><strong>&lt;0.001</strong></td>
</tr>
<tr class="even">
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">Dogs (vs Cats)</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">0.17</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">0.09&nbsp;–&nbsp;0.25</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">4.18</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"><strong>&lt;0.001</strong></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">0.31</td>
<td style="text-align: center;">0.21&nbsp;–&nbsp;0.40</td>
<td style="text-align: center;">6.08</td>
<td style="text-align: center;"><strong>&lt;0.001</strong></td>
</tr>
<tr class="odd">
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">Male (vs Female)</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">0.01</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">-0.05&nbsp;–&nbsp;0.07</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">0.33</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">0.738</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">-0.02</td>
<td style="text-align: center;">-0.09&nbsp;–&nbsp;0.06</td>
<td style="text-align: center;">-0.46</td>
<td style="text-align: center;">0.645</td>
</tr>
<tr class="even">
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">Young adult (vs Junior)</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">-0.24</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">-0.32&nbsp;–&nbsp;-0.15</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">-5.60</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"><strong>&lt;0.001</strong></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">-1.03</td>
<td style="text-align: center;">-1.14&nbsp;–&nbsp;-0.92</td>
<td style="text-align: center;">-18.76</td>
<td style="text-align: center;"><strong>&lt;0.001</strong></td>
</tr>
<tr class="odd">
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">Mature adult (vs Junior)</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">-0.31</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">-0.41&nbsp;–&nbsp;-0.21</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">-6.08</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"><strong>&lt;0.001</strong></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">-0.99</td>
<td style="text-align: center;">-1.12&nbsp;–&nbsp;-0.87</td>
<td style="text-align: center;">-15.86</td>
<td style="text-align: center;"><strong>&lt;0.001</strong></td>
</tr>
<tr class="even">
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">Older (vs Junior)</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">-0.95</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">-1.08&nbsp;–&nbsp;-0.82</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">-14.47</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"><strong>&lt;0.001</strong></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">-1.97</td>
<td style="text-align: center;">-2.12&nbsp;–&nbsp;-1.82</td>
<td style="text-align: center;">-25.55</td>
<td style="text-align: center;"><strong>&lt;0.001</strong></td>
</tr>
<tr class="odd">
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">Sterilized (vs Not)</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">2.69</td>
<td style="text-align: center;">2.61&nbsp;–&nbsp;2.78</td>
<td style="text-align: center;">62.21</td>
<td style="text-align: center;"><strong>&lt;0.001</strong></td>
</tr>
<tr class="even">
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">Mild Condition (vs Normal)</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">0.05</td>
<td style="text-align: center;">-0.09&nbsp;–&nbsp;0.18</td>
<td style="text-align: center;">0.68</td>
<td style="text-align: center;">0.495</td>
</tr>
<tr class="odd">
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">Moderate Condition (vs Normal)</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">-0.22</td>
<td style="text-align: center;">-0.39&nbsp;–&nbsp;-0.06</td>
<td style="text-align: center;">-2.69</td>
<td style="text-align: center;"><strong>0.007</strong></td>
</tr>
<tr class="even">
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">Severe Condition (vs Normal)</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">-0.83</td>
<td style="text-align: center;">-1.04&nbsp;–&nbsp;-0.63</td>
<td style="text-align: center;">-7.84</td>
<td style="text-align: center;"><strong>&lt;0.001</strong></td>
</tr>
<tr class="odd">
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">Underweight/Young (vs Normal)</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">-0.21</td>
<td style="text-align: center;">-0.33&nbsp;–&nbsp;-0.10</td>
<td style="text-align: center;">-3.63</td>
<td style="text-align: center;"><strong>&lt;0.001</strong></td>
</tr>
<tr class="even">
<td style="text-align: left; padding: 0.2cm; vertical-align: top; padding-top: 0.1cm; padding-bottom: 0.1cm; border-top: 1px solid;">Observations</td>
<td colspan="4" style="text-align: left; padding: 0.2cm; vertical-align: top; padding-top: 0.1cm; padding-bottom: 0.1cm; border-top: 1px solid;">19811</td>
<td colspan="4" style="text-align: left; padding: 0.2cm; vertical-align: top; padding-top: 0.1cm; padding-bottom: 0.1cm; border-top: 1px solid;">19811</td>
</tr>
<tr class="odd">
<td style="text-align: left; padding: 0.2cm; vertical-align: top; padding-top: 0.1cm; padding-bottom: 0.1cm;">R<sup>2</sup> Tjur</td>
<td colspan="4" style="text-align: left; padding: 0.2cm; vertical-align: top; padding-top: 0.1cm; padding-bottom: 0.1cm;">0.012</td>
<td colspan="4" style="text-align: left; padding: 0.2cm; vertical-align: top; padding-top: 0.1cm; padding-bottom: 0.1cm;">0.288</td>
</tr>
<tr class="even">
<td style="text-align: left; padding: 0.2cm; vertical-align: top; padding-top: 0.1cm; padding-bottom: 0.1cm;">AIC</td>
<td colspan="4" style="text-align: left; padding: 0.2cm; vertical-align: top; padding-top: 0.1cm; padding-bottom: 0.1cm;">23371.414</td>
<td colspan="4" style="text-align: left; padding: 0.2cm; vertical-align: top; padding-top: 0.1cm; padding-bottom: 0.1cm;">17828.109</td>
</tr>
<tr class="odd">
<td style="text-align: left; padding: 0.2cm; vertical-align: top; padding-top: 0.1cm; padding-bottom: 0.1cm;">log-Likelihood</td>
<td colspan="4" style="text-align: left; padding: 0.2cm; vertical-align: top; padding-top: 0.1cm; padding-bottom: 0.1cm;">-11679.707</td>
<td colspan="4" style="text-align: left; padding: 0.2cm; vertical-align: top; padding-top: 0.1cm; padding-bottom: 0.1cm;">-8903.055</td>
</tr>
</tbody>
</table>


</div>
</div>
<p>Odds-ratios:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb198"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb198-1"><a href="#cb198-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tab_model</span>(lb_simple_merged_mdl,lb_complex_mdl,</span>
<span id="cb198-2"><a href="#cb198-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">show.stat =</span> <span class="cn">TRUE</span>,</span>
<span id="cb198-3"><a href="#cb198-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">show.aic =</span> <span class="cn">TRUE</span>,</span>
<span id="cb198-4"><a href="#cb198-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">show.loglik =</span> <span class="cn">TRUE</span>,</span>
<span id="cb198-5"><a href="#cb198-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">pred.labels =</span> <span class="fu">c</span>(</span>
<span id="cb198-6"><a href="#cb198-6" aria-hidden="true" tabindex="-1"></a>                <span class="st">"Intercept"</span>,</span>
<span id="cb198-7"><a href="#cb198-7" aria-hidden="true" tabindex="-1"></a>                <span class="st">"Dogs (vs Cats)"</span>,</span>
<span id="cb198-8"><a href="#cb198-8" aria-hidden="true" tabindex="-1"></a>                <span class="st">"Male (vs Female)"</span>,</span>
<span id="cb198-9"><a href="#cb198-9" aria-hidden="true" tabindex="-1"></a>                <span class="st">"Young adult (vs Junior)"</span>,</span>
<span id="cb198-10"><a href="#cb198-10" aria-hidden="true" tabindex="-1"></a>                <span class="st">"Mature adult (vs Junior)"</span>,</span>
<span id="cb198-11"><a href="#cb198-11" aria-hidden="true" tabindex="-1"></a>                <span class="st">"Older (vs Junior)"</span>,</span>
<span id="cb198-12"><a href="#cb198-12" aria-hidden="true" tabindex="-1"></a>                <span class="st">"Sterilized (vs Not)"</span>,</span>
<span id="cb198-13"><a href="#cb198-13" aria-hidden="true" tabindex="-1"></a>                <span class="st">"Mild Condition (vs Normal)"</span>,</span>
<span id="cb198-14"><a href="#cb198-14" aria-hidden="true" tabindex="-1"></a>                <span class="st">"Moderate Condition (vs Normal)"</span>,</span>
<span id="cb198-15"><a href="#cb198-15" aria-hidden="true" tabindex="-1"></a>                <span class="st">"Severe Condition (vs Normal)"</span>,</span>
<span id="cb198-16"><a href="#cb198-16" aria-hidden="true" tabindex="-1"></a>                <span class="st">"Underweight/Young (vs Normal)"</span>),</span>
<span id="cb198-17"><a href="#cb198-17" aria-hidden="true" tabindex="-1"></a>          <span class="at">dv.labels =</span> <span class="fu">c</span>(<span class="st">"Simple model - animal-focused factors"</span>, <span class="st">"Complex model - added contextual/intervention factors"</span>)</span>
<span id="cb198-18"><a href="#cb198-18" aria-hidden="true" tabindex="-1"></a>          )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Profiled confidence intervals may take longer time to compute.
  Use `ci_method="wald"` for faster computation of CIs.
Profiled confidence intervals may take longer time to compute.
  Use `ci_method="wald"` for faster computation of CIs.</code></pre>
</div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th" style="text-align: center; border-top: double; font-style: normal; font-weight: bold; padding: 0.2cm;">&nbsp;</td>
<td colspan="4" data-quarto-table-cell-role="th" style="text-align: center; border-top: double; font-style: normal; font-weight: bold; padding: 0.2cm;">Simple model - animal-focused factors</td>
<td colspan="4" data-quarto-table-cell-role="th" style="text-align: center; border-top: double; font-style: normal; font-weight: bold; padding: 0.2cm;">Complex model - added contextual/intervention factors</td>
</tr>
<tr class="even">
<td style="text-align: center; border-bottom: 1px solid; font-style: italic; font-weight: normal;">Predictors</td>
<td style="text-align: center; border-bottom: 1px solid; font-style: italic; font-weight: normal;">Odds Ratios</td>
<td style="text-align: center; border-bottom: 1px solid; font-style: italic; font-weight: normal;">CI</td>
<td style="text-align: center; border-bottom: 1px solid; font-style: italic; font-weight: normal;">Statistic</td>
<td style="text-align: center; border-bottom: 1px solid; font-style: italic; font-weight: normal;">p</td>
<td style="text-align: center; border-bottom: 1px solid; font-style: italic; font-weight: normal;">Odds Ratios</td>
<td style="text-align: center;">CI</td>
<td style="text-align: center;">Statistic</td>
<td style="text-align: center;">p</td>
</tr>
<tr class="odd">
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">Intercept</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">0.45</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">0.42&nbsp;–&nbsp;0.47</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">-28.06</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"><strong>&lt;0.001</strong></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">0.16</td>
<td style="text-align: center;">0.14&nbsp;–&nbsp;0.18</td>
<td style="text-align: center;">-35.49</td>
<td style="text-align: center;"><strong>&lt;0.001</strong></td>
</tr>
<tr class="even">
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">Dogs (vs Cats)</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">1.19</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">1.09&nbsp;–&nbsp;1.29</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">4.18</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"><strong>&lt;0.001</strong></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">1.36</td>
<td style="text-align: center;">1.23&nbsp;–&nbsp;1.50</td>
<td style="text-align: center;">6.08</td>
<td style="text-align: center;"><strong>&lt;0.001</strong></td>
</tr>
<tr class="odd">
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">Male (vs Female)</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">1.01</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">0.95&nbsp;–&nbsp;1.08</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">0.33</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">0.738</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">0.98</td>
<td style="text-align: center;">0.91&nbsp;–&nbsp;1.06</td>
<td style="text-align: center;">-0.46</td>
<td style="text-align: center;">0.645</td>
</tr>
<tr class="even">
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">Young adult (vs Junior)</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">0.79</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">0.73&nbsp;–&nbsp;0.86</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">-5.60</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"><strong>&lt;0.001</strong></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">0.36</td>
<td style="text-align: center;">0.32&nbsp;–&nbsp;0.40</td>
<td style="text-align: center;">-18.76</td>
<td style="text-align: center;"><strong>&lt;0.001</strong></td>
</tr>
<tr class="odd">
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">Mature adult (vs Junior)</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">0.73</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">0.66&nbsp;–&nbsp;0.81</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">-6.08</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"><strong>&lt;0.001</strong></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">0.37</td>
<td style="text-align: center;">0.33&nbsp;–&nbsp;0.42</td>
<td style="text-align: center;">-15.86</td>
<td style="text-align: center;"><strong>&lt;0.001</strong></td>
</tr>
<tr class="even">
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">Older (vs Junior)</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">0.39</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">0.34&nbsp;–&nbsp;0.44</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">-14.47</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"><strong>&lt;0.001</strong></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">0.14</td>
<td style="text-align: center;">0.12&nbsp;–&nbsp;0.16</td>
<td style="text-align: center;">-25.55</td>
<td style="text-align: center;"><strong>&lt;0.001</strong></td>
</tr>
<tr class="odd">
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">Sterilized (vs Not)</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">14.74</td>
<td style="text-align: center;">13.55&nbsp;–&nbsp;16.05</td>
<td style="text-align: center;">62.21</td>
<td style="text-align: center;"><strong>&lt;0.001</strong></td>
</tr>
<tr class="even">
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">Mild Condition (vs Normal)</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">1.05</td>
<td style="text-align: center;">0.91&nbsp;–&nbsp;1.20</td>
<td style="text-align: center;">0.68</td>
<td style="text-align: center;">0.495</td>
</tr>
<tr class="odd">
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">Moderate Condition (vs Normal)</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">0.80</td>
<td style="text-align: center;">0.68&nbsp;–&nbsp;0.94</td>
<td style="text-align: center;">-2.69</td>
<td style="text-align: center;"><strong>0.007</strong></td>
</tr>
<tr class="even">
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">Severe Condition (vs Normal)</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">0.44</td>
<td style="text-align: center;">0.35&nbsp;–&nbsp;0.53</td>
<td style="text-align: center;">-7.84</td>
<td style="text-align: center;"><strong>&lt;0.001</strong></td>
</tr>
<tr class="odd">
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">Underweight/Young (vs Normal)</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">0.81</td>
<td style="text-align: center;">0.72&nbsp;–&nbsp;0.91</td>
<td style="text-align: center;">-3.63</td>
<td style="text-align: center;"><strong>&lt;0.001</strong></td>
</tr>
<tr class="even">
<td style="text-align: left; padding: 0.2cm; vertical-align: top; padding-top: 0.1cm; padding-bottom: 0.1cm; border-top: 1px solid;">Observations</td>
<td colspan="4" style="text-align: left; padding: 0.2cm; vertical-align: top; padding-top: 0.1cm; padding-bottom: 0.1cm; border-top: 1px solid;">19811</td>
<td colspan="4" style="text-align: left; padding: 0.2cm; vertical-align: top; padding-top: 0.1cm; padding-bottom: 0.1cm; border-top: 1px solid;">19811</td>
</tr>
<tr class="odd">
<td style="text-align: left; padding: 0.2cm; vertical-align: top; padding-top: 0.1cm; padding-bottom: 0.1cm;">R<sup>2</sup> Tjur</td>
<td colspan="4" style="text-align: left; padding: 0.2cm; vertical-align: top; padding-top: 0.1cm; padding-bottom: 0.1cm;">0.012</td>
<td colspan="4" style="text-align: left; padding: 0.2cm; vertical-align: top; padding-top: 0.1cm; padding-bottom: 0.1cm;">0.288</td>
</tr>
<tr class="even">
<td style="text-align: left; padding: 0.2cm; vertical-align: top; padding-top: 0.1cm; padding-bottom: 0.1cm;">AIC</td>
<td colspan="4" style="text-align: left; padding: 0.2cm; vertical-align: top; padding-top: 0.1cm; padding-bottom: 0.1cm;">23371.414</td>
<td colspan="4" style="text-align: left; padding: 0.2cm; vertical-align: top; padding-top: 0.1cm; padding-bottom: 0.1cm;">17828.109</td>
</tr>
<tr class="odd">
<td style="text-align: left; padding: 0.2cm; vertical-align: top; padding-top: 0.1cm; padding-bottom: 0.1cm;">log-Likelihood</td>
<td colspan="4" style="text-align: left; padding: 0.2cm; vertical-align: top; padding-top: 0.1cm; padding-bottom: 0.1cm;">-11679.707</td>
<td colspan="4" style="text-align: left; padding: 0.2cm; vertical-align: top; padding-top: 0.1cm; padding-bottom: 0.1cm;">-8903.055</td>
</tr>
</tbody>
</table>


</div>
</div>
<p>I will focus on more complex model’s coefficients in this interpretation section. Reference group of each predictor is listed in the parenthesis next to each level of the predictor variable (reference group was therefore a non-sterilized junior female cat taken in normal condition).</p>
<p>All in all, present analysis reveals an interesting hierarchy of factors contributing to animal adoption. Sterilization status was identified as the most powerful predictor. Sterilized animals show an incredible 14.7-fold increase in adoption odds compared to unsterilized animals. This suggests that sterilization programs should be prioritized as a key intervention strategy for shelters in order to increase adoption rate of animals. The reference group — a non-sterilized junior female cat in normal health, has a baseline adoption probability of 13.8% (<code>plogis(-1.84)</code>). When this same animal is sterilized, its probability jumps to 70.1% (<code>plogis(-1.84 + 2.69)</code>). Another interesting example - while a non-sterilized <em>older</em> female cat in normal health has 2.2% probability of getting adopted (<code>plogis(-1.84 -1.97)</code>), sterilization increases probabilities up to 24.6% (<code>plogis(-1.84 -1.97 + 2.69 )</code>).</p>
<p>Age exhibits a strong, gradual negative relationship with adoption likelihood, where older animals face vastly lower adoption rates - they have just 14% of the adoption odds of junior animals, while young and mature adults show intermediate but still reduced odds (36-37% of juveniles).</p>
<p>Dogs show a moderate 36% advantage over cats in adoption odds.</p>
<p>Health conditions exhibited important differenecs: animals with severe medical issues experience less than half the adoption odds (44%) of normal/healthy animals, while those with moderate conditions or being under age/weight show smaller but significant reductions (20% and 19% lower odds respectively). Mild conditions, interestingly, show no statistically different effect on adoption rates.</p>
</section>
</section>
<section id="final-discussion" class="level1">
<h1>Final discussion</h1>
<p>If we consider initially formulated research question and hypothesis, this analysis revealed interesting findings. I aimed to determine whether contextual/intervention factors like sterilization status and intake condition could enhance predictions of animal adoption beyond basic biological traits, and the results provide support for this hypothesis. The complex model, incorporating these additional variables, demonstrated a significant improvement over the simple model, evidenced by a 27.6% increase in explained variance (Tjur’s R2: 0.012 → 0.288), a significant likelihood ratio test (χ²=5553.31, p&lt;0.001), and a leap in predictive/descriminative power from poor to excellent (AUC: 0.56 → 0.82).</p>
<p>Sterilization emerged as the most important predictor, with sterilized animals experiencing a 14.7-fold increase in adoption odds. Health conditions further impacted outcomes, as severe physical ailments halved adoption odds (OR=0.44), while mild conditions had no detectable effect, suggesting adopters weigh major health concerns more heavily than minor ones. Significant age gradient was observed in complex model (as well as simple model), with older animals facing adoption deficits (OR=0.14 vs.&nbsp;juniors), underscoring the need for targeted interventions for this vulnerable group.</p>
<p>While the model’s overall performance is strong, the binned residuals’ localized misfit (28% within bounds) hints at unresolved nuances, possibly from unmodeled interactions or other, unfeatured variables. However, as mentioned several times throughout this document, my current knowledge and understanding of statistical methods did not allow me to address and investigate this issue further at this present moment.</p>
<p>It is highly important to emphasize, that only a few specific predictors were selected from the dataset and that featuring others might lead to further model fit improvement and predictive power. Such are for example color of the animal, but I decided to leave it out as it seems a highly subjective and consequently unsystematic factor. Additionally, I considered introducing intake condition, but our EDA revealed highly condensed data in the “stray” category, compared to others and based on this imbalance I decided to not feature it in the analysis. Even beyond this dataset, there are probably other factors, which greatly influence decision to adopt, but might be hard to determine quantitatively - a very frequent report (anecdotal) is that a person simply “knows” which animal to pick, as if they have some immediate connection, which is probably very difficult to explain verbally and potentially be categorized as a predictive variable.</p>
<p>To conclude, these findings collectively argue that shelters should prioritize sterilization programs as they seem to be significantly improving adoption outcomes.</p>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>